<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ficha Cadastral - Persevera</title>
    
    <!-- Adobe Fonts (Typekit) para Avenir - Apenas como exemplo, precisa ser substituído por um kit real -->
    
    <!-- Google Fonts alternativa - Fontes similares à Avenir -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Email Validator via CDN -->
    <script src="https://cdn.jsdelivr.net/npm/email-validator@2.0.4/dist/email-validator.min.js" defer></script>
        
    <!-- Carregando fontes Avenir via @font-face -->
    <style>
        @font-face {
            font-family: 'Avenir';
            src: url('../assets/fonts/AvenirLTStd-Medium.otf') format('otf');
            font-weight: 500;
            font-style: normal;
            font-display: swap;
        }
        
        @font-face {
            font-family: 'Avenir Light';
            src: url('../assets/fonts/AvenirLTStd-Light.otf') format('otf');
            font-weight: 300;
            font-style: normal;
            font-display: swap;
        }
        
        /* Fallback para fontes web seguras caso as fontes Avenir não carreguem */
        :root {
            --primary-color: #124A81;
            --secondary-color: #0F75BC;
            --hover-color: #2554CC;
            --submit-hover: #16AA52;
            --background-color: #F3F3FE;
            --form-bg: #FFFFFF;
            --divider-color: #F3F3FE;
            --text-color: #000000;
            --sub-text-color: #57647e;
            --input-border: rgba(195, 202, 216, 0.75);
            --input-focus-border: rgba(46, 105, 255, 1);
            --input-focus-shadow: rgba(201, 216, 254, 0.25);
            --error-color: #e74c3c;
            --error-bg: rgba(231, 76, 60, 0.1);
            --light-color: #F5F5F5;
            --dark-color: #333;
            --font-primary: 'Avenir', 'avenir', 'Nunito', Helvetica, Arial, sans-serif;
            --font-light: 'Avenir Light', 'avenir', 'Nunito Light', 'Nunito', Helvetica, Arial, sans-serif;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            background-color: var(--background-color);
            padding: 20px;
            color: var(--text-color);
            font-family: var(--font-primary);
        }
        
        .form-container {
            max-width: 800px;
            margin: 0 auto;
            background-color: var(--form-bg);
  border-radius: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            overflow: hidden;
        }
        
        .form-header {
            padding: 40px 52px;
            border-bottom: 1px solid var(--divider-color);
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #FFFFFF;
        }
        
        .header-logo {
            max-width: 265px;
            height: auto;
            display: block;
        }
        
        .form-logo {
            width: 120px;
            margin-right: 20px;
        }
        
        .form-title {
            font-size: 28px;
            font-weight: 600;
            font-family: var(--font-primary);
            letter-spacing: -0.02em;
            color: var(--primary-color);
        }
        
        .form-content {
            padding: 30px 38px;
        }
        
        .form-section-header {
            margin-top: 25px;
            margin-bottom: 24px;
        }
        
        .form-section-title {
            font-size: 22px;
            font-weight: 600;
            margin-bottom: 5px;
            font-family: var(--font-primary);
            color: var(--primary-color);
            letter-spacing: -0.01em;
  position: relative;
            padding-bottom: 8px;
        }
        
        .form-section-title:after {
            content: "";
            position: absolute;
            bottom: 0;
  left: 0;
            width: 40px;
            height: 3px;
            background-color: var(--secondary-color);
            border-radius: 3px;
        }
        
        .divider {
            height: 1px;
            background-color: var(--divider-color);
            margin: 25px 0;
        }
        
        .form-row {
            margin-bottom: 15px;
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .form-group {
            flex: 1;
            min-width: 250px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            font-size: 14px;
            font-family: var(--font-primary);
        }
        
        .form-label.required::after {
            content: " *";
            color: var(--error-color);
            font-weight: bold;
        }
        
        .required-note {
            font-size: 13px;
            color: var(--sub-text-color);
            margin-bottom: 15px;
            font-style: italic;
            text-align: right;
        }
        
        .required-note span {
            color: var(--error-color);
            font-weight: bold;
        }
        
        .form-control {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--input-border);
            border-radius: 6px;
            font-size: 15px;
            transition: all 0.3s ease;
            font-family: var(--font-light);
        }
        
        .form-control:hover {
            border-color: rgba(195, 202, 216, 0.5);
            box-shadow: 0 0 0 2px rgba(195, 202, 216, 0.25);
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--input-focus-border);
            box-shadow: 0 0 0 3px var(--input-focus-shadow);
        }
        
        select.form-control {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="%23666" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>');
  background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 16px;
            padding-right: 36px;
            font-family: var(--font-light);
        }
        
        .radio-group, .checkbox-group {
            display: flex;
            gap: 20px;
            margin-top: 5px;
        }
        
        .radio-item, .checkbox-item {
            display: flex;
            align-items: center;
            cursor: pointer;
        }
        
        .radio-input, .checkbox-input {
            margin-right: 8px;
        }
        
        .radio-label, .checkbox-label {
            font-size: 14px;
            font-family: var(--font-light);
        }
        
        .form-textarea {
            min-height: 100px;
            font-family: var(--font-light);
        }
        
        .form-hint {
            display: block;
            font-size: 12px;
            color: var(--sub-text-color);
            margin-top: 4px;
            font-family: var(--font-light);
        }
        
        .form-submit {
            text-align: right;
            margin-top: 30px;
        }
        
        .btn-submit {
            background-color: var(--secondary-color);
            color: white;
            border: none;
            border-radius: 6px;
            padding: 12px 30px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.3s ease;
            font-family: var(--font-primary);
        }
        
        .btn-submit:hover {
            background-color: var(--submit-hover);
        }
        
        .error {
            color: var(--error-color);
            font-size: 12px;
            margin-top: 4px;
            font-family: var(--font-light);
        }
        
        .form-control.error {
            border-color: var(--error-color);
            background-color: var(--error-bg);
        }
        
        /* Estilo para indicador de carregamento no campo CEP */
        .form-control.loading {
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 38 38" stroke="rgba(0,0,0,0.5)"><g fill="none" fill-rule="evenodd"><g transform="translate(1 1)" stroke-width="2"><circle stroke-opacity=".25" cx="18" cy="18" r="18"/><path d="M36 18c0-9.94-8.06-18-18-18"><animateTransform attributeName="transform" type="rotate" from="0 18 18" to="360 18 18" dur="1s" repeatCount="indefinite"/></path></g></g></svg>');
            background-repeat: no-repeat;
            background-position: right 10px center;
            background-size: 20px;
            padding-right: 40px;
        }
        
        /* Estilos para mensagens de erro */
        .error-message {
            color: var(--error-color);
            font-size: 12px;
            margin-top: 4px;
            font-family: var(--font-light);
        }
        
        /* Estilos para validação de CEP */
        .form-control.cep-valido {
            border-color: var(--secondary-color) !important;
            background-color: rgba(15, 117, 188, 0.1) !important;
        }
        
        /* Estilo para as abas */
        .form-tabs {
            display: flex;
            border-bottom: 1px solid var(--divider-color);
            background-color: var(--light-color);
        }
        
        .form-tab {
            padding: 15px 20px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            color: var(--sub-text-color);
            flex: 1;
            text-align: center;
        }
        
        .form-tab.active {
            border-bottom-color: var(--secondary-color);
            color: var(--primary-color);
            background-color: #fff;
        }
        
        .form-tab:hover:not(.active) {
            background-color: rgba(15, 117, 188, 0.05);
            color: var(--secondary-color);
        }
        
        /* Estilo para o conteúdo das abas */
        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* Estilo para os botões de navegação entre as abas */
        .nav-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        
        .nav-button {
            background-color: var(--secondary-color);
            color: white;
            border: none;
            border-radius: 6px;
            padding: 10px 20px;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        
        .nav-button:hover {
            background-color: var(--hover-color);
        }
        
        .nav-button.prev {
            background-color: var(--light-color);
            color: var(--secondary-color);
        }
        
        .nav-button.prev:hover {
            background-color: var(--divider-color);
        }
        
        .btn-submit {
            background-color: var(--secondary-color);
            color: white;
            border: none;
            border-radius: 6px;
            padding: 12px 30px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.3s ease;
            font-family: var(--font-primary);
        }
        
        .btn-submit:hover {
            background-color: var(--submit-hover);
        }
        
        /* Ajuste responsivo */
        @media (max-width: 576px) {
            .form-tab {
                padding: 12px 10px;
                font-size: 14px;
            }
            
            /* Ícones para as abas no mobile */
            .form-tab[data-tab="tab-1"]::before {
                content: "";
                display: none;
            }
            
            .form-tab[data-tab="tab-2"]::before {
                content: "";
                display: none;
            }
            
            .form-tab[data-tab="tab-3"]::before {
                content: "";
                display: none;
            }
            
            .form-tab[data-tab="tab-4"]::before {
                content: "";
                display: none;
            }
            
            .form-tabs {
                position: sticky;
                top: 0;
                z-index: 100;
                box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            }
            
            .nav-button, .btn-submit {
                padding: 12px 24px;
                font-size: 16px;
                width: 48%;  /* Ligeiramente aumentado para ficar melhor em telas menores */
                height: 50px;
                display: flex;
                align-items: center;
                justify-content: center;
                text-align: center;
                margin: 0;
            }
            
            .form-container {
                border-radius: 10px;
                overflow: hidden;
                margin: 10px;
                width: calc(100% - 20px);
                max-width: 100%;
            }
            
            .nav-buttons {
                display: flex;
                justify-content: space-between;
                margin-top: 30px;
                width: 100%;
                gap: 10px;
            }
        }
        
        @media (max-width: 768px) {
            .form-header {
                padding: 20px;
                flex-direction: column;
                text-align: center;
            }
            
            .header-logo {
                max-width: 200px;
                margin-bottom: 10px;
            }
            
            .form-logo {
                margin-right: 0;
                margin-bottom: 15px;
            }
            
            .form-content {
                padding: 16px;
            }
            
            .form-group {
                flex: 1 0 100%;
            }
            
            .form-control {
                padding: 14px;
                font-size: 16px; /* Fonte maior para facilitar a leitura no mobile */
            }
            
            input[type="file"].form-control {
                padding: 10px;
            }
            
            .form-row {
                margin-bottom: 20px;
            }
            
            body {
                padding: 0;
            }

            /* Aumenta o tamanho dos botões de rádio e checkbox para facilitar o toque */
            .radio-input, .checkbox-input {
                width: 20px;
                height: 20px;
                margin-right: 10px;
            }
            
            .radio-label, .checkbox-label {
                font-size: 16px;
            }
            
            .radio-group, .checkbox-group {
                flex-direction: column;
                gap: 12px;
            }
            
            .radio-item, .checkbox-item {
                padding: 6px 0;
            }
            
            /* Estilo unificado para botões em dispositivos móveis */
            .nav-button, .btn-submit {
                height: 50px;
                width: 48%;  /* Ligeiramente aumentado para ficar melhor em telas maiores */
                padding: 0 15px;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 16px;
                text-align: center;
                margin: 0;
            }
            
            .nav-buttons {
                display: flex;
                justify-content: space-between;
                margin-top: 30px;
                width: 100%;
                gap: 10px;
            }
        }
        
        /* Media query específica para dispositivos muito pequenos */
        @media (max-width: 360px) {
            .form-tab {
                padding: 8px 5px;
                font-size: 12px;
            }
            
            .form-content {
                padding: 12px;
            }
            
            .form-section-title {
                font-size: 18px;
            }
        }
        
        /* Otimizações para orientação paisagem em dispositivos móveis */
        @media (max-width: 768px) and (orientation: landscape) {
            .form-container {
                max-width: 90%;
                margin: 10px auto;
            }
            
            .form-header {
                padding: 15px;
            }
            
            .form-row {
                flex-wrap: nowrap;
            }
            
            .form-group {
                flex: 1 0 auto;
                min-width: auto;
            }
            
            .tab-content {
                max-height: 70vh;
                overflow-y: auto;
                padding-bottom: 20px;
            }
            
            .form-tabs {
                position: sticky;
                top: 0;
                z-index: 100;
            }
        }
        
        /* Melhorias para acessibilidade de toque */
        @media (hover: none) and (pointer: coarse) {
            .form-control,
            .nav-button,
            .btn-submit,
            select,
            input[type="file"],
            .radio-item,
            .checkbox-item {
                cursor: pointer;
                touch-action: manipulation;
            }
            
            /* Previne zoom no foco em iOS */
            input, 
            select, 
            textarea {
                font-size: 16px !important;
            }
            
            /* Aumenta área de toque */
            .form-tab,
            .nav-button,
            .btn-submit,
            select,
            .radio-item,
            .checkbox-item,
            input[type="file"] {
                min-height: 44px;
            }
        }
        
        /* Estilos para o campo de telefone com seletor de país */
        .phone-input-container {
            display: flex;
            align-items: stretch;
            width: 100%;
            position: relative;
        }

        .country-select {
            width: 90px;
            border: 1px solid var(--input-border);
            border-radius: 6px 0 0 6px;
            border-right: none;
            background-color: var(--light-color);
            display: flex;
            align-items: center;
            padding: 0 8px;
            cursor: pointer;
        }
        
        /* Estilos para campo com erro de caracteres especiais */
        .special-char-error {
            border-color: var(--error-color) !important;
            background-color: var(--error-bg) !important;
        }
        
        .country-select:hover {
            background-color: var(--divider-color);
        }

        .country-select img {
            width: 24px;
            height: 16px;
            margin-right: 4px;
            border-radius: 2px;
        }

        .country-select .country-code {
            font-size: 14px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            flex: 1;
        }

        .country-select .dropdown-icon {
            margin-left: 2px;
            opacity: 0.5;
            font-size: 12px;
        }

        .phone-input-container .form-control {
            flex: 1;
            border-radius: 0 6px 6px 0;
        }

        .country-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            width: 240px;
            max-height: 132px; /* Alterado para mostrar aproximadamente 3 países (44px por país) */
            overflow-y: auto;
            background-color: white;
            border: 1px solid var(--input-border);
            border-radius: 6px;
            z-index: 1000;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            display: none;
        }

        .country-dropdown.active {
            display: block;
        }

        .country-item {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            height: 44px; /* Altura fixa para cada item */
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .country-item:hover {
            background-color: var(--background-color);
        }

        .country-item img {
            width: 24px;
            height: 16px;
            margin-right: 8px;
            border-radius: 2px;
        }

        .country-item .country-name {
            font-size: 14px;
            flex: 1;
        }

        .country-item .country-dial-code {
            font-size: 13px;
            color: var(--sub-text-color);
        }

        /* Indica o país selecionado atualmente */
        .country-item.selected {
            background-color: rgba(15, 117, 188, 0.1);
        }

        /* Estilo telefone válido */
        .form-control.phone-valid {
            border-color: var(--secondary-color);
            background-color: rgba(15, 117, 188, 0.05);
        }
        
        /* Estilo para campos preenchidos automaticamente */
        .form-control.auto-filled {
            border-color: var(--secondary-color);
            background-color: rgba(15, 117, 188, 0.05);
            cursor: not-allowed;
        }
        
        /* Adiciona efeito sutil para indicar campos desabilitados mas com valor */
        .form-control:disabled {
            opacity: 0.8;
            cursor: not-allowed;
        }

        /* Adicionar aqui a regra para abas desabilitadas */
        .form-tab.disabled {
            opacity: 0.5;
            cursor: not-allowed;
            pointer-events: none;
        }

        /* Autocomplete suggestions container */
        .autocomplete-suggestions {
            position: absolute;
            border: 1px solid var(--input-border);
            border-top: none;
            z-index: 999;
            top: 100%; /* Position below the input */
            left: 0;
            right: 0;
            background-color: #fff;
            max-height: 200px; 
            overflow-y: auto;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            border-radius: 0 0 6px 6px;
            display: none; /* Initially hidden */
        }

        .autocomplete-suggestions div {
            padding: 10px 12px;
            cursor: pointer;
            border-bottom: 1px solid var(--divider-color);
            font-family: var(--font-light);
            font-size: 14px;
            text-align: left; /* Ensure text is aligned left */
        }
        .autocomplete-suggestions div:last-child {
            border-bottom: none;
        }

        .autocomplete-suggestions div:hover,
        .autocomplete-suggestions div.active { /* 'active' class for keyboard navigation */
            background-color: var(--background-color);
            color: var(--primary-color);
        }
    </style>
</head>
<body>
    <div class="form-container">
        <div class="form-header">
            <img src="https://static.wixstatic.com/media/056676_38b0c30273f94ab8b386921f459c7b91~mv2.png/v1/crop/x_0,y_9,w_2300,h_347/fill/w_265,h_40,al_c,q_85,usm_0.66_1.00_0.01,enc_avif,quality_auto/_edited.png" alt="Persevera Logo" class="header-logo">
        </div>
        <form id="cadastro-form" class="jotform-form" method="post" action="https://submit.jotform.com/submit/250986205951665">
            <input type="hidden" name="formID" value="250986205951665">
            
            <div class="form-content">
                <!-- Navegação por abas -->
                <div class="form-tabs">
                    <div class="form-tab active" data-tab="tab-1">Dados Pessoais</div>
                    <div class="form-tab" data-tab="tab-2">Contato</div>
                    <div class="form-tab" data-tab="tab-3">Envio de Documentos</div>
                    <div class="form-tab" data-tab="tab-4">Conformidade e Termos</div>
                </div>
                
                <!-- Seção de Dados Pessoais -->
                <div id="tab-1" class="tab-content active">
                    <div class="form-section-header">
                        <h2 class="form-section-title">Dados Pessoais</h2>
                    </div>
                    
                    <div class="required-note">
                        <span>*</span> Campos obrigatórios
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label required" for="input_94">Nome Completo</label>
                            <input type="text" id="input_94" name="q94_nomeCompleto" class="form-control" required>
                        </div>

                        <div class="form-group">
                            <label class="form-label required" for="input_95">CPF</label>
                            <input type="text" id="input_95" name="q95_cpf" class="form-control" placeholder="000.000.000-00" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label required" for="input_102">Sexo</label>
                            <select class="form-control" id="input_102" name="q102_sexo" required>
                                <option value="">Selecione</option>
                                <option value="Masculino">Masculino</option>
                                <option value="Feminino">Feminino</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label required" for="input_103">Estado Civil</label>
                            <select class="form-control" id="input_103" name="q103_estadoCivil" required>
                                <option value="">Selecione</option>
                                <option value="Solteiro(a)">Solteiro(a)</option>
                                <option value="Casado(a)">Casado(a)</option>
                                <option value="Divorciado(a)">Divorciado(a)</option>
                                <option value="Viúvo(a)">Viúvo(a)</option>
                                <option value="União Estável">União Estável</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label required" for="input_238">Ocupação Profissional</label>
                            <input type="text" id="input_238" name="q238_ocupacaoProfissional" class="form-control" placeholder="exemplo: Engenheiro, Advogado, etc." required>
                        </div>

                        <div class="form-group">
                            <label class="form-label required" for="input_96">Nacionalidade</label>
                            <input type="text" id="input_96" name="q96_nacionalidade" class="form-control" value="Brasileiro(a)" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label required" for="input_97">Naturalidade</label>
                            <input type="text" id="input_97" name="q97_naturalidade" class="form-control" placeholder="Cidade e Estado de Nascimento" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label required" for="input_104">Data de Nascimento</label>
                            <input type="text" id="input_104" name="q104_dataNascimento[full]" class="form-control" placeholder="DD/MM/AAAA" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label required" for="input_105">Tipo de Documento</label>
                            <select class="form-control" id="input_105" name="q105_tipoDocumento" required>
                                <option value="">Selecione</option>
                                <option value="RG">RG</option>
                                <option value="CNH">CNH</option>
                                <option value="Passaporte">Passaporte</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label required" for="input_98">Nº do Documento</label>
                            <input type="text" id="input_98" name="q98_numeroDocumento" class="form-control" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label required" for="input_106">Data de Expedição</label>
                            <input type="text" id="input_106" name="q106_dataExpedicao[full]" class="form-control" placeholder="DD/MM/AAAA" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label required" for="input_99">Órgão Emissor</label>
                            <input type="text" id="input_99" name="q99_orgaoEmissor" class="form-control" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label required" for="input_100">Nome da Mãe</label>
                            <input type="text" id="input_100" name="q100_nomeMae" class="form-control" required>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="input_101">Nome do Pai</label>
                            <input type="text" id="input_101" name="q101_nomePai" class="form-control">
                        </div>
                    </div>
                    
                    <div class="form-section-header">
                        <h2 class="form-section-title">Dados do Cônjuge</h2>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label" for="input_225">Nome Completo</label>
                            <input type="text" id="input_225" name="q225_nomeCompletoConjuge" class="form-control">
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="input_228">CPF</label>
                            <input type="text" id="input_228" name="q228_cpfConjuge" class="form-control" placeholder="000.000.000-00">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label" for="input_226">Sexo</label>
                            <select class="form-control" id="input_226" name="q226_sexoConjuge">
                                <option value="">Selecione</option>
                                <option value="Masculino">Masculino</option>
                                <option value="Feminino">Feminino</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="input_227">Estado Civil</label>
                            <select class="form-control" id="input_227" name="q227_estadoCivilConjuge">
                                <option value="">Selecione</option>
                                <option value="Solteiro(a)">Solteiro(a)</option>
                                <option value="Casado(a)">Casado(a)</option>
                                <option value="Divorciado(a)">Divorciado(a)</option>
                                <option value="Viúvo(a)">Viúvo(a)</option>
                                <option value="União Estável">União Estável</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label required" for="input_239">Ocupação Profissional</label>
                            <input type="text" id="input_239" name="q239_ocupacaoProfissionalConjuge" class="form-control" placeholder="exemplo: Engenheiro, Advogado, etc." required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="input_229">Nacionalidade</label>
                            <input type="text" id="input_229" name="q229_nacionalidadeConjuge" class="form-control" value="Brasileiro(a)">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label" for="input_230">Naturalidade</label>
                            <input type="text" id="input_230" name="q230_naturalidadeConjuge" class="form-control" placeholder="Cidade e Estado de Nascimento">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="input_231">Data de Nascimento</label>
                            <input type="text" id="input_231" name="q231_dataNascimentoConjuge[full]" class="form-control" placeholder="DD/MM/AAAA">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label" for="input_232">Tipo de Documento</label>
                            <select class="form-control" id="input_232" name="q232_tipoDocumentoConjuge">
                                <option value="">Selecione</option>
                                <option value="RG">RG</option>
                                <option value="CNH">CNH</option>
                                <option value="Passaporte">Passaporte</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="input_233">Nº do Documento</label>
                            <input type="text" id="input_233" name="q233_numeroDocumentoConjuge" class="form-control">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label" for="input_234">Data de Expedição</label>
                            <input type="text" id="input_234" name="q234_dataExpedicaoConjuge[full]" class="form-control" placeholder="DD/MM/AAAA">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="input_235">Órgão Emissor</label>
                            <input type="text" id="input_235" name="q235_orgaoEmissorConjuge" class="form-control">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label" for="input_236">Nome da Mãe</label>
                            <input type="text" id="input_236" name="q236_nomeMaeConjuge" class="form-control">
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="input_237">Nome do Pai</label>
                            <input type="text" id="input_237" name="q237_nomePaiConjuge" class="form-control">
                        </div>
                    </div>
                    
                    <div class="nav-buttons">
                        <div></div> <!-- Espaço vazio para alinhamento -->
                        <button type="button" class="nav-button next-tab" data-next="tab-2">Próximo</button>
                    </div>
                </div>
                
                <!-- Seção de Contato -->
                <div id="tab-2" class="tab-content">
                    <div class="form-section-header">
                        <h2 class="form-section-title">Contato</h2>
                    </div>
                    
                    <div class="required-note">
                        <span>*</span> Campos obrigatórios
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label required" for="input_118">Telefone</label>
                            <div class="phone-input-container">
                                <div id="country-select" class="country-select">
                                    <img src="https://flagcdn.com/br.svg" alt="Brasil" id="selected-flag">
                                    <span class="country-code" id="selected-code">+55</span>
                                    <span class="dropdown-icon">▼</span>
                                </div>
                                <input type="tel" id="input_118" name="q118_telefone" class="form-control" placeholder="(00) 00000-0000" required>
                                <!-- Campo oculto para armazenar o código do país -->
                                <input type="hidden" id="input_118_country_code" value="+55">
                                <div id="country-dropdown" class="country-dropdown">
                                    <!-- Lista de países será gerada via JavaScript -->
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label required" for="input_117">E-mail</label>
                            <input type="email" id="input_117" name="q117_email" class="form-control" placeholder="exemplo@exemplo.com" required>
                        </div>
                    </div>
                    
                    <div class="form-section-header">
                        <h3 class="form-section-title">Endereço de Residência</h3>
                    </div>
                                        
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label required" for="input_215">CEP</label>
                            <input type="text" id="input_215" name="q215_cepResidencia" class="form-control" placeholder="00000-000" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label required" for="input_216">Logradouro</label>
                            <input type="text" id="input_216" name="q216_logradouroResidencia" class="form-control" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label required" for="input_217">Número</label>
                            <input type="text" id="input_217" name="q217_numeroResidencia" class="form-control" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="input_219">Complemento</label>
                            <input type="text" id="input_219" name="q219_complementoResidencia" class="form-control">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label required" for="input_220">Bairro</label>
                            <input type="text" id="input_220" name="q220_bairroResidencia" class="form-control" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label required" for="input_221">Cidade</label>
                            <input type="text" id="input_221" name="q221_cidadeResidencia" class="form-control" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label required" for="input_222">Estado</label>
                            <select class="form-control" id="input_222" name="q222_estadoResidencia" required>
                                <option value="">Selecione</option>
                                <option value="AC">Acre</option>
                                <option value="AL">Alagoas</option>
                                <option value="AP">Amapá</option>
                                <option value="AM">Amazonas</option>
                                <option value="BA">Bahia</option>
                                <option value="CE">Ceará</option>
                                <option value="DF">Distrito Federal</option>
                                <option value="ES">Espírito Santo</option>
                                <option value="GO">Goiás</option>
                                <option value="MA">Maranhão</option>
                                <option value="MT">Mato Grosso</option>
                                <option value="MS">Mato Grosso do Sul</option>
                                <option value="MG">Minas Gerais</option>
                                <option value="PA">Pará</option>
                                <option value="PB">Paraíba</option>
                                <option value="PR">Paraná</option>
                                <option value="PE">Pernambuco</option>
                                <option value="PI">Piauí</option>
                                <option value="RJ">Rio de Janeiro</option>
                                <option value="RN">Rio Grande do Norte</option>
                                <option value="RS">Rio Grande do Sul</option>
                                <option value="RO">Rondônia</option>
                                <option value="RR">Roraima</option>
                                <option value="SC">Santa Catarina</option>
                                <option value="SP">São Paulo</option>
                                <option value="SE">Sergipe</option>
                                <option value="TO">Tocantins</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-section-header">
                        <h3 class="form-section-title">Endereço de Correspondência</h3>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group" style="width: 100%;">
                            <label class="checkbox-item">
                                <input type="checkbox" id="same-address" class="checkbox-input">
                                <span class="checkbox-label">O endereço de correspondência é o mesmo que o endereço de residência</span>
                            </label>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label required" for="input_108">CEP</label>
                            <input type="text" id="input_108" name="q108_cepCorrespondencia" class="form-control" placeholder="00000-000" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label required" for="input_109">Logradouro</label>
                            <input type="text" id="input_109" name="q109_logradouroCorrespondencia" class="form-control" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label required" for="input_112">Número</label>
                            <input type="text" id="input_112" name="q112_numeroCorrespondencia" class="form-control" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="input_113">Complemento</label>
                            <input type="text" id="input_113" name="q113_complementoCorrespondencia" class="form-control">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label required" for="input_111">Bairro</label>
                            <input type="text" id="input_111" name="q111_bairroCorrespondencia" class="form-control" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label required" for="input_110">Cidade</label>
                            <input type="text" id="input_110" name="q110_cidadeCorrespondencia" class="form-control" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label required" for="input_114">Estado</label>
                            <select class="form-control" id="input_114" name="q114_estadoCorrespondencia" required>
                                <option value="">Selecione</option>
                                <option value="AC">Acre</option>
                                <option value="AL">Alagoas</option>
                                <option value="AP">Amapá</option>
                                <option value="AM">Amazonas</option>
                                <option value="BA">Bahia</option>
                                <option value="CE">Ceará</option>
                                <option value="DF">Distrito Federal</option>
                                <option value="ES">Espírito Santo</option>
                                <option value="GO">Goiás</option>
                                <option value="MA">Maranhão</option>
                                <option value="MT">Mato Grosso</option>
                                <option value="MS">Mato Grosso do Sul</option>
                                <option value="MG">Minas Gerais</option>
                                <option value="PA">Pará</option>
                                <option value="PB">Paraíba</option>
                                <option value="PR">Paraná</option>
                                <option value="PE">Pernambuco</option>
                                <option value="PI">Piauí</option>
                                <option value="RJ">Rio de Janeiro</option>
                                <option value="RN">Rio Grande do Norte</option>
                                <option value="RS">Rio Grande do Sul</option>
                                <option value="RO">Rondônia</option>
                                <option value="RR">Roraima</option>
                                <option value="SC">Santa Catarina</option>
                                <option value="SP">São Paulo</option>
                                <option value="SE">Sergipe</option>
                                <option value="TO">Tocantins</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="nav-buttons">
                        <button type="button" class="nav-button prev prev-tab" data-prev="tab-1" tabindex="-1">Anterior</button>
                        <button type="button" class="nav-button next-tab" data-next="tab-3">Próximo</button>
                    </div>
                </div>
                
                <!-- Seção de Envio de Documentos -->
                <div id="tab-3" class="tab-content">
                    <div class="form-section-header">
                        <h2 class="form-section-title">Envio de Documentos</h2>
                    </div>
                    
                    <div class="required-note">
                        <span>*</span> Campos obrigatórios
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label required" for="input_127">Documento de Identidade (com CPF)</label>
                            <input type="file" id="input_127" name="q127_envioDocumentoIdentidade[]" class="form-control" accept=".pdf,.doc,.docx,.jpg,.jpeg,.png,.gif,.html" multiple required>
                            <span class="form-hint">Formatos aceitos: PDF, DOC, DOCX, JPG, JPEG, PNG, GIF, HTML</span>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label required" for="input_128">Comprovante de Residência (válido por até 3 meses)</label>
                            <input type="file" id="input_128" name="q128_envioComprovanteResidencia[]" class="form-control" accept=".pdf,.doc,.docx,.jpg,.jpeg,.png,.gif,.html" required>
                            <span class="form-hint">Formatos aceitos: PDF, DOC, DOCX, JPG, JPEG, PNG, GIF, HTML</span>
                        </div>
                    </div>
                    
                    <div class="nav-buttons">
                        <button type="button" class="nav-button prev prev-tab" data-prev="tab-2">Anterior</button>
                        <button type="button" class="nav-button next-tab" data-next="tab-4">Próximo</button>
                    </div>
                </div>
                
                <!-- Seção de Conformidade e Termos -->
                <div id="tab-4" class="tab-content">
                    <div class="form-section-header">
                        <h2 class="form-section-title">Conformidade e Termos</h2>
                    </div>
                    
                    <div class="required-note">
                        <span>*</span> Campos obrigatórios
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label required">Você é uma Pessoa Politicamente Exposta (PPE)?</label>
                            <div class="radio-group">
                                <label class="radio-item">
                                    <input type="radio" name="q121_pessoaPoliticaExposta" value="Sim" class="radio-input" required>
                                    <span class="radio-label">Sim</span>
                                </label>
                                <label class="radio-item">
                                    <input type="radio" name="q121_pessoaPoliticaExposta" value="Não" class="radio-input" required>
                                    <span class="radio-label">Não</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label required">Você é parente ou possui relacionamento próximo com uma Pessoa Politicamente Exposta?</label>
                            <div class="radio-group">
                                <label class="radio-item">
                                    <input type="radio" name="q122_parentePessoaPoliticaExposta" value="Sim" class="radio-input" required>
                                    <span class="radio-label">Sim</span>
                                </label>
                                <label class="radio-item">
                                    <input type="radio" name="q122_parentePessoaPoliticaExposta" value="Não" class="radio-input" required>
                                    <span class="radio-label">Não</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label" for="input_123">Se respondeu "Sim" a alguma das perguntas acima, forneça detalhes:</label>
                            <textarea id="input_123" name="q123_seSim" class="form-control form-textarea"></textarea>
                        </div>
                    </div>
                    
                    <div class="form-section-header">
                        <h3 class="form-section-title">Relacionamento com outros países</h3>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label required">Você atesta que nasceu, é cidadão, possui nacionalidade, residência permanente ou domicílio fiscal diferente de Brasil?</label>
                            <div class="radio-group">
                                <label class="radio-item">
                                    <input type="radio" name="q129_cidadaoBrasileiro" value="Sim" class="radio-input" required>
                                    <span class="radio-label">Sim</span>
                                </label>
                                <label class="radio-item">
                                    <input type="radio" name="q129_cidadaoBrasileiro" value="Não" class="radio-input" required>
                                    <span class="radio-label">Não</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-section-header">
                        <h3 class="form-section-title">Origem dos Recursos</h3>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label required">Declaração de Origem dos Recursos</label>
                            <div class="checkbox-group" style="flex-direction: column;">
                                <label class="checkbox-item">
                                    <input type="checkbox" name="q124_declaracaoOrigemRecursos[]" value="Declaro que os recursos a serem investidos são próprios e de origem lícita" class="checkbox-input" required>
                                    <span class="checkbox-label">Declaro que os recursos a serem investidos são próprios e de origem lícita</span>
                                </label>
                                <label class="checkbox-item">
                                    <input type="checkbox" name="q124_declaracaoOrigemRecursos[]" value="Declaro que estou ciente das normas e regulamentos da CVM e do Banco Central do Brasil" class="checkbox-input" required>
                                    <span class="checkbox-label">Declaro que estou ciente das normas e regulamentos da CVM e do Banco Central do Brasil</span>
                                </label>
                                <label class="checkbox-item">
                                    <input type="checkbox" name="q124_declaracaoOrigemRecursos[]" value="Declaro que li e aceito os termos e condições dos fundos de investimento" class="checkbox-input" required>
                                    <span class="checkbox-label">Declaro que li e aceito os termos e condições dos fundos de investimento</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="nav-buttons">
                        <button type="button" class="nav-button prev prev-tab" data-prev="tab-3">Anterior</button>
                        <button type="submit" class="btn-submit" id="submit-button">Enviar</button>
                    </div>
                    
                    <input type="hidden" class="simple_spc" id="simple_spc" name="simple_spc" value="250986205951665">
                </div>
            </div>
            
            <!-- Campos ocultos para processamento de datas pelo JotForm -->
            <div style="display:none">
                <!-- Campos ocultos para Data de Nascimento -->
                <input type="hidden" id="day_104" name="q104_dataNascimento[day]" />
                <input type="hidden" id="month_104" name="q104_dataNascimento[month]" />
                <input type="hidden" id="year_104" name="q104_dataNascimento[year]" />
                
                <!-- Campos ocultos para Data de Expedição -->
                <input type="hidden" id="day_106" name="q106_dataExpedicao[day]" />
                <input type="hidden" id="month_106" name="q106_dataExpedicao[month]" />
                <input type="hidden" id="year_106" name="q106_dataExpedicao[year]" />
                
                <!-- Campos ocultos para Data de Nascimento do Cônjuge -->
                <input type="hidden" id="day_231" name="q231_dataNascimentoConjuge[day]" />
                <input type="hidden" id="month_231" name="q231_dataNascimentoConjuge[month]" />
                <input type="hidden" id="year_231" name="q231_dataNascimentoConjuge[year]" />
                
                <!-- Campos ocultos para Data de Expedição do Cônjuge -->
                <input type="hidden" id="day_234" name="q234_dataExpedicaoConjuge[day]" />
                <input type="hidden" id="month_234" name="q234_dataExpedicaoConjuge[month]" />
                <input type="hidden" id="year_234" name="q234_dataExpedicaoConjuge[year]" />
            </div>
        </form>
    </div>
    
    <script>
        // Formatação de campos
        document.addEventListener('DOMContentLoaded', function() {
            console.log('[INIT] Inicialização do formulário');
            // Detectar se o dispositivo é mobile
            const isMobile = window.innerWidth < 768;
            console.log('[INIT] Dispositivo mobile:', isMobile);
            
            // Atualização final do telefone completo antes do envio do formulário
            const form = document.getElementById('cadastro-form');
            if (form) {
                form.addEventListener('submit', function(e) {
                    // Prevenir o envio padrão do formulário para garantir que nosso código execute antes
                    e.preventDefault();
                    console.log('[Submit Event] Evento submit do formulário acionado');
                    
                    // Obter o campo de telefone e o código do país
                    const phoneInput = document.getElementById('input_118');
                    const countryCodeEl = document.getElementById('selected-code');
                    
                    if (phoneInput && phoneInput.value.trim() && countryCodeEl) {
                        // Extrair apenas os dígitos numéricos do telefone
                        const numericValue = phoneInput.value.replace(/\D/g, '');
                        // Obter o código do país
                        const countryCode = countryCodeEl.textContent;
                        // Atualizar o valor do campo de telefone para incluir o código do país
                        phoneInput.value = countryCode + numericValue;
                        
                        console.log('[Submit Event] Telefone que será enviado:', phoneInput.value);
                    }
                    
                    // Continuar com o envio do formulário após um pequeno delay
                    console.log('[Submit Event] Preparando para enviar o formulário após delay...');
                    setTimeout(() => {
                        try {
                            console.log('[Submit Event] Enviando formulário agora...');
                            // Usar um método alternativo de envio
                            const jotformSubmitUrl = form.getAttribute('action');
                            if (jotformSubmitUrl) {
                                console.log('[Submit Event] URL do JotForm encontrada:', jotformSubmitUrl);
                                // Enviar o formulário normalmente
                                form.submit();
                            } else {
                                console.error('[Submit Event] URL do JotForm não encontrada!');
                            }
                        } catch (error) {
                            console.error('[Submit Event] Erro ao enviar formulário:', error);
                            
                            // Tente uma abordagem alternativa de envio
                            console.log('[Submit Event] Tentando abordagem alternativa...');
                            const oldAction = form.action;
                            form.removeAttribute('onsubmit');
                            const inputs = form.querySelectorAll('input, select, textarea');
                            inputs.forEach(input => {
                                if (input.name && !input.value && input.type !== 'submit') {
                                    input.disabled = true;
                                }
                            });
                            form.submit();
                        }
                    }, 100);
                });
            }
            
            // Personalizar experiência baseado no tipo de dispositivo
            if (isMobile) {
                // Adicionar tipo de input apropriado para dispositivos móveis
                document.getElementById('input_104').setAttribute('inputmode', 'numeric');
                document.getElementById('input_106').setAttribute('inputmode', 'numeric');
                document.getElementById('input_95').setAttribute('inputmode', 'numeric');
                document.getElementById('input_108').setAttribute('inputmode', 'tel');
                document.getElementById('input_118').setAttribute('inputmode', 'tel');
                document.getElementById('input_117').setAttribute('inputmode', 'email');
                document.getElementById('input_215').setAttribute('inputmode', 'tel');
                document.getElementById('input_231').setAttribute('inputmode', 'numeric');
                document.getElementById('input_234').setAttribute('inputmode', 'numeric');
                
                // Adiciona autocapitalize para campos de nome
                document.getElementById('input_94').setAttribute('autocapitalize', 'words');
                document.getElementById('input_100').setAttribute('autocapitalize', 'words');
                document.getElementById('input_101').setAttribute('autocapitalize', 'words');
                document.getElementById('input_225').setAttribute('autocapitalize', 'words');
                document.getElementById('input_236').setAttribute('autocapitalize', 'words');
                document.getElementById('input_237').setAttribute('autocapitalize', 'words');
                
                // Adiciona autocomplete para campos apropriados
                document.getElementById('input_94').setAttribute('autocomplete', 'name');
                document.getElementById('input_117').setAttribute('autocomplete', 'email');
                document.getElementById('input_118').setAttribute('autocomplete', 'tel');
                document.getElementById('input_108').setAttribute('autocomplete', 'postal-code');
                document.getElementById('input_109').setAttribute('autocomplete', 'address-line1');
                document.getElementById('input_110').setAttribute('autocomplete', 'address-level2');
                document.getElementById('input_215').setAttribute('autocomplete', 'postal-code');
                document.getElementById('input_216').setAttribute('autocomplete', 'address-line1');
                document.getElementById('input_221').setAttribute('autocomplete', 'address-level2');
                
                // Aumenta a área clicável das abas
                const tabs = document.querySelectorAll('.form-tab');
                tabs.forEach(tab => {
                    tab.style.minHeight = '60px';
                });
                
                // Ajusta a interface com base na orientação do dispositivo
                function handleOrientationChange() {
                    const isLandscape = window.innerWidth > window.innerHeight;
                    const formRows = document.querySelectorAll('.form-row');
                    
                    if (isLandscape) {
                        // Ajustes para modo paisagem
                        formRows.forEach(row => {
                            row.style.flexWrap = 'nowrap';
                        });
                        
                        // Garantir que o conteúdo da aba tenha scroll próprio
                        document.querySelectorAll('.tab-content').forEach(tab => {
                            tab.style.maxHeight = '70vh';
                            tab.style.overflowY = 'auto';
                        });
                    } else {
                        // Ajustes para modo retrato
                        formRows.forEach(row => {
                            row.style.flexWrap = 'wrap';
                        });
                        
                        document.querySelectorAll('.tab-content').forEach(tab => {
                            tab.style.maxHeight = '';
                            tab.style.overflowY = '';
                        });
                    }
                }
                
                // Verificar orientação inicial
                handleOrientationChange();
                
                // Atualizar quando houver mudança na orientação
                window.addEventListener('resize', handleOrientationChange);
                window.addEventListener('orientationchange', handleOrientationChange);
            }
            
            // Tab Navigation Code
            const tabs = document.querySelectorAll('.form-tab');
            const tabContents = document.querySelectorAll('.tab-content');
            const nextButtons = document.querySelectorAll('.next-tab');
            const prevButtons = document.querySelectorAll('.prev-tab');
            
            // Gerenciamento de abas disponíveis
            function updateAvailableTabs() {
                console.log('[TABS] Atualizando estado das abas disponíveis');
                // Encontrar o índice da aba atual
                const currentTabId = document.querySelector('.tab-content.active').id;
                const currentTabIndex = Array.from(tabs).findIndex(tab => tab.getAttribute('data-tab') === currentTabId);
                console.log('[TABS] Aba atual:', currentTabId, 'Índice:', currentTabIndex);
                
                // Habilitar todas as abas até a atual
                tabs.forEach((tab, index) => {
                    const tabId = tab.getAttribute('data-tab');
                    if (index <= currentTabIndex) {
                        tab.classList.remove('disabled');
                        console.log('[TABS] Habilitando aba:', tabId);
                    } else if (index === currentTabIndex + 1) {
                        // A próxima aba também está disponível, mas só clicável se a atual for válida
                        tab.classList.remove('disabled');
                        console.log('[TABS] Próxima aba disponível:', tabId);
                    } else {
                        // Abas posteriores ficam desabilitadas
                        tab.classList.add('disabled');
                        console.log('[TABS] Desabilitando aba:', tabId);
                    }
                });
            }
            
            // Função para trocar de aba
            function switchTab(tabId) {
                console.log('[NAVIGATION] Trocando para a aba:', tabId);
                // Oculta todas as abas e remove a classe active
                tabContents.forEach(content => {
                    content.classList.remove('active');
                });
                
                tabElements.forEach(tab => {
                    tab.classList.remove('active');
                });
                
                // Ativa a aba selecionada
                document.getElementById(tabId).classList.add('active');
                document.querySelector(`[data-tab="${tabId}"]`).classList.add('active');
                console.log('[NAVIGATION] Aba ativada:', tabId);
                
                // Atualizar as abas disponíveis
                updateAvailableTabs();
                
                // Scroll para o topo do formulário
                document.querySelector('.form-container').scrollIntoView({ behavior: 'smooth' });
            }
            
            // Adiciona event listeners para as abas
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    const currentTabId = document.querySelector('.tab-content.active').id;
                    
                    // Se estiver tentando ir para uma aba diferente da atual
                    if (tabId !== currentTabId) {
                        // Se for para uma aba posterior, valida a aba atual
                        const currentTabIndex = Array.from(tabs).findIndex(t => t.getAttribute('data-tab') === currentTabId);
                        const targetTabIndex = Array.from(tabs).findIndex(t => t.getAttribute('data-tab') === tabId);
                        
                        if (targetTabIndex > currentTabIndex) {
                            // Validação necessária ao avançar
                            if (validateTabFields(currentTabId)) {
                                switchTab(tabId);
                            }
                        } else {
                            // Permite voltar para abas anteriores sem validação
                            switchTab(tabId);
                        }
                    }
                });
            });
            
            // Botões de próximo
            nextButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const nextTabId = this.getAttribute('data-next');
                    console.log('[NAVIGATION] Botão próximo clicado, próxima aba:', nextTabId);
                    
                    // Valida os campos da aba atual antes de avançar
                    const currentTabId = document.querySelector('.tab-content.active').id;
                    if (validateTabFields(currentTabId)) {
                        switchTab(nextTabId);
                    } else {
                        console.log('[NAVIGATION] Navegação bloqueada devido a campos inválidos');
                    }
                });
            });
            
            // Botões de anterior
            prevButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const prevTabId = this.getAttribute('data-prev');
                    console.log('[NAVIGATION] Botão anterior clicado, aba anterior:', prevTabId);
                    switchTab(prevTabId);
                });
            });
            
            // Função para validar campos de uma aba específica
            function validateTabFields(tabId) {
                console.log('[VALIDATION] Validando campos da aba:', tabId);
                const currentTab = document.getElementById(tabId);
                // Select required inputs, selects, textareas directly
                const requiredFields = currentTab.querySelectorAll('input[required]:not([type="radio"]):not([type="checkbox"]), select[required], textarea[required]');
                console.log('[VALIDATION] Quantidade de campos obrigatórios encontrados:', requiredFields.length);
                // Handle required radio groups
                const requiredRadioGroups = {};
                currentTab.querySelectorAll('input[type="radio"][required]').forEach(radio => {
                    const groupName = radio.name;
                    if (!requiredRadioGroups[groupName]) {
                        // Find the label or container for the group to place the error message
                        let container = radio.closest('.form-group') || radio.closest('.radio-group') || radio.parentNode;
                        let labelElement = container?.querySelector('.form-label');
                        requiredRadioGroups[groupName] = { elements: [], required: true, errorContainer: container, labelElement: labelElement };
                    }
                    requiredRadioGroups[groupName].elements.push(radio);
                });
                 // Handle required checkbox groups (at least one needs to be checked)
                 const requiredCheckboxGroups = {};
                 currentTab.querySelectorAll('input[type="checkbox"][required]').forEach(checkbox => {
                     const groupName = checkbox.name;
                     if (!requiredCheckboxGroups[groupName]) {
                         let container = checkbox.closest('.form-group') || checkbox.closest('.checkbox-group') || checkbox.parentNode;
                         let labelElement = container?.querySelector('.form-label');
                         requiredCheckboxGroups[groupName] = { elements: [], required: true, errorContainer: container, labelElement: labelElement };
                     }
                     requiredCheckboxGroups[groupName].elements.push(checkbox);
                 });
                
                let isValid = true;
                let firstInvalidField = null;
                
                // Validate individual fields (input, select, textarea)
                requiredFields.forEach(field => {
                    const errorMsgId = field.id + '-required-error'; // Unique ID for required message
                    let errorMsg = document.getElementById(errorMsgId);

                    if (!field.value.trim()) {
                        isValid = false;
                        field.style.borderColor = 'var(--error-color)';
                        field.style.backgroundColor = 'var(--error-bg)';
                        
                        if (!firstInvalidField) firstInvalidField = field;
                        
                        if (!errorMsg) {
                            errorMsg = document.createElement('div');
                            errorMsg.id = errorMsgId; // Assign the ID
                            errorMsg.className = 'error-message';
                            errorMsg.textContent = 'Este campo é obrigatório';

                            // Find the parent form-group and append the message there
                            const parentGroup = field.closest('.form-group');
                            if (parentGroup) {
                                parentGroup.appendChild(errorMsg);
                            } else {
                                // Fallback (shouldn't usually happen with this structure)
                                field.insertAdjacentElement('afterend', errorMsg);
                            }
                        }
                    } else {
                        // Remove specific required error message if it exists
                         if (errorMsg) errorMsg.remove();
                         
                         // Field is filled, check format/special chars
                         // Keep existing style if format/char validation adds error style
                         let hasFormatError = false;
                         if (!validateFieldFormat(field)) {
                             isValid = false;
                             hasFormatError = true;
                             if (!firstInvalidField) firstInvalidField = field;
                         }
                         // Also check special chars for text inputs/textareas
                         let hasSpecialCharError = false;
                         if ((field.tagName === 'INPUT' && field.type === 'text') || field.tagName === 'TEXTAREA') {
                             if (!validateSpecialChars(field)) { // Assumes this function adds messages/styles
                                 isValid = false;
                                 hasSpecialCharError = true;
                                 if (!firstInvalidField) firstInvalidField = field;
                             }
                         }

                         // Only reset base styles if no format/special char error was found by the above checks
                         if (!hasFormatError && !hasSpecialCharError) {
                            // Reset styles only if no *other* error indicators are present (like valid CEP/Phone classes)
                            if (!field.classList.contains('cep-valido') && !field.classList.contains('phone-valid') && !field.classList.contains('special-char-error')) {
                                 field.style.borderColor = '';
                                 field.style.backgroundColor = '';
                            }
                         }
                    }
                });

                // Validate required radio groups
                Object.keys(requiredRadioGroups).forEach(groupName => {
                    const group = requiredRadioGroups[groupName];
                    const isChecked = group.elements.some(radio => radio.checked);
                     const errorMsgId = groupName + '-required-error'; // ID for group error
                     const errorContainer = group.errorContainer;
                     let errorMsg = document.getElementById(errorMsgId);

                    if (!isChecked) {
                        isValid = false;
                        // Highlight the group container
                         if (errorContainer) errorContainer.style.outline = '1px solid var(--error-color)';

                        if (!firstInvalidField) firstInvalidField = group.elements[0]; // Focus first element

                        if (!errorMsg && errorContainer) {
                            errorMsg = document.createElement('div');
                            errorMsg.id = errorMsgId;
                            errorMsg.className = 'error-message';
                            errorMsg.textContent = 'Selecione uma opção';
                            // Append error message after the group or label
                            if (group.labelElement) {
                                group.labelElement.parentNode.insertBefore(errorMsg, group.labelElement.nextSibling.nextSibling); // Adjust insertion point as needed
                            } else {
                                errorContainer.appendChild(errorMsg);
                            }
                        }
                    } else {
                        // Remove error
                         if (errorMsg) errorMsg.remove();
                         if (errorContainer) errorContainer.style.outline = ''; // Remove highlight
                    }
                });

                 // Validate required checkbox groups (at least one checked)
                 Object.keys(requiredCheckboxGroups).forEach(groupName => {
                     const group = requiredCheckboxGroups[groupName];
                     const isChecked = group.elements.some(checkbox => checkbox.checked);
                     const errorMsgId = groupName + '-required-error'; // ID for group error
                     const errorContainer = group.errorContainer;
                     let errorMsg = document.getElementById(errorMsgId);

                     if (!isChecked) {
                         isValid = false;
                         if (errorContainer) errorContainer.style.outline = '1px solid var(--error-color)';

                         if (!firstInvalidField) firstInvalidField = group.elements[0];

                         if (!errorMsg && errorContainer) {
                             errorMsg = document.createElement('div');
                             errorMsg.id = errorMsgId;
                             errorMsg.className = 'error-message';
                             errorMsg.textContent = 'Selecione ao menos uma opção';
                             // Append error message after the group or label
                              if (group.labelElement) {
                                  group.labelElement.parentNode.insertBefore(errorMsg, group.labelElement.nextSibling.nextSibling); // Adjust insertion point as needed
                              } else {
                                  errorContainer.appendChild(errorMsg);
                              }
                         }
                     } else {
                         // Remove error
                         if (errorMsg) errorMsg.remove();
                         if (errorContainer) errorContainer.style.outline = ''; // Remove highlight
                     }
                 });

                // Validar caracteres especiais nos campos de texto da aba
                const textFields = currentTab.querySelectorAll('input[type="text"], textarea');
                textFields.forEach(field => {
                    // Não validar aqui se o campo estiver vazio (já verificado acima se for obrigatório)
                    if (field.value.trim() && !validateSpecialChars(field)) {
                        isValid = false;
                        if (!firstInvalidField) firstInvalidField = field;
                    }
                });

                // If not valid, show alert and focus
                if (!isValid) {
                    console.log('[VALIDATION] Validação falhou com campos inválidos');
                    if (window.innerWidth < 768 && firstInvalidField) {
                        setTimeout(() => {
                            firstInvalidField.scrollIntoView({ 
                                behavior: 'smooth', 
                                block: 'center'
                            });
                            firstInvalidField.focus();
                        }, 100);
                    } else if (firstInvalidField) {
                        firstInvalidField.focus();
                    }
                    
                    alert('Por favor, corrija os campos destacados antes de continuar.');
                } else {
                    console.log('[VALIDATION] Validação concluída com sucesso para a aba:', tabId);
                }
                
                return isValid;
            }
            
            // Função para validar formato de campos específicos
            function validateFieldFormat(field) {
                // Se o campo não tiver valor, não valida formato
                if (!field.value.trim()) return true;
                
                let isValid = true;
                let errorMessage = '';
                const errorMsgId = field.id + '-format-error';
                let errorMsg = document.getElementById(errorMsgId);
                
                // Remover mensagem de erro anterior, se existir
                if (errorMsg) {
                    errorMsg.remove();
                }
                
                // Validação específica por tipo de campo
                switch(field.id) {
                    case 'input_95': // CPF
                    case 'input_228': // CPF Cônjuge
                        // Verifica formato e validade de CPF
                        isValid = validateCPF(field);
                        errorMessage = 'CPF inválido. Verifique o formato e os dígitos.';
                        break;
                        
                    case 'input_117': // Email
                        isValid = validateEmail(field);
                        errorMessage = 'E-mail inválido. Verifique o formato.';
                        break;
                        
                    case 'input_104': // Data de Nascimento
                    case 'input_231': // Data de Nascimento Cônjuge
                        isValid = validateAge(field);
                        errorMessage = 'Data de nascimento inválida.';
                        break;
                        
                    case 'input_106': // Data de Expedição
                    case 'input_234': // Data de Expedição Cônjuge
                        isValid = validateDate(field);
                        errorMessage = 'Data de expedição inválida.';
                        break;
                        
                    case 'input_108': // CEP Correspondência
                    case 'input_215': // CEP Residência
                        isValid = validateCEP(field);
                        errorMessage = 'CEP inválido. Use o formato 00000-000.';
                        break;
                        
                    case 'input_118': // Telefone
                        isValid = validatePhone(field);
                        errorMessage = 'Telefone inválido. Verifique o formato.';
                        break;
                }
                
                // Se inválido, mostrar mensagem de erro
                if (!isValid && !errorMsg) {
                    errorMsg = document.createElement('div');
                    errorMsg.id = errorMsgId;
                    errorMsg.className = 'error-message';
                    errorMsg.textContent = errorMessage;
                    
                    // Insere a mensagem de erro após o campo ou seu container
                    if (field.id === 'input_118') {
                        field.closest('.phone-input-container').parentNode.insertBefore(errorMsg, field.closest('.phone-input-container').nextSibling);
                    } else {
                        field.parentNode.insertBefore(errorMsg, field.nextSibling);
                    }
                    
                    // Destaca o campo com erro
                    field.style.borderColor = 'var(--error-color)';
                    field.style.backgroundColor = 'var(--error-bg)';
                }
                
                return isValid;
            }

            // Função para validar CEP
            function validateCEP(field) {
                const cep = field.value.replace(/\D/g, '');
                const regexCEP = /^[0-9]{8}$/;
                return regexCEP.test(cep);
            }

            // Função para validar e-mail (complementa validateEmail existente)
            function validateEmail(field) {
                let isValid = false;
                // Verificar se a biblioteca EmailValidator está carregada
                if (typeof EmailValidator !== 'undefined' && typeof EmailValidator.validate === 'function') {
                    // Usar a biblioteca se estiver disponível
                    isValid = EmailValidator.validate(field.value);
                    console.log('[VALIDATION EMAIL] Usando biblioteca EmailValidator');
                } else {
                    // Usar fallback de regex se a biblioteca não estiver carregada
                    const emailRegex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
                    isValid = emailRegex.test(field.value);
                    console.warn('[VALIDATION EMAIL] EmailValidator não carregado, usando fallback regex.');
                }

                if (!isValid) {
                    showError(field, 'Por favor, insira um e-mail válido.', field.id + '-email-error');
                    console.log('[VALIDATION EMAIL] Email inválido');
                }

                return isValid;
            }
            
            // Função para validar caracteres especiais
            function validateSpecialChars(input) {
                // Remove mensagem de erro existente
                const errorMsgId = 'special-char-error-' + input.id;
                let existingError = document.getElementById(errorMsgId);
                if (existingError) {
                    existingError.remove();
                }
                
                // Resetar classe de erro
                input.classList.remove('special-char-error');

                // Se o campo estiver vazio, retorna sem validar
                if (!input.value.trim()) {
                    return true;
                }
                
                let regex;
                let errorMessage = 'Caracteres especiais não permitidos'; // Default error message
                const nameFieldIds = ['input_94', 'input_100', 'input_101', 'input_225', 'input_236', 'input_237'];
                
                // Regex específico para cada tipo de campo
                if (nameFieldIds.includes(input.id)) {
                    // Regex mais restrito para nomes: letras (com acentos), espaços, apóstrofos, hífens
                    regex = /^[a-zA-ZÀ-ÖØ-öø-ÿ\s'-]+$/;
                    errorMessage = 'Nome inválido. Use apenas letras, espaços, apóstrofos ou hífens.';
                } else if (input.id === 'input_95' || input.id === 'input_228') { // CPF e CPF Cônjuge
                    regex = /^[0-9.-]+$/;
                    // A validação de formato/validade do CPF é feita em validateCPF
                } else if (input.id === 'input_98' || input.id === 'input_233') { // Número Documento e Cônjuge
                    regex = /^[0-9a-zA-Z-]+$/;
                    // Regras mais específicas (RG, CNH, Passaporte) são tratadas em applyDocumentNumberRules
                     errorMessage = 'Número do documento inválido.'; // Mensagem genérica, regras específicas tratam formato
                } else if (input.id === 'input_104' || input.id === 'input_106' || input.id === 'input_231' || input.id === 'input_234') { // Datas
                    regex = /^[0-9/]+$/; // Apenas números e barra
                     // A validação de formato/validade é feita em validateAge/validateDate
                } else if (input.id === 'input_108' || input.id === 'input_215') { // CEPs
                    regex = /^[0-9-]+$/;
                    // Validação de busca/formato é feita no listener de CEP
                } else if (input.id === 'input_112' || input.id === 'input_217') { // Número (endereço)
                    regex = /^[0-9]+$/; // Permite apenas números
                     errorMessage = 'Número inválido. Use apenas números.';
                } else if (input.id === 'input_97' || input.id === 'input_230') { // Naturalidade
                    regex = /^[a-zA-ZÀ-ÖØ-öø-ÿ\s,-]+$/; // Letras (acentuadas), espaços, vírgula, hífen
                    errorMessage = 'Naturalidade inválida. Use letras, espaços, vírgula ou hífen.';
                } else if (input.id === 'input_99' || input.id === 'input_235') { // Órgão Emissor (se for input de texto)
                    if (input.tagName === 'INPUT') {
                        regex = /^[a-zA-ZÀ-ÖØ-öø-ÿ0-9\s-]+$/; // Letras (acentuadas), números, espaços, hífen
                        errorMessage = 'Órgão Emissor inválido. Use letras, números, espaços ou hífen.';
                    } else {
                        return true; // Não valida select aqui
                    }
                } else if (input.id === 'input_109' || input.id === 'input_216') { // Logradouro
                    regex = /^[a-zA-ZÀ-ÖØ-öø-ÿ\s]+$/; // Apenas letras (com acentos) e espaços
                    errorMessage = 'Logradouro inválido. Use apenas letras e espaços.';
                } else if (input.id === 'input_111' || input.id === 'input_220' || // Bairro
                           input.id === 'input_110' || input.id === 'input_221' || // Cidade
                           input.id === 'input_113' || input.id === 'input_219') {  // Complemento
                    regex = /^[a-zA-ZÀ-ÖØ-öø-ÿ0-9\s.,/()ºª_-]+$/;
                    errorMessage = 'Endereço inválido. Verifique os caracteres especiais.';
                } else if (input.id === 'input_117') { // Email
                    // Validação específica em validateEmail
                    return true;
                } else if (input.id === 'input_123') { // Campo de detalhes PPE
                    // Permite um conjunto mais amplo de caracteres para descrição
                    regex = /^[a-zA-ZÀ-ÖØ-öø-ÿ0-9\s.,;!?()/:_-]+$/; // Adicionado ':'
                    errorMessage = 'Descrição inválida. Verifique os caracteres especiais.';
                } else if (input.id === 'input_96' || input.id === 'input_229') { // Nacionalidade
                    regex = /^[a-zA-ZÀ-ÖØ-öø-ÿ\s()/-]+$/; // Letras (acentuadas), espaços, (), /, -
                    errorMessage = 'Nacionalidade inválida. Use letras, espaços, (), / ou -.';
                }
                // Adicione outros 'else if' para campos específicos conforme necessário
                // else {
                //     // Fallback genérico (se necessário, mas idealmente todos os campos de texto são tratados)
                //     regex = /^[a-zA-ZÀ-ÖØ-öø-ÿ0-9\s.,/()_-]+$/;
                // }

                // Aplicar a validação se uma regex foi definida para o campo
                if (regex && !regex.test(input.value)) {
                    // Campo contém caracteres não permitidos
                    input.classList.add('special-char-error');
                    
                    // Adiciona mensagem de erro (usando a mensagem específica definida)
                    const errorMsg = document.createElement('div');
                    errorMsg.id = errorMsgId;
                    errorMsg.className = 'error-message';
                    errorMsg.textContent = errorMessage; // Use a mensagem de erro específica
                    input.parentNode.insertBefore(errorMsg, input.nextSibling);
                    
                    return false;
                } else {
                    // Campo válido (ou sem regex definida para ele)
                    input.classList.remove('special-char-error');
                    return true;
                }
            }
            
            // Aplica validação de caracteres especiais a todos os campos de texto
            const textInputs = document.querySelectorAll('input[type="text"], textarea');
            textInputs.forEach(input => {
                // Ignora campos que não devem ser validados/filtrados aqui
                if (input.id === 'input_118') return; // Campo de telefone tem validação/formatação própria
                if (input.id === 'input_95' || input.id === 'input_228') return; // CPF tem formatação própria
                if (input.id === 'input_108' || input.id === 'input_215') return; // CEP tem formatação própria
                if (input.id === 'input_104' || input.id === 'input_106' || input.id === 'input_231' || input.id === 'input_234') return; // Datas têm formatação própria

                const nameFieldIds = ['input_94', 'input_100', 'input_101', 'input_225', 'input_236', 'input_237'];
                
                input.addEventListener('input', function() {
                    if (nameFieldIds.includes(this.id)) {
                        // Filtragem ativa para campos de nome: remove caracteres inválidos
                        const originalValue = this.value;
                        // Regex para encontrar caracteres que NÃO são letras (com acentos), espaços, apóstrofos ou hífens
                        const sanitizedValue = originalValue.replace(/[^a-zA-ZÀ-ÖØ-öø-ÿ\s'-]/g, '');
                        
                        if (originalValue !== sanitizedValue) {
                            this.value = sanitizedValue;
                            // Pode opcionalmente disparar um feedback visual breve aqui, se desejado
                        }
                        // Após filtrar, ainda podemos validar para mostrar mensagem se necessário (embora deva estar sempre válido)
                         validateSpecialChars(this); 
                    } else if (this.id === 'input_109' || this.id === 'input_216') { // Logradouro
                        // Filtragem ativa para Logradouro: remove números e caracteres especiais
                        const originalValue = this.value;
                        const sanitizedValue = originalValue.replace(/[^a-zA-ZÀ-ÖØ-öø-ÿ\s]/g, '');
                        if (originalValue !== sanitizedValue) {
                            this.value = sanitizedValue;
                        }
                        validateSpecialChars(this);
                    } else if (this.id === 'input_112' || this.id === 'input_217') { // Número (endereço)
                        // Filtragem ativa para Número: remove não-numéricos
                        const originalValue = this.value;
                        const sanitizedValue = originalValue.replace(/\\D/g, ''); // Remove tudo que não for dígito
                        if (originalValue !== sanitizedValue) {
                            this.value = sanitizedValue;
                        }
                          validateSpecialChars(this); 
                     } else {
                         // Para outros campos, apenas valida (não filtra ativamente)
                         validateSpecialChars(this);
                    }
                });
                
                input.addEventListener('blur', function() {
                    // Validação no blur continua a mesma para todos os campos
                    validateSpecialChars(this);
                });
                
                // Validação inicial se o campo já tiver valor
                if (input.value) {
                    validateSpecialChars(input);
                }
            });
            
            // Formatação de CPF
            const cpfInput = document.getElementById('input_95');
            if (cpfInput) {
                // Format CPF as user types
                cpfInput.addEventListener('input', function() {
                    let value = this.value.replace(/\D/g, '');
                    if (value.length > 11) {
                        value = value.substring(0, 11);
                    }
                    
                    if (value.length > 9) {
                        this.value = value.replace(/(\d{3})(\d{3})(\d{3})(\d{1,2})/, '$1.$2.$3-$4');
                    } else if (value.length > 6) {
                        this.value = value.replace(/(\d{3})(\d{3})(\d{1,3})/, '$1.$2.$3');
                    } else if (value.length > 3) {
                        this.value = value.replace(/(\d{3})(\d{1,3})/, '$1.$2');
                    } else {
                        this.value = value;
                    }

                    // Real-time validation as user types
                    validateCPF(this);
                });

                // Validate on blur
                cpfInput.addEventListener('blur', function() {
                    validateCPF(this);
                });

                // Initial validation if field has a value
                if (cpfInput.value) {
                    validateCPF(cpfInput);
                }
            }
            
            // Formatação de CPF Cônjuge
            const cpfConjugeInput = document.getElementById('input_228');
            if (cpfConjugeInput) {
                // Format CPF as user types
                cpfConjugeInput.addEventListener('input', function() {
                    let value = this.value.replace(/\D/g, '');
                    if (value.length > 11) {
                        value = value.substring(0, 11);
                    }
                    
                    if (value.length > 9) {
                        this.value = value.replace(/(\d{3})(\d{3})(\d{3})(\d{1,2})/, '$1.$2.$3-$4');
                    } else if (value.length > 6) {
                        this.value = value.replace(/(\d{3})(\d{3})(\d{1,3})/, '$1.$2.$3');
                    } else if (value.length > 3) {
                        this.value = value.replace(/(\d{3})(\d{1,3})/, '$1.$2');
                    } else {
                        this.value = value;
                    }

                    // Real-time validation as user types (ensure validateCPF handles spouse field correctly if needed)
                    // The primary validation is handled within aplicarValidacoesConjuge, but format validation helps
                    validateCPF(this); 
                });

                // Validate on blur (already handled within aplicarValidacoesConjuge)
                // cpfConjugeInput.addEventListener('blur', function() {
                //     validateCPF(this);
                // });

                // Initial validation if field has a value (already handled within aplicarValidacoesConjuge)
                // if (cpfConjugeInput.value) {
                //     validateCPF(cpfConjugeInput);
                // }
            }

            // Formatação de Datas
            const dateFields = document.querySelectorAll('#input_104, #input_106, #input_231, #input_234');
            dateFields.forEach(function(field) {
                field.addEventListener('input', function(e) {
                    let value = e.target.value.replace(/\D/g, '');
                    if (value.length > 8) value = value.slice(0, 8);
                    
                    if (value.length > 4) {
                        value = value.replace(/^(\d{2})(\d{2})(\d{0,4})$/, '$1/$2/$3');
                    } else if (value.length > 2) {
                        value = value.replace(/^(\d{2})(\d{0,2})$/, '$1/$2');
                    }
                    
                    e.target.value = value;
                    
                    // Preencher os campos ocultos para o JotForm
                    const fieldId = e.target.id;
                    const parts = value.split('/');
                    if (parts.length === 3 && parts[2].length === 4) {
                        document.getElementById('day_' + fieldId.split('_')[1]).value = parts[0];
                        document.getElementById('month_' + fieldId.split('_')[1]).value = parts[1];
                        document.getElementById('year_' + fieldId.split('_')[1]).value = parts[2];
                    }
                });

                // Adicionar validação no blur para todos os campos de data
                field.addEventListener('blur', function() {
                    if (!this.value.trim()) { // Clear errors if empty
                         const errorMsgId = this.id.includes('Nascimento') ? 'age-error-' + this.id : 'date-error-' + this.id;
                         let existingError = document.getElementById(errorMsgId);
                         if (existingError) existingError.remove();
                         this.style.borderColor = '';
                         this.style.backgroundColor = '';
                         return;
                    }
                    // Chamar a validação apropriada
                    if (this.id === 'input_104' || this.id === 'input_231') {
                        validateAge(this);
                    } else if (this.id === 'input_106' || this.id === 'input_234') {
                        validateDate(this);
                    }
                });
            });
            
            // Formatação de CEP
            const cepFields = document.querySelectorAll('#input_108, #input_215');
            cepFields.forEach(function(cepField) {
                if (cepField) {
                    let lastValue = '';
                    
                    cepField.addEventListener('input', function(e) {
                        let value = this.value.replace(/\D/g, '');
                        if (value.length > 8) value = value.slice(0, 8);
                        
                        if (value.length > 5) {
                            value = value.replace(/^(\d{5})(\d{0,3})$/, '$1-$2');
                        }
                        
                        this.value = value;
                        
                        // Verifica se chegamos a 8 dígitos numéricos pela primeira vez neste evento
                        const numericValue = value.replace(/\D/g, '');
                        if (numericValue.length === 8 && numericValue !== lastValue) {
                            // Guarda o valor para evitar buscas duplicadas
                            lastValue = numericValue;
                            
                            // Pequeno timeout para garantir que a formatação do valor foi aplicada antes da busca
                            setTimeout(() => {
                                buscarCep(numericValue, cepField.id);
                            }, 50);
                        } else if (numericValue.length > 0 && numericValue.length < 8) {
                            // Se o CEP estiver incompleto, mostrar feedback visual
                            this.classList.remove('cep-valido');
                            this.style.borderColor = '';
                            this.style.backgroundColor = '';
                            
                            // Remover mensagem de erro se existir
                            const errorEl = document.getElementById(`${cepField.id}-error-msg`);
                            if (errorEl) errorEl.remove();
                            
                            // Remover mensagem de sucesso se existir
                            const successEl = document.getElementById(`${cepField.id}-success-msg`);
                            if (successEl) successEl.remove();
                            
                            // Resetar o lastValue quando o valor é apagado
                            lastValue = numericValue;
                        }
                    });
                    
                    // Busca também quando o campo perde o foco
                    cepField.addEventListener('blur', function() {
                        const cep = this.value.replace(/\D/g, '');
                        if (cep.length === 8) {
                            // --- Check if search is already pending/in progress from input event ---
                            if (cepSearchState[this.id]) {
                                console.log('[CEP Blur] Search triggered by input is pending/running, skipping blur search for:', this.id);
                                return;
                            }
                            // ---
                            buscarCep(cep, cepField.id);
                        }
                    });
                }
            });
            
            // Formatação de Telefone
            const phoneField = document.getElementById('input_118');
            const countrySelect = document.getElementById('country-select');
            const countryDropdown = document.getElementById('country-dropdown');
            const selectedFlag = document.getElementById('selected-flag');
            const selectedCode = document.getElementById('selected-code');

            if (phoneField && countrySelect && countryDropdown) {
                let lastValue = '';
                let selectedCountry = 'BR'; // Brasil como padrão
                let selectedDialCode = '+55'; // Código +55 como padrão
                
                // Lista de países mais comuns
                const countries = [
                    { code: 'BR', name: 'Brasil', dialCode: '+55', flag: 'https://flagcdn.com/br.svg' },
                    { code: 'US', name: 'Estados Unidos', dialCode: '+1', flag: 'https://flagcdn.com/us.svg' },
                    { code: 'PT', name: 'Portugal', dialCode: '+351', flag: 'https://flagcdn.com/pt.svg' },
                    { code: 'ES', name: 'Espanha', dialCode: '+34', flag: 'https://flagcdn.com/es.svg' },
                    { code: 'FR', name: 'França', dialCode: '+33', flag: 'https://flagcdn.com/fr.svg' },
                    { code: 'DE', name: 'Alemanha', dialCode: '+49', flag: 'https://flagcdn.com/de.svg' },
                    { code: 'IT', name: 'Itália', dialCode: '+39', flag: 'https://flagcdn.com/it.svg' },
                    { code: 'UK', name: 'Reino Unido', dialCode: '+44', flag: 'https://flagcdn.com/gb.svg' },
                    { code: 'JP', name: 'Japão', dialCode: '+81', flag: 'https://flagcdn.com/jp.svg' },
                    { code: 'CN', name: 'China', dialCode: '+86', flag: 'https://flagcdn.com/cn.svg' },
                    { code: 'AU', name: 'Austrália', dialCode: '+61', flag: 'https://flagcdn.com/au.svg' },
                    { code: 'CA', name: 'Canadá', dialCode: '+1', flag: 'https://flagcdn.com/ca.svg' },
                    { code: 'AR', name: 'Argentina', dialCode: '+54', flag: 'https://flagcdn.com/ar.svg' },
                    { code: 'CL', name: 'Chile', dialCode: '+56', flag: 'https://flagcdn.com/cl.svg' },
                    { code: 'UY', name: 'Uruguai', dialCode: '+598', flag: 'https://flagcdn.com/uy.svg' },
                    { code: 'PY', name: 'Paraguai', dialCode: '+595', flag: 'https://flagcdn.com/py.svg' },
                    { code: 'CO', name: 'Colômbia', dialCode: '+57', flag: 'https://flagcdn.com/co.svg' },
                    { code: 'PE', name: 'Peru', dialCode: '+51', flag: 'https://flagcdn.com/pe.svg' },
                    { code: 'MX', name: 'México', dialCode: '+52', flag: 'https://flagcdn.com/mx.svg' },
                ];
                
                // Gerar a lista de países no dropdown
                function generateCountryList() {
                    let html = '';
                    
                    countries.forEach(country => {
                        const isSelected = country.code === selectedCountry;
                        html += `
                            <div class="country-item ${isSelected ? 'selected' : ''}" data-code="${country.code}" data-dial="${country.dialCode}">
                                <img src="${country.flag}" alt="${country.name}">
                                <span class="country-name">${country.name}</span>
                                <span class="country-dial-code">${country.dialCode}</span>
                            </div>
                        `;
                    });
                    
                    countryDropdown.innerHTML = html;
                    
                    // Adicionar event listeners aos itens do dropdown
                    document.querySelectorAll('.country-item').forEach(item => {
                        item.addEventListener('click', function() {
                            const countryCode = this.getAttribute('data-code');
                            const dialCode = this.getAttribute('data-dial');
                            
                            // Atualizar o país selecionado
                            selectedCountry = countryCode;
                            selectedDialCode = dialCode;
                            
                            // Atualizar a interface
                            const selectedCountryData = countries.find(c => c.code === countryCode);
                            selectedFlag.src = selectedCountryData.flag;
                            selectedFlag.alt = selectedCountryData.name;
                            selectedCode.textContent = selectedDialCode;
                            
                            // Atualizar o campo oculto do código do país
                            document.getElementById('input_118_country_code').value = selectedDialCode;
                            
                            // Atualizar a formatação do número de telefone
                            updatePhoneFormat();
                            
                            // Fechar o dropdown
                            countryDropdown.classList.remove('active');
                        });
                    });
                }
                
                // Abrir/fechar o dropdown ao clicar no seletor
                countrySelect.addEventListener('click', function(e) {
                    e.stopPropagation(); // Prevenir propagação do clique
                    countryDropdown.classList.toggle('active');
                    
                    // Scroll para o item selecionado
                    if (countryDropdown.classList.contains('active')) {
                        const selectedItem = countryDropdown.querySelector('.country-item.selected');
                        if (selectedItem) {
                            selectedItem.scrollIntoView({ block: 'nearest', behavior: 'smooth' });
                        }
                    }
                });
                
                // Fechar dropdown ao clicar fora
                document.addEventListener('click', function(e) {
                    if (!countrySelect.contains(e.target) && !countryDropdown.contains(e.target)) {
                        countryDropdown.classList.remove('active');
                    }
                });
                
                // Atualizar a formatação do número de telefone
                function updatePhoneFormat() {
                    if (selectedCountry === 'BR') {
                        // Formato brasileiro: (XX) XXXXX-XXXX ou (XX) XXXX-XXXX
                        phoneField.placeholder = '(00) 00000-0000';
                        
                        // Reformatar o número existente se necessário
                        if (phoneField.value) {
                            const numericValue = phoneField.value.replace(/\D/g, '');
                            
                            if (numericValue.length > 10) {
                                // Celular: (XX) 9XXXX-XXXX
                                phoneField.value = numericValue.replace(/^(\d{2})(\d{5})(\d{0,4})$/, '($1) $2-$3');
                            } else if (numericValue.length > 6) {
                                // Fixo: (XX) XXXX-XXXX
                                phoneField.value = numericValue.replace(/^(\d{2})(\d{4})(\d{0,4})$/, '($1) $2-$3');
                            } else if (numericValue.length > 2) {
                                // Formatação parcial
                                phoneField.value = numericValue.replace(/^(\d{2})(\d{0,5})$/, '($1) $2');
                            }
                        }
                    } else {
                        // Formato internacional (sem formatação específica)
                        phoneField.placeholder = 'Digite o número';
                    }

                    // Atualizar o campo oculto do código do país
                    document.getElementById('input_118_country_code').value = selectedDialCode;

                    // Revalidar o telefone com o novo formato
                    validatePhone(phoneField);
                }
                
                // Função para atualizar o campo de telefone completo (código + número)
                function updateFullPhoneField() {
                    // Removida porque não é mais necessária - agora usamos o campo diretamente
                }
                
                // Formatar o telefone à medida que o usuário digita
                phoneField.addEventListener('input', function() {
                    let value = this.value.replace(/\D/g, '');
                    
                    // Aplicar formato adequado com base no país
                    if (selectedCountry === 'BR') {
                        if (value.length > 11) value = value.slice(0, 11);
                        
                        if (value.length > 6) {
                            // Verifica se é celular (11 dígitos) ou fixo (10 dígitos)
                            if (value.length > 10) {
                                // Celular: (XX) 9XXXX-XXXX
                                value = value.replace(/^(\d{2})(\d{5})(\d{0,4})$/, '($1) $2-$3');
                            } else {
                                // Fixo: (XX) XXXX-XXXX
                                value = value.replace(/^(\d{2})(\d{4})(\d{0,4})$/, '($1) $2-$3');
                            }
                        } else if (value.length > 2) {
                            // Formatação parcial
                            value = value.replace(/^(\d{2})(\d{0,5})$/, '($1) $2');
                        }
                    } else {
                        // Limitar a 15 dígitos para números internacionais
                        if (value.length > 15) value = value.slice(0, 15);
                        
                        // Sem formatação especial para números internacionais
                    }
                    
                    this.value = value;
                    
                    // Verificar se o valor foi alterado desde a última validação
                    if (value.replace(/\D/g, '') !== lastValue) {
                        lastValue = value.replace(/\D/g, '');
                        
                        // Pequeno timeout para garantir que a formatação foi aplicada
                        setTimeout(() => {
                            validatePhone(this);
                        }, 50);
                    }
                });
                
                // Validação ao perder o foco
                phoneField.addEventListener('blur', function() {
                    validatePhone(this);
                });
                
                // Função para validar telefone com base no país selecionado
                function validatePhone(input) {
                    console.log('[VALIDATION PHONE] Validando telefone:', input.value);
                    const errorMsgId = 'phone-error-msg';
                    let existingError = document.getElementById(errorMsgId);
                    
                    // Remover mensagem de erro existente
                    if (existingError) {
                        existingError.remove();
                    }
                    
                    // Se vazio, retorna para o estilo padrão
                    if (!input.value.trim()) {
                        input.style.borderColor = '';
                        input.style.backgroundColor = '';
                        console.log('[VALIDATION PHONE] Telefone vazio');
                        return true;
                    }
                    
                    // Obter o código do país selecionado
                    const countryCodeEl = document.getElementById('selected-code');
                    if (!countryCodeEl) {
                        console.log('[VALIDATION PHONE] Código do país não encontrado');
                        return false;
                    }
                    
                    const countryCode = countryCodeEl.textContent;
                    console.log('[VALIDATION PHONE] Código do país:', countryCode);
                    
                    // Extrair apenas os dígitos do telefone
                    const phoneDigits = input.value.replace(/\D/g, '');
                    
                    // Validar o formato com base no país
                    if (countryCode === '+55') { // Brasil
                        // Verificar se é celular (com 9) ou fixo
                        if (phoneDigits.length < 10) {
                            showError(input, 'Telefone brasileiro deve ter pelo menos 10 dígitos.', errorMsgId);
                            console.log('[VALIDATION PHONE] Telefone com poucos dígitos');
                            return false;
                        }
                        
                        if (phoneDigits.length > 11) {
                            showError(input, 'Telefone brasileiro não deve ter mais de 11 dígitos.', errorMsgId);
                            console.log('[VALIDATION PHONE] Telefone com muitos dígitos');
                            return false;
                        }
                    } else {
                        // Para outros países, verificar se tem pelo menos 7 dígitos
                        if (phoneDigits.length < 7) {
                            showError(input, 'Número de telefone internacional muito curto.', errorMsgId);
                            console.log('[VALIDATION PHONE] Telefone internacional muito curto');
                            return false;
                        }
                        
                        // E não mais que 15 dígitos (padrão E.164)
                        if (phoneDigits.length > 15) {
                            showError(input, 'Número de telefone internacional muito longo.', errorMsgId);
                            console.log('[VALIDATION PHONE] Telefone internacional muito longo');
                            return false;
                        }
                    }
                    
                    // Telefone válido
                    console.log('[VALIDATION PHONE] Telefone válido');
                    input.classList.add('phone-valid');
                    return true;
                }
                
                // Inicializar o componente
                generateCountryList();
                
                // Definir os valores iniciais para os campos ocultos
                document.getElementById('input_118_country_code').value = selectedDialCode;
                
                // Configurar a formatação do telefone
                updatePhoneFormat();
                
                // Verificar valor inicial se existir
                if (phoneField.value) {
                    validatePhone(phoneField);
                }
            }
            
            // Validação de e-mail
            const emailField = document.getElementById('input_117');
            if (emailField) {
                emailField.addEventListener('input', function() {
                    // Código de teste para validação
                    console.log('Validando email:', this.value);
                    const isValid = validateEmail(this);
                    console.log('Email válido:', isValid);
                });
                
                emailField.addEventListener('blur', function() {
                    validateEmail(this);
                });
                
                // Validação inicial se o campo já tiver um valor
                if (emailField.value) {
                    validateEmail(emailField);
                }
            }
            
            // Função para validar e-mail
            function validateEmail(input) {
                console.log('[VALIDATION EMAIL] Validando email:', input.value);
                const errorMsgId = 'email-error-msg';
                let existingError = document.getElementById(errorMsgId);
                
                // Remove existing error message
                if (existingError) {
                    existingError.remove();
                }
                
                // If empty, reset to default style and return
                if (!input.value.trim()) {
                    input.style.borderColor = '';
                    input.style.backgroundColor = '';
                    console.log('[VALIDATION EMAIL] Email vazio');
                    return;
                }
                
                let isValid = false;
                // Verificar se a biblioteca EmailValidator está carregada
                if (typeof EmailValidator !== 'undefined' && typeof EmailValidator.validate === 'function') {
                    // Usar a biblioteca se estiver disponível
                    isValid = EmailValidator.validate(input.value);
                    console.log('[VALIDATION EMAIL] Usando biblioteca EmailValidator');
                } else {
                    // Usar fallback de regex se a biblioteca não estiver carregada
                    const emailRegex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
                    isValid = emailRegex.test(input.value);
                    console.warn('[VALIDATION EMAIL] EmailValidator não carregado, usando fallback regex.');
                }

                if (!isValid) {
                    showError(input, 'Por favor, insira um e-mail válido.', errorMsgId);
                    console.log('[VALIDATION EMAIL] Email inválido');
                    return false;
                }
                
                // E-mail é válido
                console.log('[VALIDATION EMAIL] Email válido');
                input.style.borderColor = 'var(--secondary-color)';
                input.style.backgroundColor = '';
                return true;
            }
            
            // Função para validar idade mínima (18 anos)
            function validateAge(input) {
                const baseErrorId = input.id;
                console.log(`[VALIDATION AGE] Validando ${baseErrorId}:`, input.value);
                clearValidationStyles(input, baseErrorId); // Clear previous specific errors/styles

                const birthDateStr = input.value;
                if (!birthDateStr.trim()) {
                    console.log(`[VALIDATION AGE] ${baseErrorId} vazio`);
                    return true; // Don't validate if empty, let required handle it
                }

                const parts = birthDateStr.split('/');
                if (parts.length !== 3 || parts[0].length !== 2 || parts[1].length !== 2 || parts[2].length !== 4) {
                     showError(input, 'Formato inválido. Use DD/MM/AAAA.', baseErrorId + '-error-msg');
                     console.log(`[VALIDATION AGE] ${baseErrorId} formato inválido`);
                     return false;
                }

                const day = parseInt(parts[0], 10);
                const month = parseInt(parts[1], 10) - 1; // Month is 0-indexed
                const year = parseInt(parts[2], 10);

                if (year < 1900 || year > new Date().getFullYear() + 1 || isNaN(day) || isNaN(month) || isNaN(year)) {
                     showError(input, 'Data inválida (ano ou formato).', baseErrorId + '-error-msg');
                     console.log(`[VALIDATION AGE] ${baseErrorId} data inválida`);
                     return false;
                }

                const birthDate = new Date(year, month, day);
                const today = new Date();
                 today.setHours(0, 0, 0, 0); // Compare dates only

                if (birthDate.getFullYear() !== year || birthDate.getMonth() !== month || birthDate.getDate() !== day) {
                     showError(input, 'Data inválida (dia/mês).', baseErrorId + '-error-msg');
                     console.log(`[VALIDATION AGE] ${baseErrorId} data inválida (dia/mês)`);
                     return false;
                 }

                 if (birthDate > today) {
                     showError(input, 'Data não pode ser no futuro.', baseErrorId + '-error-msg');
                     console.log(`[VALIDATION AGE] ${baseErrorId} data no futuro`);
                     return false;
                 }

                let age = today.getFullYear() - birthDate.getFullYear();
                const monthDiff = today.getMonth() - birthDate.getMonth();

                if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
                    age--;
                }

                if (age < 18) {
                     showError(input, 'Você deve ter pelo menos 18 anos.', baseErrorId + '-error-msg');
                     console.log(`[VALIDATION AGE] ${baseErrorId} idade mínima não atingida`);
                     return false;
                }

                console.log(`[VALIDATION AGE] ${baseErrorId} válida e idade ok`);
                input.style.borderColor = 'var(--secondary-color)';
                return true;
            }

             // Função para validar datas genéricas (como expedição)
             function validateDate(input) {
                 const baseErrorId = input.id;
                 console.log(`[VALIDATION DATE] Validando ${baseErrorId}:`, input.value);
                 clearValidationStyles(input, baseErrorId); // Clear previous specific errors/styles

                 const dateStr = input.value;
                 if (!dateStr.trim()) {
                     console.log(`[VALIDATION DATE] ${baseErrorId} vazia`);
                     return true; // Don't validate if empty
                 }

                 const parts = dateStr.split('/');
                 if (parts.length !== 3 || parts[0].length !== 2 || parts[1].length !== 2 || parts[2].length !== 4) {
                     showError(input, 'Formato inválido. Use DD/MM/AAAA.', baseErrorId + '-error-msg');
                     console.log(`[VALIDATION DATE] ${baseErrorId} formato inválido`);
                     return false; // Invalid format
                 }

                 const day = parseInt(parts[0], 10);
                 const month = parseInt(parts[1], 10) - 1; // Month is 0-indexed
                 const year = parseInt(parts[2], 10);

                 if (year < 1950 || year > new Date().getFullYear() + 1 || isNaN(day) || isNaN(month) || isNaN(year)) { // Min year 1950 for expedition
                      showError(input, 'Data inválida (ano ou formato).', baseErrorId + '-error-msg');
                      console.log(`[VALIDATION DATE] ${baseErrorId} data inválida (ano/formato)`);
                      return false;
                 }

                 const dateValue = new Date(year, month, day);
                 const today = new Date();
                 today.setHours(0, 0, 0, 0); // Compare dates only

                 if (dateValue.getFullYear() !== year || dateValue.getMonth() !== month || dateValue.getDate() !== day) {
                      showError(input, 'Data inválida (dia/mês).', baseErrorId + '-error-msg');
                      console.log(`[VALIDATION DATE] ${baseErrorId} data inválida (dia/mês)`);
                      return false;
                  }

                  if (dateValue > today) {
                      showError(input, 'Data não pode ser no futuro.', baseErrorId + '-error-msg');
                      console.log(`[VALIDATION DATE] ${baseErrorId} data no futuro`);
                      return false;
                  }

                 console.log(`[VALIDATION DATE] ${baseErrorId} válida`);
                 input.style.borderColor = 'var(--secondary-color)';
                 return true;
             }

            // CPF validation function
            function validateCPF(input) {
                const baseErrorId = input.id; // Use field ID directly for base
                console.log(`[VALIDATION CPF] Validando ${baseErrorId}:`, input.value);
                clearValidationStyles(input, baseErrorId); // Clear previous specific errors/styles

                // If empty, it's not a format error, let 'required' validation handle it
                if (!input.value.trim()) {
                    console.log(`[VALIDATION CPF] ${baseErrorId} vazio`);
                    return true; // Return true as format is not invalid, just potentially empty
                }

                const cpf = input.value.replace(/\D/g, '');

                if (cpf.length !== 11) {
                    showError(input, 'CPF deve conter 11 dígitos.', baseErrorId + '-error-msg');
                    console.log(`[VALIDATION CPF] ${baseErrorId} inválido: número incorreto de dígitos`);
                    return false;
                }

                if (/^(\d)\1{10}$/.test(cpf)) {
                    showError(input, 'CPF inválido: todos os dígitos são iguais.', baseErrorId + '-error-msg');
                    console.log(`[VALIDATION CPF] ${baseErrorId} inválido: dígitos repetidos`);
                    return false;
                }

                let sum = 0;
                for (let i = 0; i < 9; i++) {
                    sum += parseInt(cpf.charAt(i)) * (10 - i);
                }
                let remainder = sum % 11;
                let digit1 = remainder < 2 ? 0 : 11 - remainder;

                sum = 0;
                for (let i = 0; i < 10; i++) {
                    sum += parseInt(cpf.charAt(i)) * (11 - i);
                }
                remainder = sum % 11;
                let digit2 = remainder < 2 ? 0 : 11 - remainder;

                if (parseInt(cpf.charAt(9)) !== digit1 || parseInt(cpf.charAt(10)) !== digit2) {
                    showError(input, 'CPF inválido.', baseErrorId + '-error-msg');
                    console.log(`[VALIDATION CPF] ${baseErrorId} inválido: dígitos verificadores incorretos`);
                    return false;
                }

                // CPF is valid
                console.log(`[VALIDATION CPF] ${baseErrorId} válido`);
                input.style.borderColor = 'var(--secondary-color)'; // Indicate success
                // clearValidationStyles should have reset background if needed
                return true;
            }

            // Helper function to show validation error
            function showError(input, message, errorMsgId) {
                // Não aplicar estilos de erro se o elemento for um CEP/Telefone válido
                if ((input.id === 'input_108' || input.id === 'input_215') && input.classList.contains('cep-valido')) {
                    return;
                }
                if (input.id === 'input_118' && input.classList.contains('phone-valid')) {
                    return;
                }

                // Add error styles
                input.style.borderColor = 'var(--error-color)';
                input.style.backgroundColor = 'var(--error-bg)';
                input.classList.add('error'); // Add a general error class if needed

                // Create and insert error message if it doesn't exist
                let errorMsg = document.getElementById(errorMsgId);
                if (!errorMsg) {
                     errorMsg = document.createElement('div');
                     errorMsg.id = errorMsgId;
                     errorMsg.className = 'error-message';
                     errorMsg.textContent = message;
                     errorMsg.style.color = 'var(--error-color)';
                     errorMsg.style.fontSize = '0.8rem';
                     errorMsg.style.marginTop = '4px';

                     // Insert error message into the parent form-group
                     const parentGroup = input.closest('.form-group');
                     if (parentGroup) {
                         parentGroup.appendChild(errorMsg);
                     } else {
                          // Fallback: Insert after the input (less ideal for dynamic fields)
                         input.parentNode.insertBefore(errorMsg, input.nextSibling);
                     }
                }
            }

            // Helper function to clear validation styles and specific messages
            function clearValidationStyles(input, baseErrorId) {
                // Remove specific error message if it exists
                const specificErrorMsg = document.getElementById(baseErrorId + '-error-msg');
                if (specificErrorMsg) {
                    specificErrorMsg.remove();
                }
                // Remove potential success message
                const specificSuccessMsg = document.getElementById(baseErrorId + '-success-msg');
                 if (specificSuccessMsg) {
                     specificSuccessMsg.remove();
                 }

                // Check if *any* other error messages remain for this field's group
                let otherErrorsExist = false;
                const parentGroup = input.closest('.form-group');

                // --- Attempt to remove the 'required' error message specifically ---
                const requiredErrorMsgId = input.id + '-required-error';
                const requiredErrorMsg = document.getElementById(requiredErrorMsgId);
                if (requiredErrorMsg) {
                    requiredErrorMsg.remove();
                    console.log(`[clearValidationStyles] Removed required message for ${input.id}`);
                }
                // --- End removal of 'required' error ---

                if (parentGroup) {
                    // Check messages within the same group, excluding the one we just removed (if it existed)
                    const allMessages = parentGroup.querySelectorAll('.error-message');
                     // Re-check if other messages *still* exist *after* removing the required one
                     otherErrorsExist = Array.from(allMessages).some(msg =>
                         msg.id !== (baseErrorId + '-error-msg')
                     );
                } else {
                    // Fallback check if no parent group found (less likely)
                     const siblingErrors = input.parentNode.querySelectorAll('.error-message');
                     otherErrorsExist = Array.from(siblingErrors).some(msg => msg.id !== (baseErrorId + '-error-msg'));
                }

                // Also check for the required error specifically, as it might be added by validateTabFields
                const requiredErrorId = input.id + '-required-error';
                if (document.getElementById(requiredErrorId)) {
                    otherErrorsExist = true;
                }
                 // Check for special char error class
                 if (input.classList.contains('special-char-error')) {
                     otherErrorsExist = true;
                 }


                // Reset styles only if no other error messages or specific error classes are present
                if (!otherErrorsExist && !input.classList.contains('cep-valido') && !input.classList.contains('phone-valid')) {
                    input.style.borderColor = '';
                    input.style.backgroundColor = '';
                    input.classList.remove('error'); // General error class if used
                    // Don't remove special-char-error here, let its own validation handle it
                }
            }
            
            // Função para buscar CEP na API ViaCEP
            function buscarCep(cep, cepFieldId) {
                const cepInput = document.getElementById(cepFieldId);
                if (!cepInput) {
                    console.error('CEP input field not found:', cepFieldId);
                    return;
                }

                // --- START: Check if search is already in progress ---
                if (cepSearchState[cepFieldId]) {
                    console.log('[buscarCep] Search already in progress for:', cepFieldId);
                    return;
                }
                cepSearchState[cepFieldId] = true; // Set flag
                console.log('[buscarCep] Starting search for:', cepFieldId, 'CEP:', cep);
                // --- END: Check if search is already in progress ---

                // --- START: Robust message clearing ---
                const parentNode = cepInput.parentNode;
                if (parentNode) {
                    const errorMsg = document.getElementById(`${cepFieldId}-error-msg`);
                    if (errorMsg) errorMsg.remove();
                    const successMsg = document.getElementById(`${cepFieldId}-success-msg`);
                    if (successMsg) successMsg.remove();
                    const statusMsg = document.getElementById(`${cepFieldId}-status-msg`);
                    if (statusMsg) statusMsg.remove();
                }
                // --- END: Robust message clearing ---

                // Determinar os IDs dos campos a serem preenchidos com base no ID do campo CEP
                let logradouroId, bairroId, cidadeId, estadoId;
                
                if (cepFieldId === 'input_108') {
                    // Endereço de Correspondência
                    logradouroId = 'input_109';
                    bairroId = 'input_111';
                    cidadeId = 'input_110';
                    estadoId = 'input_114';
                } else if (cepFieldId === 'input_215') {
                    // Endereço de Residência
                    logradouroId = 'input_216';
                    bairroId = 'input_220';
                    cidadeId = 'input_221';
                    estadoId = 'input_222';
                } else {
                    // ID não reconhecido
                    console.error('Campo CEP não reconhecido:', cepFieldId);
                    return;
                }
                
                // Remove classes anteriores
                cepInput.classList.remove('cep-valido');
                cepInput.classList.remove('error'); // Explicitly remove error class
                
                // Também remover qualquer estilo de erro que possa ter sido aplicado anteriormente
                cepInput.style.borderColor = '';
                cepInput.style.backgroundColor = '';
                cepInput.style.color = ''; // Explicitly reset text color
                
                // Remove mensagem de erro anterior se existir
                const errorEl = document.getElementById(`${cepFieldId}-error-msg`);
                if (errorEl) errorEl.remove();
                
                // Remove mensagem de sucesso anterior se existir
                const successEl = document.getElementById(`${cepFieldId}-success-msg`);
                if (successEl) successEl.remove();
                
                // Mostra indicador de carregamento
                cepInput.classList.add('loading');
                
                // Adiciona mensagem de busca
                const statusMsg = document.createElement('div');
                statusMsg.id = `${cepFieldId}-status-msg`;
                statusMsg.className = 'form-hint';
                statusMsg.textContent = 'Buscando endereço...';
                cepInput.parentNode.appendChild(statusMsg);
                
                fetch(`https://viacep.com.br/ws/${cep}/json/`)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Erro ao buscar o CEP');
                        }
                        return response.json();
                    })
                    .then(data => {
                        // Remove indicador de carregamento
                        cepInput.classList.remove('loading');
                        
                        // Remove mensagem de status
                        const statusEl = document.getElementById(`${cepFieldId}-status-msg`);
                        if (statusEl) statusEl.remove();
                        
                        // Verifica se a API retornou erro
                        if (data.erro) {
                            // --- Ensure previous success message is removed again ---
                            const successElCheck = document.getElementById(`${cepFieldId}-success-msg`);
                            if (successElCheck) successElCheck.remove();
                            // ---
                            showError(cepInput, 'CEP não encontrado', `${cepFieldId}-error-msg`);
                            return;
                        }
                        
                        // Preenche os campos com os dados retornados
                        document.getElementById(logradouroId).value = data.logradouro || '';
                        document.getElementById(bairroId).value = data.bairro || '';
                        document.getElementById(cidadeId).value = data.localidade || '';
                        
                        // Seleciona o estado no dropdown
                        const estadoSelect = document.getElementById(estadoId);
                        for (let i = 0; i < estadoSelect.options.length; i++) {
                            if (estadoSelect.options[i].value === data.uf) {
                                estadoSelect.selectedIndex = i;
                                break;
                            }
                        }
                        
                        // Adiciona estilo visual de CEP válido
                        cepInput.classList.add('cep-valido');
                        cepInput.style.borderColor = 'var(--secondary-color)';
                        
                        // Adiciona mensagem de sucesso (only if no error/status exists)
                        if (!document.getElementById(`${cepFieldId}-error-msg`) && !document.getElementById(`${cepFieldId}-status-msg`)) {
                            const successMsg = document.createElement('div');
                            successMsg.id = `${cepFieldId}-success-msg`;
                            successMsg.className = 'form-hint';
                            successMsg.textContent = 'CEP válido! Endereço encontrado.';
                            successMsg.style.color = 'var(--secondary-color)';
                            cepInput.parentNode.appendChild(successMsg);
                        }

                        // Foca no campo de número após preencher o endereço
                        if (cepFieldId === 'input_108') {
                            document.getElementById('input_112').focus();
                        } else if (cepFieldId === 'input_215') {
                            document.getElementById('input_217').focus();
                        }
                    })
                    .catch(error => {
                        // Remove indicador de carregamento
                        cepInput.classList.remove('loading');
                        
                        // Remove mensagem de status
                        const statusEl = document.getElementById(`${cepFieldId}-status-msg`);
                        if (statusEl) statusEl.remove();
                        
                        // Mostra mensagem de erro
                        showError(cepInput, 'Erro ao buscar o CEP', `${cepFieldId}-error-msg`);
                        console.error('Erro:', error);
                    })
                    .finally(() => {
                        // --- Clear the flag and loading indicator regardless of success/failure ---
                        cepSearchState[cepFieldId] = false;
                        cepInput.classList.remove('loading');
                        console.log('[buscarCep] Search finished for:', cepFieldId);
                        // ---
                    });
            }
            
            // Validar o formulário antes do envio
            document.getElementById('cadastro-form').addEventListener('submit', function(e) {
                // Impedir o envio padrão inicialmente
                e.preventDefault();

                let isFormValid = true; // Flag to track overall validity
                let firstInvalidField = null; // To focus on the first error

                // --- Validações Individuais ---

                // Validação de idade (usuário)
                const dataNascimentoInput = document.getElementById('input_104');
                if (!validateAge(dataNascimentoInput)) {
                    isFormValid = false;
                    if (!firstInvalidField) firstInvalidField = dataNascimentoInput;
                }

                // Validação de CPF (usuário)
                const cpfInput = document.getElementById('input_95');
                if (!validateCPF(cpfInput)) {
                    isFormValid = false;
                    if (!firstInvalidField) firstInvalidField = cpfInput;
                }

                // Validação de e-mail (usuário)
                const emailInput = document.getElementById('input_117');
                if (!validateEmail(emailInput)) {
                    isFormValid = false;
                    if (!firstInvalidField) firstInvalidField = emailInput;
                }

                 // Validação de Data de Expedição (usuário)
                 const dataExpedicaoInput = document.getElementById('input_106');
                 if (dataExpedicaoInput.required && !validateDate(dataExpedicaoInput)) {
                     isFormValid = false;
                     if (!firstInvalidField) firstInvalidField = dataExpedicaoInput;
                 }

                // Validação de caracteres especiais em todos os campos de texto
                const textInputs = document.querySelectorAll('input[type="text"], textarea');
                textInputs.forEach(input => {
                    // Ignora campos que têm validação própria
                    if (input.id === 'input_118') return;
                    
                    // Valida o campo
                    if (!validateSpecialChars(input)) {
                        isFormValid = false;
                        if (!firstInvalidField) firstInvalidField = input;
                    }
                });

                // Se encontrou erros de caracteres especiais
                if (!isFormValid) {
                    // Em dispositivos móveis, rola suavemente até o primeiro campo inválido
                    if (window.innerWidth < 768 && firstInvalidField) {
                        setTimeout(() => {
                            firstInvalidField.scrollIntoView({ 
                                behavior: 'smooth', 
                                block: 'center'
                            });
                            firstInvalidField.focus();
                        }, 100);
                    } else if (firstInvalidField) {
                        firstInvalidField.focus();
                    }
                    
                    alert('Por favor, remova os caracteres especiais dos campos destacados.');
                    return false;
                }

                // Garantir que os campos ocultos de data estejam preenchidos
                const dateFields = document.querySelectorAll('#input_104, #input_106, #input_231, #input_234');
                dateFields.forEach(function(field) {
                    const fieldId = field.id;
                    const parts = field.value.split('/');
                    if (parts.length === 3) {
                        document.getElementById('day_' + fieldId.split('_')[1]).value = parts[0];
                        document.getElementById('month_' + fieldId.split('_')[1]).value = parts[1];
                        document.getElementById('year_' + fieldId.split('_')[1]).value = parts[2];
                    }
                });

                // Para garantir que todos os campos sejam enviados
                this.submit();
            });

            // Função para sugerir naturalidade (cidade e estado) conforme o usuário digita
            function setupNaturalidadeSuggestions(inputId) {
                const naturalidadeInput = document.getElementById(inputId);
                if (!naturalidadeInput) {
                    console.warn(`[Naturalidade Setup] Input with ID ${inputId} not found.`);
                    return; // Exit if the input doesn't exist (e.g., spouse section hidden)
                }

                // Verifica se o contêiner de sugestões já existe para este input
                let suggestionsContainer = naturalidadeInput.parentNode.querySelector(`.suggestions-container[data-for="${inputId}"]`);

                if (!suggestionsContainer) {
                     // Cria o contêiner de sugestões apenas se não existir
                     suggestionsContainer = document.createElement('div');
                     suggestionsContainer.className = 'suggestions-container';
                     suggestionsContainer.setAttribute('data-for', inputId); // Associate with the input
                     suggestionsContainer.style.display = 'none';
                     suggestionsContainer.style.position = 'absolute';
                     suggestionsContainer.style.zIndex = '1000';
                     suggestionsContainer.style.backgroundColor = '#fff';
                     suggestionsContainer.style.width = 'calc(100% - 2px)'; // Adjust based on parent structure if needed
                     suggestionsContainer.style.maxHeight = '200px';
                     suggestionsContainer.style.overflowY = 'auto';
                     suggestionsContainer.style.border = '1px solid var(--input-border)';
                     suggestionsContainer.style.borderTop = 'none';
                     suggestionsContainer.style.borderRadius = '0 0 6px 6px';
                     suggestionsContainer.style.boxShadow = '0 4px 8px rgba(0, 0, 0, 0.1)';
                     
                     // Coloca o contêiner após o input
                     naturalidadeInput.parentNode.style.position = 'relative'; // Ensure parent is relative
                     naturalidadeInput.parentNode.appendChild(suggestionsContainer);
                 }

                // Cache para evitar consultas repetidas (pode ser global ou por input)
                const citiesCache = {};
                let debounceTimer;

                // --- Remover listeners antigos antes de adicionar novos ---
                 // Clone o nó para remover listeners - mais robusto que tentar remover individualmente
                 const oldInput = naturalidadeInput;
                 const newInput = oldInput.cloneNode(true);
                 oldInput.parentNode.replaceChild(newInput, oldInput);
                 const currentNaturalidadeInput = document.getElementById(inputId); // Re-selecionar o novo nó
                 const currentSuggestionsContainer = document.querySelector(`.suggestions-container[data-for="${inputId}"]`); // Re-selecionar container

                // Adiciona evento de input ao campo de naturalidade
                currentNaturalidadeInput.addEventListener('input', function() {
                    const query = this.value.trim();

                    // Limpa o timer anterior
                    clearTimeout(debounceTimer);

                    // Oculta sugestões se o input estiver vazio
                    if (query.length < 3) {
                        currentSuggestionsContainer.style.display = 'none';
                        return;
                    }

                    // Define um novo timer para evitar consultas excessivas
                    debounceTimer = setTimeout(() => {
                        if (citiesCache[query]) {
                            // Usa o cache se a consulta já foi feita antes
                            displaySuggestions(citiesCache[query], currentNaturalidadeInput, currentSuggestionsContainer);
                        } else {
                            // Adiciona classe de carregamento
                            currentNaturalidadeInput.classList.add('loading');

                            // Consome a API do IBGE para buscar municípios
                            fetch(`https://servicodados.ibge.gov.br/api/v1/localidades/municipios?orderBy=nome`)
                                .then(response => response.json())
                                .then(data => {
                                    // Filtra municípios que contenham o texto digitado
                                    const filteredCities = data.filter(city => {
                                        const cityName = city.nome.toLowerCase();
                                        const stateAbbr = city.microrregiao.mesorregiao.UF.sigla;
                                        const searchStr = `${cityName} - ${stateAbbr}`.toLowerCase();
                                        return searchStr.includes(query.toLowerCase());
                                    }).slice(0, 10); // Limita a 10 resultados

                                    // Armazena no cache
                                    citiesCache[query] = filteredCities;

                                    // Exibe as sugestões
                                    displaySuggestions(filteredCities, currentNaturalidadeInput, currentSuggestionsContainer);

                                    // Remove classe de carregamento
                                    currentNaturalidadeInput.classList.remove('loading');
                                })
                                .catch(error => {
                                    console.error('Erro ao buscar cidades:', error);
                                    currentNaturalidadeInput.classList.remove('loading');
                                });
                        }
                    }, 300); // Tempo de espera para evitar consultas em cada tecla
                });

                // Função para exibir as sugestões (agora aceita o input e o container)
                function displaySuggestions(cities, targetInput, targetContainer) {
                    // Limpa o contêiner de sugestões
                    targetContainer.innerHTML = '';

                    if (cities.length === 0) {
                        targetContainer.style.display = 'none';
                        return;
                    }

                    // Cria um item para cada cidade
                    cities.forEach(city => {
                        const item = document.createElement('div');
                        item.className = 'suggestion-item';
                        item.textContent = `${city.nome} - ${city.microrregiao.mesorregiao.UF.sigla}`;
                        item.style.padding = '10px 12px';
                        item.style.cursor = 'pointer';
                        item.style.borderBottom = '1px solid var(--divider-color)';

                        // Adiciona efeito hover
                        item.addEventListener('mouseover', function() {
                            this.style.backgroundColor = 'var(--background-color)';
                        });

                        item.addEventListener('mouseout', function() {
                            this.style.backgroundColor = 'transparent';
                        });

                        // Adiciona evento de clique para selecionar a cidade
                        item.addEventListener('click', function() {
                            targetInput.value = this.textContent;
                            targetContainer.style.display = 'none';
                            // Opcional: Disparar um evento 'change' ou 'input' no input original
                            targetInput.dispatchEvent(new Event('input', { bubbles: true }));
                            targetInput.dispatchEvent(new Event('change', { bubbles: true }));
                        });

                        targetContainer.appendChild(item);
                    });

                    // Exibe o contêiner de sugestões
                    targetContainer.style.display = 'block';
                }

                // Fecha as sugestões ao clicar fora do campo
                 // Usar um listener global mais seguro
                 document.addEventListener('click', function(e) {
                    if (currentNaturalidadeInput && currentSuggestionsContainer) {
                         if (!currentNaturalidadeInput.contains(e.target) && !currentSuggestionsContainer.contains(e.target)) {
                             currentSuggestionsContainer.style.display = 'none';
                         }
                    }
                 });

                // Navegação por teclado nas sugestões
                currentNaturalidadeInput.addEventListener('keydown', function(e) {
                    const items = currentSuggestionsContainer.querySelectorAll('.suggestion-item');
                    if (!items.length || currentSuggestionsContainer.style.display === 'none') return;

                    const activeItem = currentSuggestionsContainer.querySelector('.suggestion-item.active');

                    // Tecla para baixo
                    if (e.key === 'ArrowDown') {
                        e.preventDefault();
                        if (!activeItem) {
                            items[0].classList.add('active');
                            items[0].style.backgroundColor = 'var(--background-color)';
                        } else {
                            const index = Array.from(items).indexOf(activeItem);
                            activeItem.classList.remove('active');
                            activeItem.style.backgroundColor = 'transparent';
                            const nextIndex = (index + 1) % items.length; // Wrap around
                            items[nextIndex].classList.add('active');
                            items[nextIndex].style.backgroundColor = 'var(--background-color)';
                            items[nextIndex].scrollIntoView({ block: 'nearest' });
                        }
                    }

                    // Tecla para cima
                    else if (e.key === 'ArrowUp') {
                        e.preventDefault();
                        if (!activeItem) {
                            items[items.length - 1].classList.add('active');
                            items[items.length - 1].style.backgroundColor = 'var(--background-color)';
                            items[items.length - 1].scrollIntoView({ block: 'nearest' });
                        } else {
                            const index = Array.from(items).indexOf(activeItem);
                            activeItem.classList.remove('active');
                            activeItem.style.backgroundColor = 'transparent';
                            const prevIndex = (index - 1 + items.length) % items.length; // Wrap around
                            items[prevIndex].classList.add('active');
                            items[prevIndex].style.backgroundColor = 'var(--background-color)';
                            items[prevIndex].scrollIntoView({ block: 'nearest' });
                        }
                    }

                    // Tecla Enter
                    else if (e.key === 'Enter' && activeItem) {
                        e.preventDefault();
                        currentNaturalidadeInput.value = activeItem.textContent;
                        currentSuggestionsContainer.style.display = 'none';
                         // Disparar evento de input/change
                        currentNaturalidadeInput.dispatchEvent(new Event('input', { bubbles: true }));
                        currentNaturalidadeInput.dispatchEvent(new Event('change', { bubbles: true }));
                    }

                    // Tecla Escape
                    else if (e.key === 'Escape') {
                        currentSuggestionsContainer.style.display = 'none';
                    }
                });
            }

            // Configura sugestões para Naturalidade do usuário
            setupNaturalidadeSuggestions('input_97');
            
            // Configura sugestões para Naturalidade do Cônjuge (será ativado quando a seção for visível)
            // A chamada será feita dentro de atualizarCamposConjuge para garantir que o campo exista
            
            // Melhoria condicional para o campo orgaoEmissor baseado no tipoDocumento
            const tipoDocumentoSelect = document.getElementById('input_105');
            
            if (tipoDocumentoSelect) {
                // Função para atualizar o campo de órgão emissor
                function atualizarCampoOrgaoEmissor() {
                    // Sempre obter a referência atual do campo
                    const orgaoEmissorField = document.getElementById('input_99');
                    if (!orgaoEmissorField) return;
                    
                    const tipoDoc = tipoDocumentoSelect.value;
                    // Guardar o valor atual antes de substituir o campo
                    const currentValue = orgaoEmissorField.value;
                    
                    // Guardar o elemento pai para readicionar o campo
                    const parent = orgaoEmissorField.parentNode;
                    
                    // Remove o campo atual
                    orgaoEmissorField.remove();
                    
                    let newField;
                    
                    if (tipoDoc === 'RG') {
                        // Transformar em um select para RG
                        newField = document.createElement('select');
                        newField.id = 'input_99';
                        newField.name = 'q99_orgaoEmissor';
                        newField.className = 'form-control';
                        newField.required = true;
                        
                        // Adicionar opções para órgãos emissores de RG
                        const options = [
                            {value: '', text: 'Selecione o órgão emissor'},
                            {value: 'SSP-AC', text: 'SSP-AC'}, {value: 'SSP-AL', text: 'SSP-AL'}, 
                            {value: 'SSP-AP', text: 'SSP-AP'}, {value: 'SSP-AM', text: 'SSP-AM'}, 
                            {value: 'SSP-BA', text: 'SSP-BA'}, {value: 'SSP-CE', text: 'SSP-CE'},
                            {value: 'SSP-DF', text: 'SSP-DF'}, {value: 'SSP-ES', text: 'SSP-ES'}, 
                            {value: 'SSP-GO', text: 'SSP-GO'}, {value: 'SSP-MA', text: 'SSP-MA'}, 
                            {value: 'SSP-MT', text: 'SSP-MT'}, {value: 'SSP-MS', text: 'SSP-MS'},
                            {value: 'SSP-MG', text: 'SSP-MG'}, {value: 'SSP-PA', text: 'SSP-PA'}, 
                            {value: 'SSP-PB', text: 'SSP-PB'}, {value: 'SSP-PR', text: 'SSP-PR'}, 
                            {value: 'SSP-PE', text: 'SSP-PE'}, {value: 'SSP-PI', text: 'SSP-PI'},
                            {value: 'SSP-RJ', text: 'SSP-RJ'}, {value: 'SSP-RN', text: 'SSP-RN'}, 
                            {value: 'SSP-RS', text: 'SSP-RS'}, {value: 'SSP-RO', text: 'SSP-RO'}, 
                            {value: 'SSP-RR', text: 'SSP-RR'}, {value: 'SSP-SC', text: 'SSP-SC'},
                            {value: 'SSP-SP', text: 'SSP-SP'}, {value: 'SSP-SE', text: 'SSP-SE'}, 
                            {value: 'SSP-TO', text: 'SSP-TO'},
                            {value: 'PC-AC', text: 'PC-AC'}, {value: 'PC-AL', text: 'PC-AL'}, 
                            {value: 'PC-AP', text: 'PC-AP'}, {value: 'PC-AM', text: 'PC-AM'}, 
                            {value: 'PC-BA', text: 'PC-BA'}, {value: 'PC-CE', text: 'PC-CE'},
                            {value: 'PC-DF', text: 'PC-DF'}, {value: 'PC-ES', text: 'PC-ES'}, 
                            {value: 'PC-GO', text: 'PC-GO'}, {value: 'PC-MA', text: 'PC-MA'}, 
                            {value: 'PC-MT', text: 'PC-MT'}, {value: 'PC-MS', text: 'PC-MS'},
                            {value: 'PC-MG', text: 'PC-MG'}, {value: 'PC-PA', text: 'PC-PA'}, 
                            {value: 'PC-PB', text: 'PC-PB'}, {value: 'PC-PR', text: 'PC-PR'}, 
                            {value: 'PC-PE', text: 'PC-PE'}, {value: 'PC-PI', text: 'PC-PI'},
                            {value: 'PC-RJ', text: 'PC-RJ'}, {value: 'PC-RN', text: 'PC-RN'}, 
                            {value: 'PC-RS', text: 'PC-RS'}, {value: 'PC-RO', text: 'PC-RO'}, 
                            {value: 'PC-RR', text: 'PC-RR'}, {value: 'PC-SC', text: 'PC-SC'},
                            {value: 'PC-SP', text: 'PC-SP'}, {value: 'PC-SE', text: 'PC-SE'}, 
                            {value: 'PC-TO', text: 'PC-TO'},
                            {value: 'DPF', text: 'DPF - Polícia Federal'},
                            {value: 'MAE', text: 'MAE - Ministério da Aeronáutica'},
                            {value: 'MEX', text: 'MEX - Ministério do Exército'},
                            {value: 'MMA', text: 'MMA - Ministério da Marinha'},
                            {value: 'OUTRO', text: 'Outro'}
                        ];
                        
                        options.forEach(opt => {
                            const option = document.createElement('option');
                            option.value = opt.value;
                            option.textContent = opt.text;
                            newField.appendChild(option);
                        });
                        
                    } else if (tipoDoc === 'CNH') {
                        // Transformar em um select para CNH
                        newField = document.createElement('select');
                        newField.id = 'input_99';
                        newField.name = 'q99_orgaoEmissor';
                        newField.className = 'form-control';
                        newField.required = true;
                        
                        // Adicionar opções para DETRAN de cada estado
                        const options = [
                            {value: '', text: 'Selecione o DETRAN'},
                            {value: 'DETRAN-AC', text: 'DETRAN-AC'}, {value: 'DETRAN-AL', text: 'DETRAN-AL'}, 
                            {value: 'DETRAN-AP', text: 'DETRAN-AP'}, {value: 'DETRAN-AM', text: 'DETRAN-AM'}, 
                            {value: 'DETRAN-BA', text: 'DETRAN-BA'}, {value: 'DETRAN-CE', text: 'DETRAN-CE'},
                            {value: 'DETRAN-DF', text: 'DETRAN-DF'}, {value: 'DETRAN-ES', text: 'DETRAN-ES'}, 
                            {value: 'DETRAN-GO', text: 'DETRAN-GO'}, {value: 'DETRAN-MA', text: 'DETRAN-MA'}, 
                            {value: 'DETRAN-MT', text: 'DETRAN-MT'}, {value: 'DETRAN-MS', text: 'DETRAN-MS'},
                            {value: 'DETRAN-MG', text: 'DETRAN-MG'}, {value: 'DETRAN-PA', text: 'DETRAN-PA'}, 
                            {value: 'DETRAN-PB', text: 'DETRAN-PB'}, {value: 'DETRAN-PR', text: 'DETRAN-PR'}, 
                            {value: 'DETRAN-PE', text: 'DETRAN-PE'}, {value: 'DETRAN-PI', text: 'DETRAN-PI'},
                            {value: 'DETRAN-RJ', text: 'DETRAN-RJ'}, {value: 'DETRAN-RN', text: 'DETRAN-RN'}, 
                            {value: 'DETRAN-RS', text: 'DETRAN-RS'}, {value: 'DETRAN-RO', text: 'DETRAN-RO'}, 
                            {value: 'DETRAN-RR', text: 'DETRAN-RR'}, {value: 'DETRAN-SC', text: 'DETRAN-SC'},
                            {value: 'DETRAN-SP', text: 'DETRAN-SP'}, {value: 'DETRAN-SE', text: 'DETRAN-SE'}, 
                            {value: 'DETRAN-TO', text: 'DETRAN-TO'}
                        ];
                        
                        options.forEach(opt => {
                            const option = document.createElement('option');
                            option.value = opt.value;
                            option.textContent = opt.text;
                            newField.appendChild(option);
                        });
                        
                    } else if (tipoDoc === 'Passaporte') {
                        // Campo de texto preenchido com Polícia Federal
                        newField = document.createElement('input');
                        newField.type = 'text';
                        newField.id = 'input_99';
                        newField.name = 'q99_orgaoEmissor';
                        newField.className = 'form-control';
                        newField.value = 'Polícia Federal';
                        newField.readOnly = true;
                        newField.required = true;
                        
                    } else {
                        // Campo de texto padrão para qualquer outro caso
                        newField = document.createElement('input');
                        newField.type = 'text';
                        newField.id = 'input_99';
                        newField.name = 'q99_orgaoEmissor';
                        newField.className = 'form-control';
                        newField.placeholder = 'Digite o órgão emissor';
                        newField.required = true;
                    }
                    
                    // Inserir o novo campo no DOM
                    parent.appendChild(newField);
                    
                    // Gerenciar evento de "outro" se for um select
                    if (newField.nodeName === 'SELECT') {
                        newField.addEventListener('change', function() {
                            if (this.value === 'OUTRO') {
                                // Substituir o select por um campo de texto
                                const textField = document.createElement('input');
                                textField.type = 'text';
                                textField.id = 'input_99';
                                textField.name = 'q99_orgaoEmissor';
                                textField.className = 'form-control';
                                textField.placeholder = 'Digite o órgão emissor';
                                textField.required = true;
                                
                                this.parentNode.replaceChild(textField, this);
                                textField.focus();
                            }
                        });
                    }
                    
                    // Tentar restaurar o valor anterior, se possível
                    if (currentValue && newField.nodeName === 'SELECT') {
                        const options = Array.from(newField.options);
                        const matchingOption = options.find(opt => opt.value === currentValue);
                        if (matchingOption) {
                            newField.value = currentValue;
                        }
                    } else if (newField.type === 'text' && !newField.readOnly) {
                        newField.value = currentValue;
                    }
                }
                
                // Atualizar o campo quando o tipo de documento mudar
                tipoDocumentoSelect.addEventListener('change', atualizarCampoOrgaoEmissor);
                
                // Aplicar imediatamente se já houver um tipo de documento selecionado
                if (tipoDocumentoSelect.value) {
                    atualizarCampoOrgaoEmissor();
                }
            }
            
            // Adicionar regra de validação para o campo telefone
            const visiblePhone = document.getElementById('input_118');
            
            if (visiblePhone) {
                // O campo já tem a configuração correta
            }
            
            // Opção "Mesmo Endereço" para copiar dados de Residência para Correspondência
            const sameAddressCheckbox = document.getElementById('same-address');
            if (sameAddressCheckbox) {
                sameAddressCheckbox.addEventListener('change', function() {
                    // Mapeia os campos correspondentes entre os endereços
                    const fieldMap = [
                        { from: 'input_215', to: 'input_108' }, // CEP
                        { from: 'input_216', to: 'input_109' }, // Logradouro
                        { from: 'input_217', to: 'input_112' }, // Número
                        { from: 'input_219', to: 'input_113' }, // Complemento
                        { from: 'input_220', to: 'input_111' }, // Bairro
                        { from: 'input_221', to: 'input_110' }, // Cidade
                        { from: 'input_222', to: 'input_114' }  // Estado
                    ];
                    
                    if (this.checked) {
                        // Copiar dados do endereço de residência para correspondência
                        fieldMap.forEach(pair => {
                            const sourceField = document.getElementById(pair.from);
                            const targetField = document.getElementById(pair.to);
                            
                            if (sourceField && targetField) {
                                // Para selects, copia o selectedIndex
                                if (sourceField.tagName === 'SELECT') {
                                    targetField.selectedIndex = sourceField.selectedIndex;
                                } else {
                                    // Para inputs, copia o value
                                    targetField.value = sourceField.value;
                                }
                                
                                // Adicionar classe visual para indicar campos preenchidos automaticamente
                                targetField.classList.add('auto-filled');
                                
                                // Desabilitar campos do endereço de residência
                                targetField.disabled = true;
                            }
                        });
                        
                        // Adicionar mensagem informativa
                        const infoMsg = document.createElement('div');
                        infoMsg.id = 'same-address-info';
                        infoMsg.className = 'form-hint';
                        infoMsg.textContent = 'Os campos foram preenchidos automaticamente com o endereço de residência.';
                        infoMsg.style.color = 'var(--secondary-color)';
                        infoMsg.style.marginBottom = '15px';
                        sameAddressCheckbox.parentNode.parentNode.appendChild(infoMsg);
                    } else {
                        // Habilitar campos e remover classe visual
                        fieldMap.forEach(pair => {
                            const targetField = document.getElementById(pair.to);
                            if (targetField) {
                                targetField.disabled = false;
                                targetField.classList.remove('auto-filled');
                                targetField.value = ''; // Limpar campos
                            }
                        });
                        
                        // Remover mensagem informativa
                        const infoMsg = document.getElementById('same-address-info');
                        if (infoMsg) infoMsg.remove();
                    }
                });
            }
            
            // Controle dos campos de Dados do Cônjuge baseado no Estado Civil
            const estadoCivilSelect = document.getElementById('input_103');
            if (estadoCivilSelect) {
                // Função para controlar a exibição e obrigatoriedade dos campos do cônjuge
                function atualizarCamposConjuge() {
                    const estadoCivil = estadoCivilSelect.value;
                    const mostrarCamposConjuge = (estadoCivil === 'Casado(a)' || estadoCivil === 'União Estável');
                    
                    // IDs dos campos do cônjuge
                    const camposConjugeIds = [
                        'input_225', 'input_226', 'input_227', 'input_228', 'input_229', 
                        'input_230', 'input_231', 'input_232', 'input_233', 'input_234',
                        'input_235', 'input_236', 'input_237'
                    ];
                    
                    // Obter o container da seção de dados do cônjuge
                    const secaoConjuge = document.querySelector('.form-section-title').parentNode;
                    const containerConjuge = secaoConjuge.parentNode.querySelectorAll('.form-row');
                    
                    // Localizar a seção de dados do cônjuge
                    let conjugeSection = null;
                    let conjugeRows = [];
                    let encontrouSecao = false;
                    
                    // Iterar por todos os form-row para identificar os que pertencem à seção do cônjuge
                    document.querySelectorAll('#tab-1 .form-section-title').forEach(title => {
                        if (title.textContent === 'Dados do Cônjuge' || title.textContent === 'Dados do Cônjuge (Obrigatório)') {
                            conjugeSection = title.parentNode;
                            encontrouSecao = true;
                        }
                    });
                    
                    if (encontrouSecao) {
                        // Encontrar todos os form-rows após a seção de dados do cônjuge
                        let currentElement = conjugeSection;
                        
                        while (currentElement.nextElementSibling && 
                              !currentElement.nextElementSibling.classList.contains('form-section-header') &&
                              !currentElement.nextElementSibling.classList.contains('nav-buttons')) {
                            currentElement = currentElement.nextElementSibling;
                            if (currentElement.classList.contains('form-row')) {
                                conjugeRows.push(currentElement);
                            }
                        }
                        
                        // Também incluir a seção de título
                        conjugeRows.unshift(conjugeSection);
                        
                        // Mostrar ou esconder a seção do cônjuge
                        conjugeRows.forEach(row => {
                            if (mostrarCamposConjuge) {
                                row.style.display = '';
                            } else {
                                row.style.display = 'none';
                            }
                        });
                        
                        // Replicar o estado civil do usuário para o cônjuge
                        if (mostrarCamposConjuge) {
                            const conjugeEstadoCivilSelect = document.getElementById('input_227');
                            if (conjugeEstadoCivilSelect) {
                                // Encontrar a mesma opção no select do cônjuge
                                for (let i = 0; i < conjugeEstadoCivilSelect.options.length; i++) {
                                    if (conjugeEstadoCivilSelect.options[i].value === estadoCivil) {
                                        conjugeEstadoCivilSelect.selectedIndex = i;
                                        break;
                                    }
                                }
                            }
                        }
                        
                        // Replicar a Nacionalidade do usuário para o cônjuge
                        if (mostrarCamposConjuge) {
                            const nacionalidadeUsuario = document.getElementById('input_96');
                            const nacionalidadeConjuge = document.getElementById('input_229');
                            if (nacionalidadeUsuario && nacionalidadeConjuge) {
                                nacionalidadeConjuge.value = nacionalidadeUsuario.value;
                            }
                        }
                        
                        // Tornar os campos obrigatórios ou não
                        camposConjugeIds.forEach(id => {
                            const campo = document.getElementById(id);
                            if (campo) {
                                // Nome do Pai (input_237) não deve ser obrigatório
                                campo.required = mostrarCamposConjuge && id !== 'input_237';
                                
                                // Atualizar o label para incluir ou remover o indicador de obrigatório
                                const label = campo.previousElementSibling;
                                if (label && label.classList.contains('form-label')) {
                                    if (mostrarCamposConjuge && id !== 'input_237') {
                                        label.classList.add('required');
                                    } else {
                                        label.classList.remove('required');
                                    }
                                }
                                
                                // Limpar o valor quando os campos estão ocultos
                                if (!mostrarCamposConjuge) {
                                    campo.value = '';
                                    if (campo.tagName === 'SELECT') {
                                        campo.selectedIndex = 0;
                                    }
                                }
                            }
                        });
                        
                        // Atualizar texto do título da seção com indicação
                        const tituloSecao = conjugeSection.querySelector('.form-section-title');
                        if (tituloSecao) {
                            if (mostrarCamposConjuge) {
                                tituloSecao.textContent = 'Dados do Cônjuge (Obrigatório)';
                                
                                // Inicializar a funcionalidade de tipo de documento e órgão emissor do cônjuge se estiver visível
                                if (typeof atualizarCampoOrgaoEmissorConjuge === 'function') {
                                    setTimeout(atualizarCampoOrgaoEmissorConjuge, 20);
                                }
                            } else {
                                tituloSecao.textContent = 'Dados do Cônjuge';
                            }
                        }
                        
                        // Inicializar a funcionalidade de tipo de documento e órgão emissor do cônjuge
                        if (mostrarCamposConjuge && typeof atualizarCampoOrgaoEmissorConjuge === 'function') {
                            setTimeout(atualizarCampoOrgaoEmissorConjuge, 20);
                        }

                        // Configurar sugestões de Naturalidade para o cônjuge APENAS QUANDO VISÍVEL
                         setupNaturalidadeSuggestions('input_230');
                    }
                }
                
                // Adicionar evento para quando o estado civil for alterado
                estadoCivilSelect.addEventListener('change', function() {
                    // Executar com um pequeno atraso para garantir a atualização do DOM
                    setTimeout(atualizarCamposConjuge, 10);
                });
                
                // Executar no carregamento para configurar o estado inicial
                setTimeout(atualizarCamposConjuge, 100);
            }
            
            // Aplicar validações aos campos do cônjuge quando visíveis
            function aplicarValidacoesConjuge() {
                const estadoCivil = document.getElementById('input_103').value;
                const mostrarCamposConjuge = (estadoCivil === 'Casado(a)' || estadoCivil === 'União Estável');

                // IDs dos campos obrigatórios do cônjuge (exceto Nome do Pai)
                const conjugeRequiredFieldIds = [
                    'input_225', 'input_226', 'input_227', 'input_228', 'input_229',
                    'input_230', 'input_231', 'input_232', 'input_233', 'input_234',
                    'input_235', 'input_236'
                ];

                if (mostrarCamposConjuge) {
                    console.log("[VALIDATION SETUP] Aplicando validações aos campos do cônjuge.");

                    // Helper function to safely add listeners
                    function addValidationListener(elementId, eventType, handler) {
                        const element = document.getElementById(elementId);
                        if (element) {
                            const listenerAttr = `data-${eventType}-listener-set-${elementId}`;
                            if (!element.getAttribute(listenerAttr)) {
                                element.addEventListener(eventType, handler);
                                element.setAttribute(listenerAttr, 'true');
                                console.log(`[VALIDATION SETUP] Listener ${eventType} adicionado para ${elementId}`);
                            }
                        } else {
                             console.warn(`[VALIDATION SETUP] Elemento ${elementId} não encontrado para adicionar listener.`);
                        }
                    }

                    // Itera por todos os campos obrigatórios do cônjuge
                    conjugeRequiredFieldIds.forEach(fieldId => {
                        const field = document.getElementById(fieldId);
                        if (!field) return; // Skip if field not found

                        const isTextField = (field.tagName === 'INPUT' && field.type === 'text') || field.tagName === 'TEXTAREA';
                        const isSelectField = field.tagName === 'SELECT';

                        // --- Listener de Interação Inicial (Input/Change) para limpar "Obrigatório" ---
                        const initialEventType = isSelectField ? 'change' : 'input';
                        addValidationListener(fieldId, initialEventType, function() {
                            // 1. Remover erro "Obrigatório" imediatamente se houver valor
                            const requiredErrorMsgId = this.id + '-required-error';
                            const requiredErrorMsg = document.getElementById(requiredErrorMsgId);
                            if (this.value && this.value.trim()) { // Verifica se há algum valor (para input) ou se não é a opção vazia (para select)
                                if (requiredErrorMsg) {
                                    requiredErrorMsg.remove();
                                    console.log(`[Listener ${initialEventType}] Removed required message for ${this.id}`);
                                    // Tenta limpar estilos básicos se o campo não tiver *outros* erros visíveis
                                    if (!hasOtherErrors(this)) {
                                         this.style.borderColor = '';
                                         this.style.backgroundColor = '';
                                         this.classList.remove('error');
                                    }
                                } else {
                                     // Se não havia msg de erro obrigatório, apenas reseta estilo se não houver outros erros
                                     if (!hasOtherErrors(this)) {
                                         this.style.borderColor = '';
                                         this.style.backgroundColor = '';
                                         this.classList.remove('error');
                                     }
                                 }
                            } // Fim da limpeza do erro obrigatório

                            // 2. Formatação/Validação ativa durante a digitação/mudança

                            // 3. Chamar validação específica se necessário (exceto selects que validam no change)
                            if (fieldId === 'input_228') { // CPF
                                // Formatação ativa do CPF
                                let value = this.value.replace(/\D/g, '');
                                if (value.length > 11) value = value.substring(0, 11);
                                if (value.length > 9) this.value = value.replace(/(\d{3})(\d{3})(\d{3})(\d{1,2})/, '$1.$2.$3-$4');
                                else if (value.length > 6) this.value = value.replace(/(\d{3})(\d{3})(\d{1,3})/, '$1.$2.$3');
                                else if (value.length > 3) this.value = value.replace(/(\d{3})(\d{1,3})/, '$1.$2');
                                else this.value = value;
                                validateCPF(this);
                            } else if (isTextField && fieldId !== 'input_231' && fieldId !== 'input_234' && fieldId !== 'input_233') {
                                // Filtragem ativa para Nomes
                                if (['input_225', 'input_236'].includes(fieldId)) {
                                      let sanitizedValue = this.value.replace(/[^a-zA-ZÀ-ÖØ-öø-ÿ\s'-]/g, '');
                                      if (this.value !== sanitizedValue) this.value = sanitizedValue;
                                 }
                                validateSpecialChars(this);
                            } else if (fieldId === 'input_233') {
                                // Formatação ativa para Nº Documento (baseado no tipo)
                                // A lógica está em applyDocumentNumberRules, mas chamamos a validação de char aqui
                                 validateSpecialChars(this); // Validar chars permitidos
                             }
                             // Datas (input_231, input_234) validam no blur
                             // Selects (input_226, input_227, input_232, input_235) validam no change/blur
                        });

                        // --- Listener de Blur para Validação Final do Formato/Regra ---
                        if (fieldId !== 'input_226' && fieldId !== 'input_227' && fieldId !== 'input_232') { // Selects não precisam de blur extra geralmente
                             addValidationListener(fieldId, 'blur', function() {
                                 // Remover erro "Obrigatório" se ainda existir e tiver valor
                                 const requiredErrorMsgId = this.id + '-required-error';
                                 const requiredErrorMsg = document.getElementById(requiredErrorMsgId);
                                 if (requiredErrorMsg && this.value.trim()) { requiredErrorMsg.remove(); }

                                 // Chamar validação específica
                                 if (fieldId === 'input_228') validateCPF(this);
                                 else if (fieldId === 'input_231') validateAge(this);
                                 else if (fieldId === 'input_234') validateDate(this);
                                 else if (isTextField) validateSpecialChars(this);
                                  // Para Órgão Emissor (input_235), a validação de char já cobre se for texto
                             });
                         }

                        // --- Lógica Específica para Selects (change) ---
                         if (isSelectField) {
                             addValidationListener(fieldId, 'change', function() {
                                 // Remover erro "Obrigatório" se valor selecionado
                                 const requiredErrorMsgId = this.id + '-required-error';
                                 const requiredErrorMsg = document.getElementById(requiredErrorMsgId);
                                 if (this.value && requiredErrorMsg) {
                                     requiredErrorMsg.remove();
                                     // Tenta limpar estilos básicos
                                     if (!hasOtherErrors(this)) {
                                         this.style.borderColor = '';
                                         this.style.backgroundColor = '';
                                     }
                                 }

                                 // Lógica adicional para Tipo de Documento (input_232)
                                 if (fieldId === 'input_232') {
                                     if (typeof atualizarCampoOrgaoEmissorConjuge === 'function') {
                                         atualizarCampoOrgaoEmissorConjuge();
                                     }
                                     applyDocumentNumberRules('input_232', 'input_233');
                                      // Revalidar Órgão Emissor (input_235) após a troca
                                      const orgaoEmissorConj = document.getElementById('input_235');
                                      if(orgaoEmissorConj && orgaoEmissorConj.required && !orgaoEmissorConj.value) {
                                          // Se o novo campo for obrigatório e estiver vazio, pode mostrar erro
                                          // Mas idealmente a lógica de atualização já lida com isso.
                                          // Poderia chamar validateTabFields aqui, mas pode ser complexo.
                                          // Por ora, a limpeza do erro obrigatório no change é suficiente.
                                      }
                                 }
                                  // Para Órgão Emissor (input_235) se for select, validação é implícita pela seleção.
                             });
                         }

                        // --- Validação Inicial (se campo já tem valor quando seção aparece) ---
                        if (field.value.trim()) {
                             console.log(`[VALIDATION SETUP] Validando valor inicial de ${fieldId}`);
                             if (fieldId === 'input_228') validateCPF(field);
                             else if (fieldId === 'input_231') validateAge(field);
                             else if (fieldId === 'input_234') validateDate(field);
                             else if (isTextField) validateSpecialChars(field);
                             // Selects com valor inicial não precisam de validação extra aqui,
                             // a não ser que o valor pré-selecionado seja inválido por alguma regra.
                         }
                    });

                    // Aplicar regras ao número do documento (input_233) inicialmente
                     applyDocumentNumberRules('input_232', 'input_233');
                      // Atualizar órgão emissor (input_235) inicialmente
                      if (typeof atualizarCampoOrgaoEmissorConjuge === 'function') {
                           atualizarCampoOrgaoEmissorConjuge();
                      }

                } else {
                    console.log("[VALIDATION SETUP] Campos do cônjuge ocultos, validações não aplicadas.");
                    // Opcional: Limpar atributos data-* ou remover listeners se a seção for ocultada novamente.
                    // Por simplicidade, a abordagem atual com data-* evita duplicação na re-exibição.
                }
            }

            // Executar a validação quando o formulário carrega
            setTimeout(aplicarValidacoesConjuge, 200);

            // Função para aplicar regras ao campo de número de documento baseado no tipo
            function applyDocumentNumberRules(typeSelectId, numberInputId) {
                const typeSelect = document.getElementById(typeSelectId);
                const numberInput = document.getElementById(numberInputId);

                if (!typeSelect || !numberInput) {
                    console.warn(`Element not found for validation rule update: ${typeSelectId} or ${numberInputId}`);
                    return; // Sai se os elementos não existirem (ex: cônjuge oculto)
                }

                const selectedType = typeSelect.value;

                // --- Clone to remove old listeners ---
                const oldNumberInput = numberInput;
                const newNumberInput = oldNumberInput.cloneNode(true);
                oldNumberInput.parentNode.replaceChild(newNumberInput, oldNumberInput);
                const currentNumberInput = document.getElementById(numberInputId); // Get the new reference

                // --- Shared Input Listener Logic ---
                 const sharedInputHandler = function() {
                     // 1. Remove 'required' error if present and field has value
                     const requiredErrorMsgId = this.id + '-required-error';
                     const requiredErrorMsg = document.getElementById(requiredErrorMsgId);
                     if (this.value.trim() && requiredErrorMsg) {
                         requiredErrorMsg.remove();
                         // Conditionally reset styles only if no *other* errors are detected
                         if (!hasOtherErrors(this)) {
                              this.style.borderColor = '';
                              this.style.backgroundColor = '';
                              this.classList.remove('error'); // Remove general error class if used
                         }
                     } else if (this.value.trim() && !requiredErrorMsg) {
                         // If no required message, still reset styles if no other errors
                         if (!hasOtherErrors(this)) {
                             this.style.borderColor = '';
                             this.style.backgroundColor = '';
                             this.classList.remove('error');
                         }
                     }

                     // 2. Apply type-specific filtering (will be added below in switch)
                 };

                // --- Reset common attributes and clear previous errors/styles ---
                currentNumberInput.placeholder = 'Nº do Documento';
                currentNumberInput.removeAttribute('pattern');
                currentNumberInput.removeAttribute('maxlength');
                currentNumberInput.inputMode = 'text'; // Default

                 // Clear any existing validation messages and styles associated with this input
                 clearValidationStyles(currentNumberInput, currentNumberInput.id); // Use the helper to clear specific format/validation errors

                // --- Apply Specific Rules ---
                switch (selectedType) {
                    case 'RG':
                        currentNumberInput.placeholder = 'Apenas números e X';
                        currentNumberInput.inputMode = 'text'; // Allow X
                        currentNumberInput.maxLength = 20;
                        currentNumberInput.addEventListener('input', function() {
                             sharedInputHandler.call(this); // Call shared logic first
                             // Specific filtering for RG
                             this.value = this.value.replace(/[^0-9Xx]/g, '');
                             // Optional: Add real-time special char check if needed for RG specifically
                             // validateSpecialChars(this);
                         });
                        break;
                    case 'CNH':
                        currentNumberInput.placeholder = '11 dígitos numéricos';
                        currentNumberInput.inputMode = 'text';
                        currentNumberInput.minLength = 11;
                        currentNumberInput.maxLength = 11;
                        currentNumberInput.addEventListener('input', function() {
                             // sharedInputHandler.call(this); // Temporarily comment out shared logic to isolate filtering
                             // Specific filtering for CNH - ONLY allow digits
                             this.value = this.value.replace(/[^0-9]/g, '');
                         });
                        break;
                    case 'Passaporte':
                        currentNumberInput.placeholder = 'LLNNNNNN (ex: AA123456)';
                        currentNumberInput.inputMode = 'text'; // Allow letters
                        currentNumberInput.pattern = '^[a-zA-Z]{2}\\d{6}$';
                        currentNumberInput.maxLength = 8;
                        currentNumberInput.addEventListener('input', function() {
                             sharedInputHandler.call(this); // Call shared logic first
                             // Specific filtering for Passport
                             let value = this.value.replace(/[^a-zA-Z0-9]/g, '').toUpperCase();
                             if (value.length > 8) value = value.slice(0, 8);
                             this.value = value;
                         });
                         // Add blur listener for Passport format validation
                         currentNumberInput.addEventListener('blur', function() {
                             const baseMsgId = this.id + '-passport';
                             clearValidationStyles(this, baseMsgId); // Clear specific messages

                             if (this.value.length === 0) {
                                 if (!hasOtherErrors(this)) {
                                     this.style.borderColor = '';
                                     this.style.backgroundColor = '';
                                     this.classList.remove('error');
                                 }
                                 return;
                             }

                             if (!this.checkValidity()) { // Use built-in pattern check
                                 showError(this, 'Formato de passaporte inválido (Ex: AA123456).', baseMsgId + '-error-msg');
                             } else {
                                 // Optional: Add success indication
                                 // showSuccess(this, 'Formato válido.', baseMsgId + '-success-msg');
                                 this.style.borderColor = 'var(--secondary-color)';
                             }
                         });
                        break;
                    default:
                         // For "Selecione" or other types where no specific rules apply, add the shared handler
                         currentNumberInput.addEventListener('input', sharedInputHandler);
                        break;
                }
            }

            // Anexar ouvintes de evento aos seletores de tipo de documento
            const userDocTypeSelect = document.getElementById('input_105');
            const spouseDocTypeSelect = document.getElementById('input_232');

            if (userDocTypeSelect) {
                userDocTypeSelect.addEventListener('change', () => {
                    applyDocumentNumberRules('input_105', 'input_98');
                    // Também atualiza órgão emissor (lógica existente)
                    if (typeof atualizarCampoOrgaoEmissor === 'function') {
                       atualizarCampoOrgaoEmissor();
                    }
                });
                 // Aplicar regras iniciais no carregamento para o usuário
                 applyDocumentNumberRules('input_105', 'input_98');
            }

            if (spouseDocTypeSelect) {
                spouseDocTypeSelect.addEventListener('change', () => {
                    applyDocumentNumberRules('input_232', 'input_233');
                    // Chamar função similar para órgão emissor do cônjuge se existir
                     if (typeof atualizarCampoOrgaoEmissorConjuge === 'function') {
                       atualizarCampoOrgaoEmissorConjuge();
                    }
                });
                // Aplicar regras iniciais no carregamento para o cônjuge (se visível)
                // A lógica de visibilidade já deve garantir que isso funcione corretamente
                 applyDocumentNumberRules('input_232', 'input_233');
            }

            // Função para atualizar o campo de órgão emissor do cônjuge
            function atualizarCampoOrgaoEmissorConjuge() {
                // Selecionar o tipo de documento do cônjuge
                const tipoDocumentoConjugeSelect = document.getElementById('input_232');
                // Tentar obter o campo de órgão emissor do cônjuge
                const orgaoEmissorConjugeField = document.getElementById('input_235');

                // Limpar mensagens de erro existentes ANTES de remover o campo
                if (orgaoEmissorConjugeField) {
                    const parentGroup = orgaoEmissorConjugeField.closest('.form-group');
                    if (parentGroup) {
                        const errorMessages = parentGroup.querySelectorAll('.error-message');
                        errorMessages.forEach(msg => msg.remove());
                    }
                    // Remover estilos de erro do campo antigo
                    orgaoEmissorConjugeField.style.borderColor = '';
                    orgaoEmissorConjugeField.style.backgroundColor = '';
                }

                // Se o select ou o campo não existirem (por exemplo, seção oculta), não fazer nada
                if (!tipoDocumentoConjugeSelect || !orgaoEmissorConjugeField) {
                     console.warn('Campos do cônjuge não encontrados para atualizar órgão emissor.');
                     return;
                }

                const tipoDocConjuge = tipoDocumentoConjugeSelect.value;
                // Guardar o valor atual antes de substituir o campo
                const currentValue = orgaoEmissorConjugeField.value;

                // Guardar o elemento pai para readicionar o campo
                const parent = orgaoEmissorConjugeField.parentNode;

                // Remove o campo atual APÓS limpar erros
                orgaoEmissorConjugeField.remove();

                let newField;

                if (tipoDocConjuge === 'RG') {
                    // Transformar em um select para RG do cônjuge
                    newField = document.createElement('select');
                    newField.id = 'input_235';
                    newField.name = 'q235_orgaoEmissorConjuge';
                    newField.className = 'form-control';
                    newField.required = true; // Assumindo que é obrigatório se a seção está visível

                    // Adicionar opções para órgãos emissores de RG (mesmas opções)
                    const options = [
                        {value: '', text: 'Selecione o órgão emissor'},
                        {value: 'SSP-AC', text: 'SSP-AC'}, {value: 'SSP-AL', text: 'SSP-AL'},
                        {value: 'SSP-AP', text: 'SSP-AP'}, {value: 'SSP-AM', text: 'SSP-AM'},
                        {value: 'SSP-BA', text: 'SSP-BA'}, {value: 'SSP-CE', text: 'SSP-CE'},
                        {value: 'SSP-DF', text: 'SSP-DF'}, {value: 'SSP-ES', text: 'SSP-ES'},
                        {value: 'SSP-GO', text: 'SSP-GO'}, {value: 'SSP-MA', text: 'SSP-MA'},
                        {value: 'SSP-MT', text: 'SSP-MT'}, {value: 'SSP-MS', text: 'SSP-MS'},
                        {value: 'SSP-MG', text: 'SSP-MG'}, {value: 'SSP-PA', text: 'SSP-PA'},
                        {value: 'SSP-PB', text: 'SSP-PB'}, {value: 'SSP-PR', text: 'SSP-PR'},
                        {value: 'SSP-PE', text: 'SSP-PE'}, {value: 'SSP-PI', text: 'SSP-PI'},
                        {value: 'SSP-RJ', text: 'SSP-RJ'}, {value: 'SSP-RN', text: 'SSP-RN'},
                        {value: 'SSP-RS', text: 'SSP-RS'}, {value: 'SSP-RO', text: 'SSP-RO'},
                        {value: 'SSP-RR', text: 'SSP-RR'}, {value: 'SSP-SC', text: 'SSP-SC'},
                        {value: 'SSP-SP', text: 'SSP-SP'}, {value: 'SSP-SE', text: 'SSP-SE'},
                        {value: 'SSP-TO', text: 'SSP-TO'},
                        {value: 'PC-AC', text: 'PC-AC'}, {value: 'PC-AL', text: 'PC-AL'},
                        {value: 'PC-AP', text: 'PC-AP'}, {value: 'PC-AM', text: 'PC-AM'},
                        {value: 'PC-BA', text: 'PC-BA'}, {value: 'PC-CE', text: 'PC-CE'},
                        {value: 'PC-DF', text: 'PC-DF'}, {value: 'PC-ES', text: 'PC-ES'},
                        {value: 'PC-GO', text: 'PC-GO'}, {value: 'PC-MA', text: 'PC-MA'},
                        {value: 'PC-MT', text: 'PC-MT'}, {value: 'PC-MS', text: 'PC-MS'},
                        {value: 'PC-MG', text: 'PC-MG'}, {value: 'PC-PA', text: 'PC-PA'},
                        {value: 'PC-PB', text: 'PC-PB'}, {value: 'PC-PR', text: 'PC-PR'},
                        {value: 'PC-PE', text: 'PC-PE'}, {value: 'PC-PI', text: 'PC-PI'},
                        {value: 'PC-RJ', text: 'PC-RJ'}, {value: 'PC-RN', text: 'PC-RN'},
                        {value: 'PC-RS', text: 'PC-RS'}, {value: 'PC-RO', text: 'PC-RO'},
                        {value: 'PC-RR', text: 'PC-RR'}, {value: 'PC-SC', text: 'PC-SC'},
                        {value: 'PC-SP', text: 'PC-SP'}, {value: 'PC-SE', text: 'PC-SE'},
                        {value: 'PC-TO', text: 'PC-TO'},
                        {value: 'DPF', text: 'DPF - Polícia Federal'},
                        {value: 'MAE', text: 'MAE - Ministério da Aeronáutica'},
                        {value: 'MEX', text: 'MEX - Ministério do Exército'},
                        {value: 'MMA', text: 'MMA - Ministério da Marinha'},
                        {value: 'OUTRO', text: 'Outro'}
                    ];

                    options.forEach(opt => {
                        const option = document.createElement('option');
                        option.value = opt.value;
                        option.textContent = opt.text;
                        newField.appendChild(option);
                    });

                } else if (tipoDocConjuge === 'CNH') {
                    // Transformar em um select para CNH do cônjuge
                    newField = document.createElement('select');
                    newField.id = 'input_235';
                    newField.name = 'q235_orgaoEmissorConjuge';
                    newField.className = 'form-control';
                    newField.required = true; // Assumindo que é obrigatório

                    // Adicionar opções para DETRAN de cada estado (mesmas opções)
                    const options = [
                        {value: '', text: 'Selecione o DETRAN'},
                        {value: 'DETRAN-AC', text: 'DETRAN-AC'}, {value: 'DETRAN-AL', text: 'DETRAN-AL'},
                        {value: 'DETRAN-AP', text: 'DETRAN-AP'}, {value: 'DETRAN-AM', text: 'DETRAN-AM'},
                        {value: 'DETRAN-BA', text: 'DETRAN-BA'}, {value: 'DETRAN-CE', text: 'DETRAN-CE'},
                        {value: 'DETRAN-DF', text: 'DETRAN-DF'}, {value: 'DETRAN-ES', text: 'DETRAN-ES'},
                        {value: 'DETRAN-GO', text: 'DETRAN-GO'}, {value: 'DETRAN-MA', text: 'DETRAN-MA'},
                        {value: 'DETRAN-MT', text: 'DETRAN-MT'}, {value: 'DETRAN-MS', text: 'DETRAN-MS'},
                        {value: 'DETRAN-MG', text: 'DETRAN-MG'}, {value: 'DETRAN-PA', text: 'DETRAN-PA'},
                        {value: 'DETRAN-PB', text: 'DETRAN-PB'}, {value: 'DETRAN-PR', text: 'DETRAN-PR'},
                        {value: 'DETRAN-PE', text: 'DETRAN-PE'}, {value: 'DETRAN-PI', text: 'DETRAN-PI'},
                        {value: 'DETRAN-RJ', text: 'DETRAN-RJ'}, {value: 'DETRAN-RN', text: 'DETRAN-RN'},
                        {value: 'DETRAN-RS', text: 'DETRAN-RS'}, {value: 'DETRAN-RO', text: 'DETRAN-RO'},
                        {value: 'DETRAN-RR', text: 'DETRAN-RR'}, {value: 'DETRAN-SC', text: 'DETRAN-SC'},
                        {value: 'DETRAN-SP', text: 'DETRAN-SP'}, {value: 'DETRAN-SE', text: 'DETRAN-SE'},
                        {value: 'DETRAN-TO', text: 'DETRAN-TO'}
                    ];

                    options.forEach(opt => {
                        const option = document.createElement('option');
                        option.value = opt.value;
                        option.textContent = opt.text;
                        newField.appendChild(option);
                    });

                } else if (tipoDocConjuge === 'Passaporte') {
                    // Campo de texto preenchido com Polícia Federal para cônjuge
                    newField = document.createElement('input');
                    newField.type = 'text';
                    newField.id = 'input_235';
                    newField.name = 'q235_orgaoEmissorConjuge';
                    newField.className = 'form-control';
                    newField.value = 'Polícia Federal';
                    newField.readOnly = true;
                    newField.required = true; // Assumindo que é obrigatório

                } else {
                    // Campo de texto padrão para cônjuge
                    newField = document.createElement('input');
                    newField.type = 'text';
                    newField.id = 'input_235';
                    newField.name = 'q235_orgaoEmissorConjuge';
                    newField.className = 'form-control';
                    newField.placeholder = 'Digite o órgão emissor';
                    newField.required = true; // Assumindo que é obrigatório
                }

                // Inserir o novo campo no DOM
                parent.appendChild(newField);

                // Gerenciar evento de "outro" se for um select (para RG do cônjuge)
                if (newField.nodeName === 'SELECT' && tipoDocConjuge === 'RG') {
                    newField.addEventListener('change', function() {
                        if (this.value === 'OUTRO') {
                            // Substituir o select por um campo de texto
                            const textField = document.createElement('input');
                            textField.type = 'text';
                            textField.id = 'input_235';
                            textField.name = 'q235_orgaoEmissorConjuge';
                            textField.className = 'form-control';
                            textField.placeholder = 'Digite o órgão emissor';
                            textField.required = true;

                            this.parentNode.replaceChild(textField, this);
                            textField.focus();
                        }
                    });
                }

                // Tentar restaurar o valor anterior, se possível
                if (currentValue && newField.nodeName === 'SELECT') {
                    const options = Array.from(newField.options);
                    const matchingOption = options.find(opt => opt.value === currentValue);
                    if (matchingOption) {
                        newField.value = currentValue;
                    }
                } else if (newField.type === 'text' && !newField.readOnly) {
                    newField.value = currentValue;
                }
             }

            // --- Add listeners to remove the 'required' errors ---

            // Helper to check for other error messages for a field/container
            function hasOtherErrors(field, isGroup = false, groupName = '') {
                const container = isGroup ? field.closest('.form-group') : field.parentNode;
                if (!container) return false;

                const potentialErrorMessages = container.querySelectorAll('.error-message');
                const requiredErrorMsgId = isGroup ? groupName + '-required-error' : field.id + '-required-error';

                for (let msg of potentialErrorMessages) {
                    // Check if the message is NOT the 'required' error message we are about to remove
                    if (msg.id !== requiredErrorMsgId) {
                        return true; // Found another error message
                    }
                }
                 // Check for specific error classes on the field itself (if not a group check)
                 if (!isGroup && (field.classList.contains('special-char-error') || field.classList.contains('error') /* Add other relevant error classes */)) {
                     return true;
                 }
                 // For groups, we might check the container's outline, but the message check is usually sufficient
                return false; // No other errors found
            }

            // Generic listener for input fields (text, email, tel, etc.)
            document.querySelectorAll('input[required]:not([type="radio"]):not([type="checkbox"]), textarea[required]').forEach(field => {
                field.addEventListener('input', function() {
                    const requiredErrorMsgId = this.id + '-required-error';
                    const requiredErrorMsg = document.getElementById(requiredErrorMsgId);
                    if (this.value.trim() && requiredErrorMsg) {
                        requiredErrorMsg.remove(); // Remove the 'required' message
                        // Only reset style if no other errors remain
                        if (!hasOtherErrors(this)) {
                            this.style.borderColor = '';
                            this.style.backgroundColor = '';
                        }
                    }
                });
            });

            // Generic listener for select fields
            document.querySelectorAll('select[required]').forEach(field => {
                field.addEventListener('change', function() {
                    const requiredErrorMsgId = this.id + '-required-error';
                    const requiredErrorMsg = document.getElementById(requiredErrorMsgId);
                    if (this.value && requiredErrorMsg) {
                         requiredErrorMsg.remove(); // Remove the 'required' message
                        // Only reset style if no other errors remain
                         if (!hasOtherErrors(this)) {
                             this.style.borderColor = '';
                             this.style.backgroundColor = '';
                         }
                    }
                });
            });

            // Listener for radio buttons
            document.querySelectorAll('input[type="radio"][required]').forEach(radio => {
                 radio.addEventListener('change', function() {
                     const groupName = this.name;
                     const groupRadios = document.querySelectorAll(`input[type="radio"][name="${groupName}"]`);
                     const isChecked = Array.from(groupRadios).some(r => r.checked);
                     const requiredErrorMsgId = groupName + '-required-error';
                     const requiredErrorMsg = document.getElementById(requiredErrorMsgId);
                     const errorContainer = this.closest('.form-group'); // Find container

                     if (isChecked && requiredErrorMsg && errorContainer) {
                         requiredErrorMsg.remove();
                         // Only remove highlight if no other group errors exist
                          if (!hasOtherErrors(this, true, groupName)) {
                             errorContainer.style.outline = '';
                          }
                     }
                 });
             });

             // Listener for checkboxes
             document.querySelectorAll('input[type="checkbox"][required]').forEach(checkbox => {
                 checkbox.addEventListener('change', function() {
                     const groupName = this.name;
                     const groupCheckboxes = document.querySelectorAll(`input[type="checkbox"][name="${groupName}"]`);
                     const isChecked = Array.from(groupCheckboxes).some(c => c.checked);
                     const requiredErrorMsgId = groupName + '-required-error';
                     const requiredErrorMsg = document.getElementById(requiredErrorMsgId);
                     const errorContainer = this.closest('.form-group'); // Find container

                     if (isChecked && requiredErrorMsg && errorContainer) {
                         requiredErrorMsg.remove();
                         // Only remove highlight if no other group errors exist
                         if (!hasOtherErrors(this, true, groupName)) {
                             errorContainer.style.outline = '';
                         }
                     }
                 });
             });

            // --- START: Autocomplete for Occupation Fields ---
            const professionsRawData = [
                {"code": "ACOUGUEIRO", "name": "Açougueiro"}, {"code": "ACUMPURISTA", "name": "Acumpurista"},
                {"code": "ADESTRADOR", "name": "Adestrador/Tratador de Animais/Treinador de Animais"},
                {"code": "ADMINISTRADOR", "name": "Administrador"}, {"code": "ADVOGADO", "name": "Advogado"},
                {"code": "AEROVIARIO", "name": "Aeroviario/Empregado de Aeroporto"}, {"code": "AFIADOR", "name": "Afiador"},
                {"code": "AGENCIADOR_DE_PROPAGANDA", "name": "Agenciador de Propaganda"},
                {"code": "AGENCIADOR_CARGAS_TRANSPORTES", "name": "Agenciador de Serv. (Cargas/Transportes)"},
                {"code": "AGENTE_ADMINISTRATIVO", "name": "Agente Administrativo"},
                {"code": "AGENTE_DE_COMPRA_VENDA", "name": "Agente de Compra e Venda"},
                {"code": "AGENTE_DE_SERVICOS_FUNERARIOS", "name": "Agente de Serviços Funerarios"},
                {"code": "AGENTE_DE_VIAGEM", "name": "Agente de viagem/Agente de turismo/Operador de turismo"},
                {"code": "AGRONOMO", "name": "Agronomo"}, {"code": "AJUDANTE_GERAL", "name": "Ajudante Geral"},
                {"code": "AJUSTADOR_RETIFICADOR", "name": "Ajustador/Retificador"}, {"code": "ALFAIATE", "name": "Alfaiate"},
                {"code": "AMBULANTES", "name": "Ambulantes(Camelo,Pipoqueiro,etc)"},
                {"code": "ANALISTA_RECURSOS_HUMANOS", "name": "Analista de Cargos/Recursos Humanos etc"},
                {"code": "ANALISTA_CREDITO_E_COBRANCA", "name": "Analista de Cred/Cad/Cobr/Garant/Inf etc"},
                {"code": "ANALISTA_CUSTOS_PROJ_SERV_ECONOMIA", "name": "Analista de Custos/Proj/Serv/Economia etc"},
                {"code": "ANALISTA_PRODUCAO_CRONOALISTA", "name": "Analista de Producao/Cronoalista"},
                {"code": "ANALISTA_SISTEMAS", "name": "Analista de Sistemas"},
                {"code": "APOSENTADO", "name": "Aposentado(exceto funcionario publico)"},
                {"code": "ARBITRO_DE_ESPORTES", "name": "Arbitro de Esportes"},
                {"code": "ARMADOR_DE_FERRAGENS", "name": "Armador de Ferragens"}, {"code": "ARMEIRO", "name": "Armeiro"},
                {"code": "ARQUEOLOGO", "name": "Arqueologo"}, {"code": "ARQUITETO", "name": "Arquiteto"},
                {"code": "ARQUIVISTA", "name": "Arquivista"}, {"code": "ARTESAO", "name": "Artesao"},
                {"code": "ARTISTA_PLASTICO", "name": "Artista Plastico"}, {"code": "ASCENSORISTA", "name": "Ascensorista"},
                {"code": "ASSISTENTE_SOCIAL", "name": "Assistente Social"}, {"code": "ASTRONOMO", "name": "Astronomo"},
                {"code": "ATLETA", "name": "Atleta Profissional"}, {"code": "ATOR", "name": "Ator"},
                {"code": "ATUARIO", "name": "Atuario"}, {"code": "AUDITOR_PUBLICO", "name": "Auditor Publico"},
                {"code": "AUXILIAR_COZINHA_LIMPEZA_COSTURA_COPA", "name": "Auxiliar Cozinha/Limpeza/Costura/Copa etc"},
                {"code": "AUXILIAR_DE_ENFERMAGEM_TECNICO", "name": "Auxiliar de Enfermagem/Tecnico de Enfermagem"},
                {"code": "AUXILIAR_DE_ESCRITORIO", "name": "Auxiliar de Escritorio e Ass."},
                {"code": "AUXILIAR_DE_LABORATORIO", "name": "Auxiliar de Laboratorio"},
                {"code": "AUXILIAR_DE_SERVICOS_GERAIS", "name": "Auxiliar de Serviços Gerais"},
                {"code": "AVALIADOR", "name": "Avaliador"}, {"code": "CUIDADOR", "name": "Cuidador"},
                {"code": "DANCARINO", "name": "Dançarino"}, {"code": "BANCARIO", "name": "Bancario"},
                {"code": "BARBEIRO", "name": "Barbeiro"}, {"code": "BARISTA", "name": "Barista/Barman/Barwoman"},
                {"code": "BIBLIOTECARIO", "name": "Bibliotecario"},
                {"code": "BILHETEIRO_COBRADOR", "name": "Bilheteiro(Transp/Diversao)/Trocador/Cobrador Transp Passageiro/Caixa"},
                {"code": "BIOLOGO", "name": "Biologo"}, {"code": "BIOMEDICO", "name": "Biomedico"},
                {"code": "BOLSISTA", "name": "Bolsista"}, {"code": "BOMBEIRO_ENCANADOR", "name": "Bombeiro/Encanador"},
                {"code": "BORRACHEIRO", "name": "Borracheiro"}, {"code": "CABELEIREIRO", "name": "Cabeleireiro"},
                {"code": "CAIXEIRO_VIAJANTE", "name": "Caixeiro-Viajante"},
                {"code": "CAMAREIRA_ARRUMADEIRA", "name": "Camareira/Arrumadeira"}, {"code": "CANTOR", "name": "Cantor"},
                {"code": "CARGOS_DE_CONFIANCA_COMISSOES", "name": "Cargos de Confiança/Comissoes"},
                {"code": "CARREGADOR", "name": "Carregador"}, {"code": "CARTEIRO", "name": "Carteiro"},
                {"code": "CARTORARIO", "name": "Cartorario"}, {"code": "CASEIRO", "name": "Caseiro"},
                {"code": "CAVALARICO", "name": "Cavalarico/Ferrador/Tratador de Animais"},
                {"code": "CENOGRAFO", "name": "Cenografo"}, {"code": "CHAVEIRO", "name": "Chaveiro"},
                {"code": "CHEFE_DA_PRODUCAO", "name": "Chefe da Producao"},
                {"code": "CHEFE_INTERMEDIARIO", "name": "Chefe Intermediario"},
                {"code": "COBRADOR_EM_GERAL", "name": "Cobrador em Geral"},
                {"code": "COMANDANTE_DE_EMBARCACOES", "name": "Comandante de Embarcacoes"},
                {"code": "COMENTARISTA", "name": "Comentarista"}, {"code": "COMISSARIO_DE_BORDO", "name": "Comissario de Bordo"},
                {"code": "COMPOSITOR", "name": "Compositor"}, {"code": "COMUNICOLOGO", "name": "Comunicologo"},
                {"code": "CONSELHEIRO_TUTELAR", "name": "Conselheiro Tutelar"},
                {"code": "CONSULTOR_DE_EMPRESAS", "name": "Consultor de Empresas"}, {"code": "CONTADOR", "name": "Contador"},
                {"code": "CONTRAMESTRE", "name": "Contramestre"}, {"code": "CONTROLADOR_DE_VOO", "name": "Controlador de Voo"},
                {"code": "COREOGRAFO", "name": "Coreografo"}, {"code": "CORRETOR_EM_GERAL", "name": "Corretor em Geral"},
                {"code": "CORTADOR", "name": "Cortador"},
                {"code": "COSTUREIRA", "name": "Costureira/Bordadeira/Cerzideira"},
                {"code": "COZINHEIRO_CONFEITEIRO_PADEIRO", "name": "Cozinheiro/Confeiteiro/Padeiro"},
                {"code": "DECORADOR", "name": "Decorador"}, {"code": "DEGUSTADOR_VINHO_CAFE", "name": "Degustador(Vinho/Café etc)"},
                {"code": "DELEGADO_DE_POLICIA", "name": "Delegado de Policia"}, {"code": "DEMONSTRADOR", "name": "Demonstrador"},
                {"code": "DENTISTA_ODONTOLOGO", "name": "Dentista/Odontologo"}, {"code": "DEPILADOR", "name": "Depilador"},
                {"code": "DEPUTADO_ESTADUAL_FEDERAL", "name": "Deputado Estadual/Federal"},
                {"code": "DESEMBARGADOR", "name": "Desembargador"}, {"code": "DESENHISTA", "name": "Desenhista"},
                {"code": "DESPACHANTE_INCLUSIVE_ADUANEIRO", "name": "Despachante (inclusive aduaneiro)"},
                {"code": "DETETIVE_INVESTIGADOR", "name": "Detetive/Investigador"},
                {"code": "DETETIZADOR", "name": "Detetizador"}, {"code": "DIGITADOR", "name": "Digitador"},
                {"code": "DIPLOMATA", "name": "Diplomata"}, {"code": "DIRETOR_DE_EMPRESA", "name": "Diretor de Empresa"},
                {"code": "DIRETOR_DE_ESPETACULOS", "name": "Diretor de Espetaculos"},
                {"code": "DIRETOR_DE_ESTABELECIMENTO_DE_ENSINO", "name": "Diretor de Estabelecimento de Ensino"},
                {"code": "ECONOMISTA", "name": "Economista"}, {"code": "ELETRICISTA", "name": "Eletricista"},
                {"code": "EMBALADOR", "name": "Embalador"}, {"code": "EMBALSAMADOR", "name": "Embalsamador"},
                {"code": "EMPREGADA_DOMESTICA", "name": "Empregada domestica"},
                {"code": "EMPRESARIO_DE_ATLETA", "name": "Empresario de Atleta"}, {"code": "ENFERMEIRO", "name": "Enfermeiro"},
                {"code": "ENGENHEIRO", "name": "Engenheiro"},
                {"code": "ENTREVISTADOR_CENSO_PESQUISA_PRECOS", "name": "Entrevistador(Censo/Pesquisa/Preços)"},
                {"code": "ESCRITOR", "name": "Escritor"}, {"code": "ESCULTOR", "name": "Escultor"},
                {"code": "ESOTERICOS_ASTROLOGOS_TAROLOGO_NUMEROLOGO", "name": "Esotericos(Astrologos/Tarologo/Numerologo etc)"},
                {"code": "ESTATISTICO", "name": "Estatistico"}, {"code": "ESTETICISTA", "name": "Esteticista"},
                {"code": "ESTILISTA_MODELISTA", "name": "Estilista/Modelista"}, {"code": "ESTIVADOR", "name": "Estivador"},
                {"code": "FARMACEUTICO", "name": "Farmaceutico"}, {"code": "FAXINEIRO_DIARISTA", "name": "Faxineiro/Diarista"},
                {"code": "FEIRANTE", "name": "Feirante"}, {"code": "FERRAMENTEIRO", "name": "Ferramenteiro"},
                {"code": "FISCAL", "name": "Fiscal"}, {"code": "FISCAL_DE_PRODUCAO", "name": "Fiscal de Producao"},
                {"code": "FISCAL_SERVICOS_DE_TRANSPORTE", "name": "Fiscal Serviços de Transporte"},
                {"code": "FISICO", "name": "Fisico"}, {"code": "FISIOTERAPEUTA", "name": "Fisioterapeuta"},
                {"code": "FOGUISTA_DE_EMBARCACOES_OU_LOCOMOTIVAS", "name": "Foguista de Embarcacoes ou Locomotivas"},
                {"code": "FONOAUDIOLOGO", "name": "Fonoaudiologo"},
                {"code": "FORCAS_ARMADAS_SOLDADO_MARINHEIRO", "name": "Forças Armadas (Soldado,Marinheiro,etc)"},
                {"code": "FOTOGRAFO", "name": "Fotografo"},
                {"code": "FRENTISTA_TRABALHADOR_DE_POSTO_DE_GASOLINA", "name": "Frentista/Trabalhador de posto de gasolina"},
                {"code": "FUNCIONARIO_PUBLICO_CIVIL_APOSENTADO", "name": "Funcionario Publico Civil Aposentado"},
                {"code": "FUNDIDOR", "name": "Fundidor"}, {"code": "GARAGISTA", "name": "Garagista"},
                {"code": "GARCOM_MAITRE", "name": "Garçom/Maitre"}, {"code": "GARIMPEIRO", "name": "Garimpeiro"},
                {"code": "GEOGRAFO", "name": "Geografo"}, {"code": "GEOLOGO", "name": "Geologo"},
                {"code": "GERENTE", "name": "Gerente"}, {"code": "GESSISTA", "name": "Gessista"},
                {"code": "GOVERNADOR_DE_ESTADO", "name": "Governador de Estado"}, {"code": "GOVERNANTA", "name": "Governanta"},
                {"code": "GUIA_TURISTICO", "name": "Guia Turistico"},
                {"code": "HOSPITAL_TRABALHADORES_EM_GERAL", "name": "Hospital - Trabalhadores em Geral"},
                {"code": "IMPERMEABILIZADOR", "name": "Impermeabilizador"}, {"code": "INSPETOR", "name": "Inspetor"},
                {"code": "INSPETOR_DE_CONTROLE_DE_QUALIDADE", "name": "Inspetor de Controle de Qualidade"},
                {"code": "INSTALADOR_DE_GAS_AGUA_ESGOTO", "name": "Instalador de Gas,Agua e Esgoto"},
                {"code": "INSTRUMENTADOR_CIRURGICO", "name": "Instrumentador Cirurgico"},
                {"code": "INSTRUMENTISTA", "name": "Instrumentista"},
                {"code": "INSTRUTOR_DE_AUTOESCOLA", "name": "Instrutor de Autoescola"},
                {"code": "INSTRUTOR_PROFESSOR_CURSOS_LIVRES", "name": "Instrutor/Professor de Cursos Livres(Ginastica,Ingles,Informatica)"},
                {"code": "INTERPRETE_TRADUTOR", "name": "Interprete/Tradutor"}, {"code": "JARDINEIRO", "name": "Jardineiro"},
                {"code": "JOALHEIRO", "name": "Joalheiro"}, {"code": "JORNALEIRO", "name": "Jornaleiro"},
                {"code": "JORNALISTA_REPORTER", "name": "Jornalista/Reporter"}, {"code": "JUIZ_DE_DIREITO", "name": "Juiz de Direito"},
                {"code": "LANTERNEIRO", "name": "Lanterneiro"},
                {"code": "LAVADOR_DE_CARROS_ROUPAS", "name": "Lavador de Carros/Roupas"},
                {"code": "LEILOEIRO", "name": "Leiloeiro"}, {"code": "LEITURISTA", "name": "Leiturista"},
                {"code": "GARI", "name": "Lixeiro/Gari/Varredor/Coletor de Lixo"}, {"code": "LOCUTOR", "name": "Locutor"},
                {"code": "MANICURE_PEDICURE_PODOLOGO", "name": "Manicure/Pedicure/Podologo"},
                {"code": "MANOBRISTA_NAO_EMPREGADO_GUARDADOR_DE_CARRO", "name": "Manobrista (não empregado)/Guardador de Carro"},
                {"code": "MAQUILADOR", "name": "Maquilador"},
                {"code": "MAQUINISTA_DE_EMBARCACOES_OU_LOCOMOTIVAS", "name": "Maquinista de Embarcacoes ou Locomotivas"},
                {"code": "MARCENEIRO_CARPINTEIRO", "name": "Marceneiro/Carpinteiro"},
                {"code": "MARINHEIRO_ASS", "name": "Marinheiro e Ass."}, {"code": "MASSAGISTA", "name": "Massagista"},
                {"code": "MATEMATICO", "name": "Matematico"}, {"code": "MECANICO", "name": "Mecanico"},
                {"code": "MEDICO", "name": "Medico"}, {"code": "MEMBRO_DA_DEFENSORIA_PUBLICA", "name": "Membro da Defensoria Publica"},
                {"code": "MEMBRO_DE_EQUIPE_TECNICA_DE_ESPORTES", "name": "Membro de Equipe tecnica de esportes"},
                {"code": "MEMBRO_DO_MINISTERIO_PUBLICO", "name": "Membro do Ministerio Publico"},
                {"code": "MEMBRO_EQUIPE_TECNICA_ESPORTES", "name": "Membro Equipe Técnica Esportes"},
                {"code": "MESTRE_DE_PRODUCAO", "name": "Mestre de Producao"}, {"code": "METEOROLOGISTA", "name": "Meteorologista"},
                {"code": "MILITAR_EM_GERAL", "name": "Militar em Geral"}, {"code": "MILITAR_REFORMADO", "name": "Militar reformado"},
                {"code": "MINISTRO_DE_ESTADO", "name": "Ministro de Estado"},
                {"code": "MINISTRO_DE_TRIBUNAL_SUPERIOR", "name": "Ministro de Tribunal Superior"},
                {"code": "MODELO_DE_MODAS", "name": "Modelo de Modas"}, {"code": "MONTADOR", "name": "Montador"},
                {"code": "MOTORISTA_TRANSPORTE_CARGAS", "name": "Motorista (veiculo transporte cargas)"},
                {"code": "MOTORISTA_TRANSPORTE_DE_PASSAGEIROS", "name": "Motorista (veiculo transporte de passageiros)"},
                {"code": "MOTORISTA_AUTONOMO_TAXISTA_PRINCIPAL", "name": "Motorista autonomo (taxista principal)"},
                {"code": "MUSEOLOGO", "name": "Museologo"}, {"code": "MUSICO", "name": "Musico"},
                {"code": "NUTRICIONISTA", "name": "Nutricionista"},
                {"code": "OFFICE_BOY_CONTINUO_ENTREGADOR_MOTOBOY", "name": "Office boy/Continuo/Entregador/Motoboy"},
                {"code": "OFICIAL_DE_FORCAS_AUX_FORCAS_ARMADAS", "name": "Oficial de Forças Aux e Forças Armadas"},
                {"code": "OFICIAL_DE_JUSTICA", "name": "Oficial de Justiça"},
                {"code": "OPERADOR_DE_CALDEIRA", "name": "Operador de Caldeira"},
                {"code": "OPERADOR_DE_CAMERAS_DE_CINEMA_TV", "name": "Operador de Cameras de Cinema e TV"},
                {"code": "OPERADOR_DE_COMPUTADOR", "name": "Operador de Computador"},
                {"code": "OPERADOR_DE_GUINDASTE", "name": "Operador de Guindaste"},
                {"code": "OPERADOR_DE_ILUMINACAO", "name": "Operador de Iluminacao"},
                {"code": "OPERADOR_DE_MAQUINAS_APARELHOS", "name": "Operador de Maquinas e Aparelhos"},
                {"code": "OPERADOR_DE_TELEMARKETING", "name": "Operador de Telemarketing"},
                {"code": "OPERARIO_SEMI_ESPECIALIZADO_PRODUCAO", "name": "Operario Semi-especializado Producao"},
                {"code": "ORIENTADOR_PEDAGOGICO", "name": "Orientador Pedagogico"}, {"code": "OURIVES", "name": "Ourives"},
                {"code": "PAISAGISTA", "name": "Paisagista"}, {"code": "PEDREIRO", "name": "Pedreiro"},
                {"code": "PENSAO_ALIMENTICIA_PARA_FILHOS", "name": "Pensao alimenticia para filhos"},
                {"code": "PENSIONISTA", "name": "Pensionista"}, {"code": "PERSONAL_TRAINER", "name": "Personal Trainer"},
                {"code": "PESCADOR", "name": "Pescador"}, {"code": "PESQUISADOR_CIENTIFICO", "name": "Pesquisador Cientifico"},
                {"code": "PILOTO_DE_AERONAVES", "name": "Piloto de Aeronaves"}, {"code": "PINTOR", "name": "Pintor"},
                {"code": "PISCICULTOR", "name": "Piscicultor"}, {"code": "PORTEIRO_ZELADOR", "name": "Porteiro/Zelador"},
                {"code": "PORTUARIO", "name": "Portuario"}, {"code": "PREFEITO", "name": "Prefeito"},
                {"code": "PRENSISTA_ESTAMPADOR", "name": "Prensista/Estampador"},
                {"code": "PROCURADOR_MEMBROS_DA_PROCURADORIA", "name": "Procurador/Membros da Procuradoria"},
                {"code": "PRODUTOR_DE_EVENTOS", "name": "Produtor de Eventos(Promoter)/Produtor de Artes em geral"},
                {"code": "PROFESSOR_AUTONOMO_PARTICULAR", "name": "Professor Autonomo/Particular"},
                {"code": "PROFESSOR_ENSINO_FUNDAMENTAL_E_MEDIO", "name": "Professor de Ensino Fundamental e Medio"},
                {"code": "PROFESSOR_ENSINO_SUPERIOR", "name": "Professor de Ensino Superior"},
                {"code": "PROFESSOR_IDIOMAS", "name": "Professor de Idiomas"},
                {"code": "PROFISSIONAL_CIRCO_ACROBATA", "name": "Profissional de Circo/Acrobata"},
                {"code": "PROFISSIONAL_LETRAS_ARTES", "name": "Profissional de Letras e Artes"},
                {"code": "PROGRAMADOR", "name": "Programador"}, {"code": "PROMOTOR_DE_VENDAS", "name": "Promotor de Vendas"},
                {"code": "PROMOTOR_PUBLICO", "name": "Promotor Publico"},
                {"code": "PROPRIETARIO_COMERCIAL", "name": "Proprietario de Estabel. Comercial"},
                {"code": "PROPRIETARIO_INDUSTRIAL", "name": "Proprietario de Estabel. Industrial"},
                {"code": "PROPRIETARIO_MICROEMPRESA", "name": "Proprietario de Microempresa"},
                {"code": "PROPRIETARIO_PRESTACAO_SERVICOS", "name": "Proprietario de Estabel. de Prestaçao Serviços"},
                {"code": "PROPRIETARIO_RURAL_AGRICOLA_FLORESTAL_PECUARI", "name": "Proprietario de Estabel. Rural,Agricola,Florestal,Pecuario"},
                {"code": "PROTETICO", "name": "Protetico"},
                {"code": "PSICANALISTA", "name": "Psicologo/Terapeuta/Psicanalista"},
                {"code": "PSICOTERAPEUTA", "name": "Psicologo/Terapeuta/Psicoterapeuta"},
                {"code": "PUBLICITARIO", "name": "Publicitario"}, {"code": "QUIMICO", "name": "Quimico"},
                {"code": "RADIALISTA", "name": "Radialista"}, {"code": "RECEPCIONISTA", "name": "Recepcionista"},
                {"code": "RECICLAGEM", "name": "Reciclagem - Trabalhadores em geral"},
                {"code": "RECREADOR", "name": "Recreador"}, {"code": "RELACOES_PUBLICAS", "name": "Relacoes Publicas"},
                {"code": "RELOJOEIRO", "name": "Relojoeiro"},
                {"code": "REPRESENTANTE_COMERCIAL", "name": "Representante Comercial"}, {"code": "SAPATEIRO", "name": "Sapateiro"},
                {"code": "SECRETARIA", "name": "Secretaria"}, {"code": "SECRETARIO_DE_ESTADO", "name": "Secretario de Estado"},
                {"code": "SECRETARIO_MUNICIPAL", "name": "Secretario Municipal"}, {"code": "SECURITARIO", "name": "Securitario"},
                {"code": "SEGURANCA_PATRIMONIAL", "name": "Segurança Patrimonial - trabalhadores em geral"},
                {"code": "SENADOR", "name": "Senador"}, {"code": "SERRALHEIRO", "name": "Serralheiro"},
                {"code": "SERVENTUARIO_DA_JUSTICA", "name": "Serventuario da Justiça"},
                {"code": "SERVICOS_DE_MANUTENCAO", "name": "Serviços de Manutencao"}, {"code": "SOCIOLOGO", "name": "Sociologo"},
                {"code": "SOLDADO_CORPO_DE_BOMBEIROS", "name": "Soldado Corpo de Bombeiros"},
                {"code": "SUPERINTENDENTE", "name": "Superintendente"}, {"code": "SUPERVISOR", "name": "Supervisor"},
                {"code": "SUPERVISOR_TECNICO_OPERACIONAL", "name": "Supervisor/Tecnico Operacional"},
                {"code": "TABELIAO", "name": "Tabeliao"}, {"code": "TAPECEIRO", "name": "Tapeceiro"},
                {"code": "TECNICO_DA_RECEITA_FEDERAL", "name": "Tecnico da Receita Federal"},
                {"code": "TECNICO_DE_BIOLOGIA", "name": "Tecnico de Biologia"},
                {"code": "TECNICO_DE_CONTABILIDADE", "name": "Tecnico de Contabilidade"},
                {"code": "TECNICO_DE_ELETRICIDADE", "name": "Tecnico de Eletricidade"},
                {"code": "TECNICO_DE_ELETRONICA", "name": "Tecnico de Eletronica"},
                {"code": "TECNICO_DE_ESTATISTICA", "name": "Tecnico de Estatistica"},
                {"code": "TECNICO_DE_LABORATORIO", "name": "Tecnico de Laboratorio"},
                {"code": "TECNICO_DE_MECANICA", "name": "Tecnico de Mecanica"},
                {"code": "TECNICO_DE_QUIMICA", "name": "Tecnico de Quimica"},
                {"code": "TECNICO_DE_RADIOLOGIA", "name": "Tecnico de Radiologia"},
                {"code": "TECNICO_DE_TELECOMUNICACOES", "name": "Tecnico de Telecomunicacoes"},
                {"code": "TECNICO_EM_AGRONOMIA", "name": "Tecnico em Agronomia"},
                {"code": "TECNICO_EM_DESPORTOS", "name": "Tecnico em Desportos"},
                {"code": "TECNICO_EM_EDIFICACOES", "name": "Tecnico em Edificacoes"},
                {"code": "TECNICO_EM_ELETRONICA", "name": "Tecnico em Eletronica"},
                {"code": "TECNICO_EM_ESTATISTICA", "name": "Tecnico em Estatistica"},
                {"code": "TECNICO_EM_FARMACIA", "name": "Tecnico em Farmacia"},
                {"code": "TECNICO_EM_FINANCAS", "name": "Tecnico em Finanças"},
                {"code": "TECNICO_EM_INFORMATICA", "name": "Tecnico em Informatica"},
                {"code": "TECNICO_EM_INSEMINACAO", "name": "Tecnico em Inseminacao"},
                {"code": "TECNICO_EM_MECANICA", "name": "Tecnico em Mecanica"},
                {"code": "TECNICO_EM_QUIMICA", "name": "Tecnico em Quimica"},
                {"code": "TECNICO_EM_RADIOLOGIA", "name": "Tecnico em Radiologia"},
                {"code": "TECNICO_EM_REFRIGERACAO", "name": "Tecnico em Refrigeracao"},
                {"code": "TECNICO_EM_TELECOMUNICACOES", "name": "Tecnico em Telecomunicacoes"},
                {"code": "TECNICO_PROJETISTA", "name": "Tecnico Projetista"}, {"code": "TELEFONISTA", "name": "Telefonista"},
                {"code": "TERAPEUTA_OCUPACIONAL", "name": "Terapeuta Ocupacional"}, {"code": "TORNEIRO", "name": "Torneiro"},
                {"code": "TRABALHADOR_DA_ADMINISTRACAO", "name": "Trabalhador da Administracao"},
                {"code": "TRABALHADOR_DA_PESCA", "name": "Trabalhador da Pesca"},
                {"code": "TRABALHADOR_DE_ARTES_GRAFICAS", "name": "Trabalhador de Artes Graficas"},
                {"code": "TRABALHADOR_DE_CONSTRUCAO_CIVIL", "name": "Trabalhador de Construcao Civil"},
                {"code": "TRABALHADOR_FABRICACAO_FUMO_CIGARRO_CHARUTOS", "name": "Trabalhador Fabricacao fumo/cigarro/charutos"},
                {"code": "TRABALHADOR_FABRICACAO_FUMO_CIGARROS_CHARUTOS", "name": "Trabalhador Fabricacao fumo/cigarros/charutos"},
                {"code": "TRABALHADOR_INDUSTRIAL", "name": "Trabalhador Industrial"},
                {"code": "TRABALHADOR_RURAL", "name": "Trabalhador Rural"},
                {"code": "TRABALHADOR_SERV_CONTABCAIXA_ASS", "name": "Trabalhador serv. contab.caixa e ass."},
                {"code": "TRAINEES", "name": "Trainees"}, {"code": "VENDEDOR", "name": "Vendedor"},
                {"code": "VENDEDOR_PRACISTA", "name": "Vendedor Pracista"}, {"code": "VEREADOR", "name": "Vereador"},
                {"code": "VETERINARIO", "name": "Veterinario"}, {"code": "VIDRACEIRO", "name": "Vidraceiro"},
                {"code": "WEBDESIGNER", "name": "Webdesigner"}, {"code": "ZOOTECNISTA", "name": "Zootecnista"}
                // Add more professions here if needed, this is a substantial list from FitBank
            ];

            const professionsList = professionsRawData
                .map(p => p.name)
                .filter(name => name) // Ensure no null/empty names
                .sort((a, b) => a.localeCompare(b));

            function initOccupationAutocomplete(inputId, sourceList) {
                const inputEl = document.getElementById(inputId);
                if (!inputEl) {
                    console.warn(`[Occupation Autocomplete] Input ${inputId} not found.`);
                    return;
                }

                let suggestionsContainer = inputEl.parentNode.querySelector(`.autocomplete-suggestions[data-for="${inputId}"]`);
                if (!suggestionsContainer) {
                    suggestionsContainer = document.createElement('div');
                    suggestionsContainer.className = 'autocomplete-suggestions';
                    suggestionsContainer.setAttribute('data-for', inputId);
                    // Ensure parent is suitable for absolute positioning
                    if (getComputedStyle(inputEl.parentNode).position === 'static') {
                        inputEl.parentNode.style.position = 'relative';
                    }
                    inputEl.parentNode.appendChild(suggestionsContainer);
                }
                
                let activeSuggestionIndex = -1;

                function showSuggestions(filteredList) {
                    suggestionsContainer.innerHTML = '';
                    activeSuggestionIndex = -1;
                    if (filteredList.length === 0) {
                        suggestionsContainer.style.display = 'none';
                        return;
                    }

                    filteredList.slice(0, 10).forEach((itemText, index) => { // Limit to 10 suggestions
                        const div = document.createElement('div');
                        div.textContent = itemText;
                        div.addEventListener('mousedown', function(e) { // Use mousedown to fire before blur
                            inputEl.value = this.textContent;
                            suggestionsContainer.style.display = 'none';
                            // Trigger change event for any other listeners
                            inputEl.dispatchEvent(new Event('change', { bubbles: true }));
                        });
                        suggestionsContainer.appendChild(div);
                    });
                    suggestionsContainer.style.display = 'block';
                }
                
                function updateActiveSuggestion(newIndex) {
                    const items = suggestionsContainer.querySelectorAll('div');
                    if (items.length === 0) return;

                    if (activeSuggestionIndex >= 0 && items[activeSuggestionIndex]) {
                        items[activeSuggestionIndex].classList.remove('active');
                    }
                    activeSuggestionIndex = newIndex;
                    if (activeSuggestionIndex >= 0 && items[activeSuggestionIndex]) {
                        items[activeSuggestionIndex].classList.add('active');
                        items[activeSuggestionIndex].scrollIntoView({ block: 'nearest' });
                    }
                }

                inputEl.addEventListener('input', function() {
                    const value = this.value.trim().toLowerCase();
                    if (value.length < 2) { // Min 2 chars to search
                        suggestionsContainer.style.display = 'none';
                        activeSuggestionIndex = -1;
                        return;
                    }
                    const filtered = sourceList.filter(item => item.toLowerCase().includes(value));
                    showSuggestions(filtered);
                });
                
                inputEl.addEventListener('keydown', function(e) {
                    const items = suggestionsContainer.querySelectorAll('div');
                    if (suggestionsContainer.style.display === 'none' || items.length === 0) return;

                    if (e.key === 'ArrowDown') {
                        e.preventDefault();
                        updateActiveSuggestion((activeSuggestionIndex + 1) % items.length);
                    } else if (e.key === 'ArrowUp') {
                        e.preventDefault();
                        updateActiveSuggestion((activeSuggestionIndex - 1 + items.length) % items.length);
                    } else if (e.key === 'Enter') {
                        e.preventDefault();
                        if (activeSuggestionIndex >= 0 && items[activeSuggestionIndex]) {
                            inputEl.value = items[activeSuggestionIndex].textContent;
                            suggestionsContainer.style.display = 'none';
                            activeSuggestionIndex = -1;
                             // Trigger change event for any other listeners
                            inputEl.dispatchEvent(new Event('change', { bubbles: true }));
                        }
                    } else if (e.key === 'Escape') {
                        suggestionsContainer.style.display = 'none';
                        activeSuggestionIndex = -1;
                    }
                });

                inputEl.addEventListener('blur', function() {
                    // Delay hiding to allow click/mousedown on suggestion
                    setTimeout(() => {
                        if (!suggestionsContainer.matches(':hover')) { // Don't hide if mouse is over suggestions
                           suggestionsContainer.style.display = 'none';
                           activeSuggestionIndex = -1;
                        }
                    }, 200);
                });
                
                // Hide suggestions if clicked outside
                document.addEventListener('click', function(event) {
                    if (!inputEl.contains(event.target) && !suggestionsContainer.contains(event.target)) {
                        suggestionsContainer.style.display = 'none';
                        activeSuggestionIndex = -1;
                    }
                });
            }

            initOccupationAutocomplete('input_238', professionsList); // Ocupação Profissional
            
            // For the spouse occupation, we need to ensure it's initialized if/when the field becomes visible
            // The existing `atualizarCamposConjuge` function can be a good place to call this,
            // or we can try to initialize it here and it will work if the field exists.
            // Let's try to initialize it directly. If input_239 is not yet in DOM, it will gracefully fail.
            // If it's added later, this particular init won't attach.
            // A better approach might be to call initOccupationAutocomplete from within atualizarCamposConjuge
            // when the spouse section is made visible.

            // However, for simplicity now, let's call it. If it's not present, it won't break.
            initOccupationAutocomplete('input_239', professionsList); // Ocupação Profissional Cônjuge
            
            // Modify 'atualizarCamposConjuge' to initialize autocomplete for spouse when shown
            const originalAtualizarCamposConjuge = typeof atualizarCamposConjuge === 'function' ? atualizarCamposConjuge : null;
            if (originalAtualizarCamposConjuge) {
                window.atualizarCamposConjuge = function() {
                    originalAtualizarCamposConjuge.apply(this, arguments); // Call original function
                    const estadoCivilSelect = document.getElementById('input_103');
                    if (estadoCivilSelect) {
                        const estadoCivil = estadoCivilSelect.value;
                        const mostrarCamposConjuge = (estadoCivil === 'Casado(a)' || estadoCivil === 'União Estável');
                        if (mostrarCamposConjuge) {
                            // Ensure it's only initialized once or can handle re-initialization safely
                            const spouseOccupationInput = document.getElementById('input_239');
                            if (spouseOccupationInput && !spouseOccupationInput.hasAttribute('data-autocomplete-initialized')) {
                                initOccupationAutocomplete('input_239', professionsList);
                                spouseOccupationInput.setAttribute('data-autocomplete-initialized', 'true');
                                console.log('[Occupation Autocomplete] Initialized for spouse.');
                            }
                        }
                    }
                };
                // If atualizarCamposConjuge is called immediately on load, this override will catch it.
            }


            // --- END: Autocomplete for Occupation Fields ---

            console.log('[INIT] Inicialização completa do formulário');
        });

        // Adicionar no final da função principal, após eventListeners de prevButtons, uma validação de envio para o botão final
        // Botão de Enviar (validação final)
        const submitButton = document.getElementById('submit-button');

        // --- START: State for CEP Search ---
        let cepSearchState = {};
        // --- END: State for CEP Search ---

        if (submitButton) {
            submitButton.addEventListener('click', function() {
                console.log('Botão de envio clicado');
                const currentTabId = document.querySelector('.tab-content.active').id;
                console.log('Aba atual:', currentTabId);
                console.log('Validando campos...');
                if (validateTabFields(currentTabId)) {
                    console.log('Campos validados com sucesso, disparando evento submit');
                    // Dispara o evento submit em vez de chamar diretamente o método submit()
                    // Isso garantirá que os manipuladores de eventos de submit sejam executados
                    const formEl = document.getElementById('cadastro-form');
                    console.log('Formulário encontrado:', formEl ? 'Sim' : 'Não');
                    
                    try {
                        const submitEvent = new Event('submit', {
                            'bubbles': true,
                            'cancelable': true
                        });
                        console.log('Evento submit criado, disparando...');
                        formEl.dispatchEvent(submitEvent);
                        console.log('Evento submit disparado com sucesso');
                        
                        // Como backup, tentar submeter diretamente após um pequeno atraso
                        setTimeout(() => {
                            console.log('Tentativa de backup: enviando formulário diretamente');
                            formEl.submit();
                        }, 300);
                    } catch (error) {
                        console.error('Erro ao disparar evento submit:', error);
                        
                        // Se ocorrer um erro, tentar submeter diretamente
                        console.log('Tentando submeter diretamente após erro');
                        formEl.submit();
                    }
                } else {
                    console.log('Validação falhou, formulário não será enviado');
                }
            });
        }

        // Atualização inicial das abas disponíveis
        const tabElements = document.querySelectorAll('.form-tab');
        // Gerenciamento de abas disponíveis
        function updateAvailableTabs() {
            console.log('[TABS] Atualizando estado das abas disponíveis');
            // Encontrar o índice da aba atual
            const currentTabId = document.querySelector('.tab-content.active').id;
            const currentTabIndex = Array.from(tabElements).findIndex(tab => tab.getAttribute('data-tab') === currentTabId);
            console.log('[TABS] Aba atual:', currentTabId, 'Índice:', currentTabIndex);
            
            // Habilitar todas as abas até a atual
            tabElements.forEach((tab, index) => {
                const tabId = tab.getAttribute('data-tab');
                if (index <= currentTabIndex) {
                    tab.classList.remove('disabled');
                    console.log('[TABS] Habilitando aba:', tabId);
                } else if (index === currentTabIndex + 1) {
                    // A próxima aba também está disponível, mas só clicável se a atual for válida
                    tab.classList.remove('disabled');
                    console.log('[TABS] Próxima aba disponível:', tabId);
                } else {
                    // Abas posteriores ficam desabilitadas
                    tab.classList.add('disabled');
                    console.log('[TABS] Desabilitando aba:', tabId);
                }
            });
        }
        updateAvailableTabs();
        console.log('[INIT] Inicialização completa do formulário');
    </script>
</body>
</html>