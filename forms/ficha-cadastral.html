<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ficha Cadastral - Persevera</title>
    
    <!-- Adobe Fonts (Typekit) para Avenir - Apenas como exemplo, precisa ser substituído por um kit real -->
    <link rel="stylesheet" href="https://use.typekit.net/abc1234.css">
    
    <!-- Google Fonts alternativa - Fontes similares à Avenir -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Email Validator via CDN -->
    <script src="https://cdn.jsdelivr.net/npm/email-validator@2.0.4/index.min.js"></script>
    
    <!-- Verificação do carregamento do Email Validator -->
    <script>
        // Verificar se a biblioteca foi carregada corretamente e definir um fallback se necessário
        window.addEventListener('DOMContentLoaded', function() {
            if (typeof EmailValidator === 'undefined' || typeof EmailValidator.validate !== 'function') {
                console.warn('Email Validator não carregado corretamente. Usando implementação local.');
                window.EmailValidator = {
                    validate: function(email) {
                        // Implementação de fallback usando regex para validação de email
                        const emailRegex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
                        return emailRegex.test(email);
                    }
                };
            } else {
                console.log('Email Validator carregado com sucesso.');
            }
            
            // Teste da biblioteca para confirmar funcionamento
            console.log('TESTE VALIDADOR DE EMAIL:');
            const testEmails = [
                'usuario@exemplo.com',      // Válido
                'usuario@exemplo.com.br',   // Válido
                'usuario.nome@exemplo.co',  // Válido
                'usuario',                  // Inválido
                'usuario@',                 // Inválido
                'usuario@exemplo',          // Inválido
                '@exemplo.com',             // Inválido
                'usuario@.com'              // Inválido
            ];
            
            testEmails.forEach(email => {
                console.log(`${email}: ${EmailValidator.validate(email) ? 'VÁLIDO' : 'INVÁLIDO'}`);
            });
        });
    </script>
    
    <!-- Carregando fontes Avenir via @font-face -->
    <style>
        @font-face {
            font-family: 'Avenir';
            src: url('https://assets.persevera.com.br/fonts/Avenir-Medium.woff2') format('woff2'),
                 url('https://assets.persevera.com.br/fonts/Avenir-Medium.woff') format('woff');
            font-weight: 500;
            font-style: normal;
            font-display: swap;
        }
        
        @font-face {
            font-family: 'Avenir Light';
            src: url('https://assets.persevera.com.br/fonts/Avenir-Light.woff2') format('woff2'),
                 url('https://assets.persevera.com.br/fonts/Avenir-Light.woff') format('woff');
            font-weight: 300;
            font-style: normal;
            font-display: swap;
        }
        
        /* Fallback para fontes web seguras caso as fontes Avenir não carreguem */
        :root {
            --primary-color: #124A81;
            --secondary-color: #0F75BC;
            --hover-color: #2554CC;
            --submit-hover: #16AA52;
            --background-color: #F3F3FE;
            --form-bg: #FFFFFF;
            --divider-color: #F3F3FE;
            --text-color: #000000;
            --sub-text-color: #57647e;
            --input-border: rgba(195, 202, 216, 0.75);
            --input-focus-border: rgba(46, 105, 255, 1);
            --input-focus-shadow: rgba(201, 216, 254, 0.25);
            --error-color: #e74c3c;
            --error-bg: rgba(231, 76, 60, 0.1);
            --light-color: #F5F5F5;
            --dark-color: #333;
            --font-primary: 'Avenir', 'avenir', 'Nunito', Helvetica, Arial, sans-serif;
            --font-light: 'Avenir Light', 'avenir', 'Nunito Light', 'Nunito', Helvetica, Arial, sans-serif;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            background-color: var(--background-color);
            padding: 20px;
            color: var(--text-color);
            font-family: var(--font-primary);
        }
        
        .form-container {
            max-width: 800px;
            margin: 0 auto;
            background-color: var(--form-bg);
  border-radius: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            overflow: hidden;
        }
        
        .form-header {
            padding: 40px 52px;
            border-bottom: 1px solid var(--divider-color);
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #FFFFFF;
        }
        
        .header-logo {
            max-width: 265px;
            height: auto;
            display: block;
        }
        
        .form-logo {
            width: 120px;
            margin-right: 20px;
        }
        
        .form-title {
            font-size: 28px;
            font-weight: 600;
            font-family: var(--font-primary);
            letter-spacing: -0.02em;
            color: var(--primary-color);
        }
        
        .form-content {
            padding: 30px 38px;
        }
        
        .form-section-header {
            margin-top: 25px;
            margin-bottom: 24px;
        }
        
        .form-section-title {
            font-size: 22px;
            font-weight: 600;
            margin-bottom: 5px;
            font-family: var(--font-primary);
            color: var(--primary-color);
            letter-spacing: -0.01em;
  position: relative;
            padding-bottom: 8px;
        }
        
        .form-section-title:after {
            content: "";
            position: absolute;
            bottom: 0;
  left: 0;
            width: 40px;
            height: 3px;
            background-color: var(--secondary-color);
            border-radius: 3px;
        }
        
        .divider {
            height: 1px;
            background-color: var(--divider-color);
            margin: 25px 0;
        }
        
        .form-row {
            margin-bottom: 15px;
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .form-group {
            flex: 1;
            min-width: 250px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            font-size: 14px;
            font-family: var(--font-primary);
        }
        
        .form-label.required::after {
            content: " *";
            color: var(--error-color);
            font-weight: bold;
        }
        
        .required-note {
            font-size: 13px;
            color: var(--sub-text-color);
            margin-bottom: 15px;
            font-style: italic;
            text-align: right;
        }
        
        .required-note span {
            color: var(--error-color);
            font-weight: bold;
        }
        
        .form-control {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--input-border);
            border-radius: 6px;
            font-size: 15px;
            transition: all 0.3s ease;
            font-family: var(--font-light);
        }
        
        .form-control:hover {
            border-color: rgba(195, 202, 216, 0.5);
            box-shadow: 0 0 0 2px rgba(195, 202, 216, 0.25);
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--input-focus-border);
            box-shadow: 0 0 0 3px var(--input-focus-shadow);
        }
        
        select.form-control {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="%23666" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>');
  background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 16px;
            padding-right: 36px;
            font-family: var(--font-light);
        }
        
        .radio-group, .checkbox-group {
            display: flex;
            gap: 20px;
            margin-top: 5px;
        }
        
        .radio-item, .checkbox-item {
            display: flex;
            align-items: center;
            cursor: pointer;
        }
        
        .radio-input, .checkbox-input {
            margin-right: 8px;
        }
        
        .radio-label, .checkbox-label {
            font-size: 14px;
            font-family: var(--font-light);
        }
        
        .form-textarea {
            min-height: 100px;
            font-family: var(--font-light);
        }
        
        .form-hint {
            display: block;
            font-size: 12px;
            color: var(--sub-text-color);
            margin-top: 4px;
            font-family: var(--font-light);
        }
        
        .form-submit {
            text-align: right;
            margin-top: 30px;
        }
        
        .btn-submit {
            background-color: var(--secondary-color);
            color: white;
            border: none;
            border-radius: 6px;
            padding: 12px 30px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.3s ease;
            font-family: var(--font-primary);
        }
        
        .btn-submit:hover {
            background-color: var(--submit-hover);
        }
        
        .error {
            color: var(--error-color);
            font-size: 12px;
            margin-top: 4px;
            font-family: var(--font-light);
        }
        
        .form-control.error {
            border-color: var(--error-color);
            background-color: var(--error-bg);
        }
        
        /* Estilo para indicador de carregamento no campo CEP */
        .form-control.loading {
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 38 38" stroke="rgba(0,0,0,0.5)"><g fill="none" fill-rule="evenodd"><g transform="translate(1 1)" stroke-width="2"><circle stroke-opacity=".25" cx="18" cy="18" r="18"/><path d="M36 18c0-9.94-8.06-18-18-18"><animateTransform attributeName="transform" type="rotate" from="0 18 18" to="360 18 18" dur="1s" repeatCount="indefinite"/></path></g></g></svg>');
            background-repeat: no-repeat;
            background-position: right 10px center;
            background-size: 20px;
            padding-right: 40px;
        }
        
        /* Estilos para mensagens de erro */
        .error-message {
            color: var(--error-color);
            font-size: 12px;
            margin-top: 4px;
            font-family: var(--font-light);
        }
        
        /* Estilos para validação de CEP */
        .form-control.cep-valido {
            border-color: var(--secondary-color) !important;
            background-color: rgba(15, 117, 188, 0.1) !important;
        }
        
        /* Estilo para as abas */
        .form-tabs {
            display: flex;
            border-bottom: 1px solid var(--divider-color);
            background-color: var(--light-color);
        }
        
        .form-tab {
            padding: 15px 20px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            color: var(--sub-text-color);
            flex: 1;
            text-align: center;
        }
        
        .form-tab.active {
            border-bottom-color: var(--secondary-color);
            color: var(--primary-color);
            background-color: #fff;
        }
        
        .form-tab:hover:not(.active) {
            background-color: rgba(15, 117, 188, 0.05);
            color: var(--secondary-color);
        }
        
        /* Estilo para o conteúdo das abas */
        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* Estilo para os botões de navegação entre as abas */
        .nav-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        
        .nav-button {
            background-color: var(--secondary-color);
            color: white;
            border: none;
            border-radius: 6px;
            padding: 10px 20px;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        
        .nav-button:hover {
            background-color: var(--hover-color);
        }
        
        .nav-button.prev {
            background-color: var(--light-color);
            color: var(--secondary-color);
        }
        
        .nav-button.prev:hover {
            background-color: var(--divider-color);
        }
        
        .btn-submit {
            background-color: var(--secondary-color);
            color: white;
            border: none;
            border-radius: 6px;
            padding: 12px 30px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.3s ease;
            font-family: var(--font-primary);
        }
        
        .btn-submit:hover {
            background-color: var(--submit-hover);
        }
        
        /* Ajuste responsivo */
        @media (max-width: 576px) {
            .form-tab {
                padding: 12px 10px;
                font-size: 14px;
            }
            
            /* Ícones para as abas no mobile */
            .form-tab[data-tab="tab-1"]::before {
                content: "";
                display: none;
            }
            
            .form-tab[data-tab="tab-2"]::before {
                content: "";
                display: none;
            }
            
            .form-tab[data-tab="tab-3"]::before {
                content: "";
                display: none;
            }
            
            .form-tab[data-tab="tab-4"]::before {
                content: "";
                display: none;
            }
            
            .form-tabs {
                position: sticky;
                top: 0;
                z-index: 100;
                box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            }
            
            .nav-button, .btn-submit {
                padding: 12px 24px;
                font-size: 16px;
                width: 48%;  /* Ligeiramente aumentado para ficar melhor em telas menores */
                height: 50px;
                display: flex;
                align-items: center;
                justify-content: center;
                text-align: center;
                margin: 0;
            }
            
            .form-container {
                border-radius: 10px;
                overflow: hidden;
                margin: 10px;
                width: calc(100% - 20px);
                max-width: 100%;
            }
            
            .nav-buttons {
                display: flex;
                justify-content: space-between;
                margin-top: 30px;
                width: 100%;
                gap: 10px;
            }
        }
        
        @media (max-width: 768px) {
            .form-header {
                padding: 20px;
                flex-direction: column;
                text-align: center;
            }
            
            .header-logo {
                max-width: 200px;
                margin-bottom: 10px;
            }
            
            .form-logo {
                margin-right: 0;
                margin-bottom: 15px;
            }
            
            .form-content {
                padding: 16px;
            }
            
            .form-group {
                flex: 1 0 100%;
            }
            
            .form-control {
                padding: 14px;
                font-size: 16px; /* Fonte maior para facilitar a leitura no mobile */
            }
            
            input[type="file"].form-control {
                padding: 10px;
            }
            
            .form-row {
                margin-bottom: 20px;
            }
            
            body {
                padding: 0;
            }

            /* Aumenta o tamanho dos botões de rádio e checkbox para facilitar o toque */
            .radio-input, .checkbox-input {
                width: 20px;
                height: 20px;
                margin-right: 10px;
            }
            
            .radio-label, .checkbox-label {
                font-size: 16px;
            }
            
            .radio-group, .checkbox-group {
                flex-direction: column;
                gap: 12px;
            }
            
            .radio-item, .checkbox-item {
                padding: 6px 0;
            }
            
            /* Estilo unificado para botões em dispositivos móveis */
            .nav-button, .btn-submit {
                height: 50px;
                width: 48%;  /* Ligeiramente aumentado para ficar melhor em telas maiores */
                padding: 0 15px;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 16px;
                text-align: center;
                margin: 0;
            }
            
            .nav-buttons {
                display: flex;
                justify-content: space-between;
                margin-top: 30px;
                width: 100%;
                gap: 10px;
            }
        }
        
        /* Media query específica para dispositivos muito pequenos */
        @media (max-width: 360px) {
            .form-tab {
                padding: 8px 5px;
                font-size: 12px;
            }
            
            .form-content {
                padding: 12px;
            }
            
            .form-section-title {
                font-size: 18px;
            }
        }
        
        /* Otimizações para orientação paisagem em dispositivos móveis */
        @media (max-width: 768px) and (orientation: landscape) {
            .form-container {
                max-width: 90%;
                margin: 10px auto;
            }
            
            .form-header {
                padding: 15px;
            }
            
            .form-row {
                flex-wrap: nowrap;
            }
            
            .form-group {
                flex: 1 0 auto;
                min-width: auto;
            }
            
            .tab-content {
                max-height: 70vh;
                overflow-y: auto;
                padding-bottom: 20px;
            }
            
            .form-tabs {
                position: sticky;
                top: 0;
                z-index: 100;
            }
        }
        
        /* Melhorias para acessibilidade de toque */
        @media (hover: none) and (pointer: coarse) {
            .form-control,
            .nav-button,
            .btn-submit,
            select,
            input[type="file"],
            .radio-item,
            .checkbox-item {
                cursor: pointer;
                touch-action: manipulation;
            }
            
            /* Previne zoom no foco em iOS */
            input, 
            select, 
            textarea {
                font-size: 16px !important;
            }
            
            /* Aumenta área de toque */
            .form-tab,
            .nav-button,
            .btn-submit,
            select,
            .radio-item,
            .checkbox-item,
            input[type="file"] {
                min-height: 44px;
            }
        }
        
        /* Estilos para o campo de telefone com seletor de país */
        .phone-input-container {
            display: flex;
            align-items: stretch;
            width: 100%;
            position: relative;
        }

        .country-select {
            width: 90px;
            border: 1px solid var(--input-border);
            border-radius: 6px 0 0 6px;
            border-right: none;
            background-color: var(--light-color);
            display: flex;
            align-items: center;
            padding: 0 8px;
            cursor: pointer;
        }
        
        /* Estilos para campo com erro de caracteres especiais */
        .special-char-error {
            border-color: var(--error-color) !important;
            background-color: var(--error-bg) !important;
        }
        
        .country-select:hover {
            background-color: var(--divider-color);
        }

        .country-select img {
            width: 24px;
            height: 16px;
            margin-right: 4px;
            border-radius: 2px;
        }

        .country-select .country-code {
            font-size: 14px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            flex: 1;
        }

        .country-select .dropdown-icon {
            margin-left: 2px;
            opacity: 0.5;
            font-size: 12px;
        }

        .phone-input-container .form-control {
            flex: 1;
            border-radius: 0 6px 6px 0;
        }

        .country-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            width: 240px;
            max-height: 132px; /* Alterado para mostrar aproximadamente 3 países (44px por país) */
            overflow-y: auto;
            background-color: white;
            border: 1px solid var(--input-border);
            border-radius: 6px;
            z-index: 1000;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            display: none;
        }

        .country-dropdown.active {
            display: block;
        }

        .country-item {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            height: 44px; /* Altura fixa para cada item */
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .country-item:hover {
            background-color: var(--background-color);
        }

        .country-item img {
            width: 24px;
            height: 16px;
            margin-right: 8px;
            border-radius: 2px;
        }

        .country-item .country-name {
            font-size: 14px;
            flex: 1;
        }

        .country-item .country-dial-code {
            font-size: 13px;
            color: var(--sub-text-color);
        }

        /* Indica o país selecionado atualmente */
        .country-item.selected {
            background-color: rgba(15, 117, 188, 0.1);
        }

        /* Estilo telefone válido */
        .form-control.phone-valid {
            border-color: var(--secondary-color);
            background-color: rgba(15, 117, 188, 0.05);
        }
        
        /* Estilo para campos preenchidos automaticamente */
        .form-control.auto-filled {
            border-color: var(--secondary-color);
            background-color: rgba(15, 117, 188, 0.05);
            cursor: not-allowed;
        }
        
        /* Adiciona efeito sutil para indicar campos desabilitados mas com valor */
        .form-control:disabled {
            opacity: 0.8;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <div class="form-container">
        <div class="form-header">
            <img src="https://static.wixstatic.com/media/056676_38b0c30273f94ab8b386921f459c7b91~mv2.png/v1/crop/x_0,y_9,w_2300,h_347/fill/w_265,h_40,al_c,q_85,usm_0.66_1.00_0.01,enc_avif,quality_auto/_edited.png" alt="Persevera Logo" class="header-logo">
        </div>
        <form id="cadastro-form" class="jotform-form" method="post" action="https://submit.jotform.com/submit/250986205951665">
            <input type="hidden" name="formID" value="250986205951665">
            
            <div class="form-content">
                <!-- Navegação por abas -->
                <div class="form-tabs">
                    <div class="form-tab active" data-tab="tab-1">Dados Pessoais</div>
                    <div class="form-tab" data-tab="tab-2">Contato</div>
                    <div class="form-tab" data-tab="tab-3">Envio de Documentos</div>
                    <div class="form-tab" data-tab="tab-4">Conformidade e Termos</div>
                </div>
                
                <!-- Seção de Dados Pessoais -->
                <div id="tab-1" class="tab-content active">
                    <div class="form-section-header">
                        <h2 class="form-section-title">Dados Pessoais</h2>
                    </div>
                    
                    <div class="required-note">
                        <span>*</span> Campos obrigatórios
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label required" for="input_94">Nome Completo</label>
                            <input type="text" id="input_94" name="q94_nomeCompleto" class="form-control" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label required" for="input_102">Sexo</label>
                            <select class="form-control" id="input_102" name="q102_sexo" required>
                                <option value="">Selecione</option>
                                <option value="Masculino">Masculino</option>
                                <option value="Feminino">Feminino</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label required" for="input_103">Estado Civil</label>
                            <select class="form-control" id="input_103" name="q103_estadoCivil" required>
                                <option value="">Selecione</option>
                                <option value="Solteiro(a)">Solteiro(a)</option>
                                <option value="Casado(a)">Casado(a)</option>
                                <option value="Divorciado(a)">Divorciado(a)</option>
                                <option value="Viúvo(a)">Viúvo(a)</option>
                                <option value="União Estável">União Estável</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label required" for="input_95">CPF</label>
                            <input type="text" id="input_95" name="q95_cpf" class="form-control" placeholder="000.000.000-00" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label required" for="input_96">Nacionalidade</label>
                            <input type="text" id="input_96" name="q96_nacionalidade" class="form-control" value="Brasileiro(a)" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label required" for="input_97">Naturalidade</label>
                            <input type="text" id="input_97" name="q97_naturalidade" class="form-control" placeholder="Cidade e Estado de Nascimento" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label required" for="input_104">Data de Nascimento</label>
                            <input type="text" id="input_104" name="q104_dataNascimento[full]" class="form-control" placeholder="DD/MM/AAAA" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label required" for="input_105">Tipo de Documento</label>
                            <select class="form-control" id="input_105" name="q105_tipoDocumento" required>
                                <option value="">Selecione</option>
                                <option value="RG">RG</option>
                                <option value="CNH">CNH</option>
                                <option value="Passaporte">Passaporte</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label required" for="input_98">Nº do Documento</label>
                            <input type="text" id="input_98" name="q98_numeroDocumento" class="form-control" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label required" for="input_106">Data de Expedição</label>
                            <input type="text" id="input_106" name="q106_dataExpedicao[full]" class="form-control" placeholder="DD/MM/AAAA" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label required" for="input_99">Órgão Emissor</label>
                            <input type="text" id="input_99" name="q99_orgaoEmissor" class="form-control" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label required" for="input_100">Nome da Mãe</label>
                            <input type="text" id="input_100" name="q100_nomeMae" class="form-control" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label" for="input_101">Nome do Pai</label>
                            <input type="text" id="input_101" name="q101_nomePai" class="form-control">
                        </div>
                    </div>
                    
                    <div class="form-section-header">
                        <h2 class="form-section-title">Dados do Cônjuge</h2>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label" for="input_225">Nome Completo</label>
                            <input type="text" id="input_225" name="q225_nomeCompletoConjuge" class="form-control">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label" for="input_226">Sexo</label>
                            <select class="form-control" id="input_226" name="q226_sexoConjuge">
                                <option value="">Selecione</option>
                                <option value="Masculino">Masculino</option>
                                <option value="Feminino">Feminino</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="input_227">Estado Civil</label>
                            <select class="form-control" id="input_227" name="q227_estadoCivilConjuge">
                                <option value="">Selecione</option>
                                <option value="Solteiro(a)">Solteiro(a)</option>
                                <option value="Casado(a)">Casado(a)</option>
                                <option value="Divorciado(a)">Divorciado(a)</option>
                                <option value="Viúvo(a)">Viúvo(a)</option>
                                <option value="União Estável">União Estável</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label" for="input_228">CPF</label>
                            <input type="text" id="input_228" name="q228_cpfConjuge" class="form-control" placeholder="000.000.000-00">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="input_229">Nacionalidade</label>
                            <input type="text" id="input_229" name="q229_nacionalidadeConjuge" class="form-control" value="Brasileiro(a)">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label" for="input_230">Naturalidade</label>
                            <input type="text" id="input_230" name="q230_naturalidadeConjuge" class="form-control" placeholder="Cidade e Estado de Nascimento">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="input_231">Data de Nascimento</label>
                            <input type="text" id="input_231" name="q231_dataNascimentoConjuge[full]" class="form-control" placeholder="DD/MM/AAAA">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label" for="input_232">Tipo de Documento</label>
                            <select class="form-control" id="input_232" name="q232_tipoDocumentoConjuge">
                                <option value="">Selecione</option>
                                <option value="RG">RG</option>
                                <option value="CNH">CNH</option>
                                <option value="Passaporte">Passaporte</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="input_233">Nº do Documento</label>
                            <input type="text" id="input_233" name="q233_numeroDocumentoConjuge" class="form-control">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label" for="input_234">Data de Expedição</label>
                            <input type="text" id="input_234" name="q234_dataExpedicaoConjuge[full]" class="form-control" placeholder="DD/MM/AAAA">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="input_235">Órgão Emissor</label>
                            <input type="text" id="input_235" name="q235_orgaoEmissorConjuge" class="form-control">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label" for="input_236">Nome da Mãe</label>
                            <input type="text" id="input_236" name="q236_nomeMaeConjuge" class="form-control">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label" for="input_237">Nome do Pai</label>
                            <input type="text" id="input_237" name="q237_nomePaiConjuge" class="form-control">
                        </div>
                    </div>
                    
                    <div class="nav-buttons">
                        <div></div> <!-- Espaço vazio para alinhamento -->
                        <button type="button" class="nav-button next-tab" data-next="tab-2">Próximo</button>
                    </div>
                </div>
                
                <!-- Seção de Contato -->
                <div id="tab-2" class="tab-content">
                    <div class="form-section-header">
                        <h2 class="form-section-title">Contato</h2>
                    </div>
                    
                    <div class="required-note">
                        <span>*</span> Campos obrigatórios
                    </div>
                    
                    <div class="form-section-header">
                        <h3 class="form-section-title">Endereço de Correspondência</h3>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label required" for="input_108">CEP</label>
                            <input type="text" id="input_108" name="q108_cepCorrespondencia" class="form-control" placeholder="00000-000" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label required" for="input_109">Logradouro</label>
                            <input type="text" id="input_109" name="q109_logradouroCorrespondencia" class="form-control" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label required" for="input_112">Número</label>
                            <input type="text" id="input_112" name="q112_numeroCorrespondencia" class="form-control" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="input_113">Complemento</label>
                            <input type="text" id="input_113" name="q113_complementoCorrespondencia" class="form-control">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label required" for="input_111">Bairro</label>
                            <input type="text" id="input_111" name="q111_bairroCorrespondencia" class="form-control" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label required" for="input_110">Cidade</label>
                            <input type="text" id="input_110" name="q110_cidadeCorrespondencia" class="form-control" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label required" for="input_114">Estado</label>
                            <select class="form-control" id="input_114" name="q114_estadoCorrespondencia" required>
                                <option value="">Selecione</option>
                                <option value="AC">Acre</option>
                                <option value="AL">Alagoas</option>
                                <option value="AP">Amapá</option>
                                <option value="AM">Amazonas</option>
                                <option value="BA">Bahia</option>
                                <option value="CE">Ceará</option>
                                <option value="DF">Distrito Federal</option>
                                <option value="ES">Espírito Santo</option>
                                <option value="GO">Goiás</option>
                                <option value="MA">Maranhão</option>
                                <option value="MT">Mato Grosso</option>
                                <option value="MS">Mato Grosso do Sul</option>
                                <option value="MG">Minas Gerais</option>
                                <option value="PA">Pará</option>
                                <option value="PB">Paraíba</option>
                                <option value="PR">Paraná</option>
                                <option value="PE">Pernambuco</option>
                                <option value="PI">Piauí</option>
                                <option value="RJ">Rio de Janeiro</option>
                                <option value="RN">Rio Grande do Norte</option>
                                <option value="RS">Rio Grande do Sul</option>
                                <option value="RO">Rondônia</option>
                                <option value="RR">Roraima</option>
                                <option value="SC">Santa Catarina</option>
                                <option value="SP">São Paulo</option>
                                <option value="SE">Sergipe</option>
                                <option value="TO">Tocantins</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-section-header">
                        <h3 class="form-section-title">Endereço de Residência</h3>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group" style="width: 100%;">
                            <label class="checkbox-item">
                                <input type="checkbox" id="same-address" class="checkbox-input">
                                <span class="checkbox-label">O endereço de residência é o mesmo que o endereço de correspondência</span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label required" for="input_215">CEP</label>
                            <input type="text" id="input_215" name="q215_cepResidencia" class="form-control" placeholder="00000-000" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label required" for="input_216">Logradouro</label>
                            <input type="text" id="input_216" name="q216_logradouroResidencia" class="form-control" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label required" for="input_217">Número</label>
                            <input type="text" id="input_217" name="q217_numeroResidencia" class="form-control" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="input_219">Complemento</label>
                            <input type="text" id="input_219" name="q219_complementoResidencia" class="form-control">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label required" for="input_220">Bairro</label>
                            <input type="text" id="input_220" name="q220_bairroResidencia" class="form-control" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label required" for="input_221">Cidade</label>
                            <input type="text" id="input_221" name="q221_cidadeResidencia" class="form-control" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label required" for="input_222">Estado</label>
                            <select class="form-control" id="input_222" name="q222_estadoResidencia" required>
                                <option value="">Selecione</option>
                                <option value="AC">Acre</option>
                                <option value="AL">Alagoas</option>
                                <option value="AP">Amapá</option>
                                <option value="AM">Amazonas</option>
                                <option value="BA">Bahia</option>
                                <option value="CE">Ceará</option>
                                <option value="DF">Distrito Federal</option>
                                <option value="ES">Espírito Santo</option>
                                <option value="GO">Goiás</option>
                                <option value="MA">Maranhão</option>
                                <option value="MT">Mato Grosso</option>
                                <option value="MS">Mato Grosso do Sul</option>
                                <option value="MG">Minas Gerais</option>
                                <option value="PA">Pará</option>
                                <option value="PB">Paraíba</option>
                                <option value="PR">Paraná</option>
                                <option value="PE">Pernambuco</option>
                                <option value="PI">Piauí</option>
                                <option value="RJ">Rio de Janeiro</option>
                                <option value="RN">Rio Grande do Norte</option>
                                <option value="RS">Rio Grande do Sul</option>
                                <option value="RO">Rondônia</option>
                                <option value="RR">Roraima</option>
                                <option value="SC">Santa Catarina</option>
                                <option value="SP">São Paulo</option>
                                <option value="SE">Sergipe</option>
                                <option value="TO">Tocantins</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label required" for="input_118">Telefone</label>
                            <div class="phone-input-container">
                                <div id="country-select" class="country-select">
                                    <img src="https://flagcdn.com/br.svg" alt="Brasil" id="selected-flag">
                                    <span class="country-code" id="selected-code">+55</span>
                                    <span class="dropdown-icon">▼</span>
                                </div>
                                <input type="tel" id="input_118" name="q118_telefone" class="form-control" placeholder="(00) 00000-0000" required>
                                <!-- Campo oculto para armazenar o código do país -->
                                <input type="hidden" id="input_118_country_code" value="+55">
                                <div id="country-dropdown" class="country-dropdown">
                                    <!-- Lista de países será gerada via JavaScript -->
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label required" for="input_117">E-mail</label>
                            <input type="email" id="input_117" name="q117_email" class="form-control" placeholder="exemplo@exemplo.com" required>
                        </div>
                    </div>
                    
                    <div class="nav-buttons">
                        <button type="button" class="nav-button prev prev-tab" data-prev="tab-1" tabindex="-1">Anterior</button>
                        <button type="button" class="nav-button next-tab" data-next="tab-3">Próximo</button>
                    </div>
                </div>
                
                <!-- Seção de Envio de Documentos -->
                <div id="tab-3" class="tab-content">
                    <div class="form-section-header">
                        <h2 class="form-section-title">Envio de Documentos</h2>
                    </div>
                    
                    <div class="required-note">
                        <span>*</span> Campos obrigatórios
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label required" for="input_127">Documento de Identidade (com CPF)</label>
                            <input type="file" id="input_127" name="q127_envioDocumentoIdentidade[]" class="form-control" accept=".pdf,.doc,.docx,.jpg,.jpeg,.png,.gif,.html" multiple required>
                            <span class="form-hint">Formatos aceitos: PDF, DOC, DOCX, JPG, JPEG, PNG, GIF, HTML</span>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label required" for="input_128">Comprovante de Residência (válido por até 3 meses)</label>
                            <input type="file" id="input_128" name="q128_envioComprovanteResidencia[]" class="form-control" accept=".pdf,.doc,.docx,.jpg,.jpeg,.png,.gif,.html" required>
                            <span class="form-hint">Formatos aceitos: PDF, DOC, DOCX, JPG, JPEG, PNG, GIF, HTML</span>
                        </div>
                    </div>
                    
                    <div class="nav-buttons">
                        <button type="button" class="nav-button prev prev-tab" data-prev="tab-2">Anterior</button>
                        <button type="button" class="nav-button next-tab" data-next="tab-4">Próximo</button>
                    </div>
                </div>
                
                <!-- Seção de Conformidade e Termos -->
                <div id="tab-4" class="tab-content">
                    <div class="form-section-header">
                        <h2 class="form-section-title">Conformidade e Termos</h2>
                    </div>
                    
                    <div class="required-note">
                        <span>*</span> Campos obrigatórios
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label required">Você é uma Pessoa Politicamente Exposta (PPE)?</label>
                            <div class="radio-group">
                                <label class="radio-item">
                                    <input type="radio" name="q121_pessoaPoliticaExposta" value="Sim" class="radio-input" required>
                                    <span class="radio-label">Sim</span>
                                </label>
                                <label class="radio-item">
                                    <input type="radio" name="q121_pessoaPoliticaExposta" value="Não" class="radio-input" required>
                                    <span class="radio-label">Não</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label required">Você é parente ou possui relacionamento próximo com uma Pessoa Politicamente Exposta?</label>
                            <div class="radio-group">
                                <label class="radio-item">
                                    <input type="radio" name="q122_parentePessoaPoliticaExposta" value="Sim" class="radio-input" required>
                                    <span class="radio-label">Sim</span>
                                </label>
                                <label class="radio-item">
                                    <input type="radio" name="q122_parentePessoaPoliticaExposta" value="Não" class="radio-input" required>
                                    <span class="radio-label">Não</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label" for="input_123">Se respondeu "Sim" a alguma das perguntas acima, forneça detalhes:</label>
                            <textarea id="input_123" name="q123_seSim" class="form-control form-textarea"></textarea>
                        </div>
                    </div>
                    
                    <div class="form-section-header">
                        <h3 class="form-section-title">Relacionamento com outros países</h3>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label required">Você atesta que nasceu, é cidadão, possui nacionalidade, residência permanente ou domicílio fiscal diferente de Brasil?</label>
                            <div class="radio-group">
                                <label class="radio-item">
                                    <input type="radio" name="q129_cidadaoBrasileiro" value="Sim" class="radio-input" required>
                                    <span class="radio-label">Sim</span>
                                </label>
                                <label class="radio-item">
                                    <input type="radio" name="q129_cidadaoBrasileiro" value="Não" class="radio-input" required>
                                    <span class="radio-label">Não</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-section-header">
                        <h3 class="form-section-title">Origem dos Recursos</h3>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label required">Declaração de Origem dos Recursos</label>
                            <div class="checkbox-group" style="flex-direction: column;">
                                <label class="checkbox-item">
                                    <input type="checkbox" name="q124_declaracaoOrigemRecursos[]" value="Declaro que os recursos a serem investidos são próprios e de origem lícita" class="checkbox-input" required>
                                    <span class="checkbox-label">Declaro que os recursos a serem investidos são próprios e de origem lícita</span>
                                </label>
                                <label class="checkbox-item">
                                    <input type="checkbox" name="q124_declaracaoOrigemRecursos[]" value="Declaro que estou ciente das normas e regulamentos da CVM e do Banco Central do Brasil" class="checkbox-input" required>
                                    <span class="checkbox-label">Declaro que estou ciente das normas e regulamentos da CVM e do Banco Central do Brasil</span>
                                </label>
                                <label class="checkbox-item">
                                    <input type="checkbox" name="q124_declaracaoOrigemRecursos[]" value="Declaro que li e aceito os termos e condições dos fundos de investimento" class="checkbox-input" required>
                                    <span class="checkbox-label">Declaro que li e aceito os termos e condições dos fundos de investimento</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="nav-buttons">
                        <button type="button" class="nav-button prev prev-tab" data-prev="tab-3">Anterior</button>
                        <button type="submit" class="btn-submit">Enviar</button>
                    </div>
                    
                    <input type="hidden" class="simple_spc" id="simple_spc" name="simple_spc" value="250986205951665">
                </div>
            </div>
            
            <!-- Campos ocultos para processamento de datas pelo JotForm -->
            <div style="display:none">
                <!-- Campos ocultos para Data de Nascimento -->
                <input type="hidden" id="day_104" name="q104_dataNascimento[day]" />
                <input type="hidden" id="month_104" name="q104_dataNascimento[month]" />
                <input type="hidden" id="year_104" name="q104_dataNascimento[year]" />
                
                <!-- Campos ocultos para Data de Expedição -->
                <input type="hidden" id="day_106" name="q106_dataExpedicao[day]" />
                <input type="hidden" id="month_106" name="q106_dataExpedicao[month]" />
                <input type="hidden" id="year_106" name="q106_dataExpedicao[year]" />
                
                <!-- Campos ocultos para Data de Nascimento do Cônjuge -->
                <input type="hidden" id="day_231" name="q231_dataNascimentoConjuge[day]" />
                <input type="hidden" id="month_231" name="q231_dataNascimentoConjuge[month]" />
                <input type="hidden" id="year_231" name="q231_dataNascimentoConjuge[year]" />
                
                <!-- Campos ocultos para Data de Expedição do Cônjuge -->
                <input type="hidden" id="day_234" name="q234_dataExpedicaoConjuge[day]" />
                <input type="hidden" id="month_234" name="q234_dataExpedicaoConjuge[month]" />
                <input type="hidden" id="year_234" name="q234_dataExpedicaoConjuge[year]" />
            </div>
        </form>
    </div>
    
    <script>
        // Formatação de campos
        document.addEventListener('DOMContentLoaded', function() {
            // Detectar se o dispositivo é mobile
            const isMobile = window.innerWidth < 768;
            
            // Atualização final do telefone completo antes do envio do formulário
            const form = document.getElementById('cadastro-form');
            if (form) {
                form.addEventListener('submit', function(e) {
                    // Prevenir o envio padrão do formulário para garantir que nosso código execute antes
                    e.preventDefault();
                    
                    // Obter o campo de telefone e o código do país
                    const phoneInput = document.getElementById('input_118');
                    const countryCodeEl = document.getElementById('selected-code');
                    
                    if (phoneInput && phoneInput.value.trim() && countryCodeEl) {
                        // Extrair apenas os dígitos numéricos do telefone
                        const numericValue = phoneInput.value.replace(/\D/g, '');
                        // Obter o código do país
                        const countryCode = countryCodeEl.textContent;
                        // Atualizar o valor do campo de telefone para incluir o código do país
                        phoneInput.value = countryCode + numericValue;
                        
                        console.log('Telefone que será enviado:', phoneInput.value);
                    }
                    
                    // Continuar com o envio do formulário após um pequeno delay
                    setTimeout(() => {
                        form.submit();
                    }, 100);
                });
            }
            
            // Personalizar experiência baseado no tipo de dispositivo
            if (isMobile) {
                // Adicionar tipo de input apropriado para dispositivos móveis
                document.getElementById('input_104').setAttribute('inputmode', 'numeric');
                document.getElementById('input_106').setAttribute('inputmode', 'numeric');
                document.getElementById('input_95').setAttribute('inputmode', 'numeric');
                document.getElementById('input_108').setAttribute('inputmode', 'tel');
                document.getElementById('input_118').setAttribute('inputmode', 'tel');
                document.getElementById('input_117').setAttribute('inputmode', 'email');
                document.getElementById('input_215').setAttribute('inputmode', 'tel');
                document.getElementById('input_231').setAttribute('inputmode', 'numeric');
                document.getElementById('input_234').setAttribute('inputmode', 'numeric');
                
                // Adiciona autocapitalize para campos de nome
                document.getElementById('input_94').setAttribute('autocapitalize', 'words');
                document.getElementById('input_100').setAttribute('autocapitalize', 'words');
                document.getElementById('input_101').setAttribute('autocapitalize', 'words');
                document.getElementById('input_225').setAttribute('autocapitalize', 'words');
                document.getElementById('input_236').setAttribute('autocapitalize', 'words');
                document.getElementById('input_237').setAttribute('autocapitalize', 'words');
                
                // Adiciona autocomplete para campos apropriados
                document.getElementById('input_94').setAttribute('autocomplete', 'name');
                document.getElementById('input_117').setAttribute('autocomplete', 'email');
                document.getElementById('input_118').setAttribute('autocomplete', 'tel');
                document.getElementById('input_108').setAttribute('autocomplete', 'postal-code');
                document.getElementById('input_109').setAttribute('autocomplete', 'address-line1');
                document.getElementById('input_110').setAttribute('autocomplete', 'address-level2');
                document.getElementById('input_215').setAttribute('autocomplete', 'postal-code');
                document.getElementById('input_216').setAttribute('autocomplete', 'address-line1');
                document.getElementById('input_221').setAttribute('autocomplete', 'address-level2');
                
                // Aumenta a área clicável das abas
                const tabs = document.querySelectorAll('.form-tab');
                tabs.forEach(tab => {
                    tab.style.minHeight = '60px';
                });
                
                // Ajusta a interface com base na orientação do dispositivo
                function handleOrientationChange() {
                    const isLandscape = window.innerWidth > window.innerHeight;
                    const formRows = document.querySelectorAll('.form-row');
                    
                    if (isLandscape) {
                        // Ajustes para modo paisagem
                        formRows.forEach(row => {
                            row.style.flexWrap = 'nowrap';
                        });
                        
                        // Garantir que o conteúdo da aba tenha scroll próprio
                        document.querySelectorAll('.tab-content').forEach(tab => {
                            tab.style.maxHeight = '70vh';
                            tab.style.overflowY = 'auto';
                        });
                    } else {
                        // Ajustes para modo retrato
                        formRows.forEach(row => {
                            row.style.flexWrap = 'wrap';
                        });
                        
                        document.querySelectorAll('.tab-content').forEach(tab => {
                            tab.style.maxHeight = '';
                            tab.style.overflowY = '';
                        });
                    }
                }
                
                // Verificar orientação inicial
                handleOrientationChange();
                
                // Atualizar quando houver mudança na orientação
                window.addEventListener('resize', handleOrientationChange);
                window.addEventListener('orientationchange', handleOrientationChange);
            }
            
            // Tab Navigation Code
            const tabs = document.querySelectorAll('.form-tab');
            const tabContents = document.querySelectorAll('.tab-content');
            const nextButtons = document.querySelectorAll('.next-tab');
            const prevButtons = document.querySelectorAll('.prev-tab');
            
            // Função para trocar de aba
            function switchTab(tabId) {
                // Oculta todas as abas e remove a classe active
                tabContents.forEach(content => {
                    content.classList.remove('active');
                });
                
                tabs.forEach(tab => {
                    tab.classList.remove('active');
                });
                
                // Ativa a aba selecionada
                document.getElementById(tabId).classList.add('active');
                document.querySelector(`[data-tab="${tabId}"]`).classList.add('active');
                
                // Scroll para o topo do formulário
                document.querySelector('.form-container').scrollIntoView({ behavior: 'smooth' });
            }
            
            // Adiciona event listeners para as abas
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    switchTab(tabId);
                });
            });
            
            // Botões de próximo
            nextButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const nextTabId = this.getAttribute('data-next');
                    
                    // Valida os campos da aba atual antes de avançar
                    const currentTabId = document.querySelector('.tab-content.active').id;
                    if (validateTabFields(currentTabId)) {
                        switchTab(nextTabId);
                    }
                });
            });
            
            // Botões de anterior
            prevButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const prevTabId = this.getAttribute('data-prev');
                    switchTab(prevTabId);
                });
            });
            
            // Função para validar campos de uma aba específica
            function validateTabFields(tabId) {
                const currentTab = document.getElementById(tabId);
                const requiredFields = currentTab.querySelectorAll('input[required], select[required], textarea[required]');
                
                let isValid = true;
                let firstInvalidField = null;
                
                requiredFields.forEach(field => {
                    if (!field.value.trim()) {
                        isValid = false;
                        field.style.borderColor = 'var(--error-color)';
                        field.style.backgroundColor = 'var(--error-bg)';
                        
                        // Armazena o primeiro campo inválido
                        if (!firstInvalidField) {
                            firstInvalidField = field;
                        }
                        
                        // Adiciona mensagem de erro se não existir
                        let errorMsg = field.nextElementSibling;
                        if (!errorMsg || !errorMsg.classList.contains('error-message')) {
                            errorMsg = document.createElement('div');
                            errorMsg.className = 'error-message';
                            errorMsg.textContent = 'Este campo é obrigatório';
                            field.parentNode.insertBefore(errorMsg, field.nextSibling);
                        }
                    } else {
                        // Remove estilo de erro
                        field.style.borderColor = '';
                        field.style.backgroundColor = '';
                        
                        // Remove mensagem de erro se existir
                        const errorMsg = field.nextElementSibling;
                        if (errorMsg && errorMsg.classList.contains('error-message')) {
                            errorMsg.remove();
                        }
                    }
                });
                
                // Se não for válido, mostra uma mensagem para o usuário
                if (!isValid) {
                    // Em dispositivos móveis, rola suavemente até o primeiro campo inválido
                    if (window.innerWidth < 768 && firstInvalidField) {
                        setTimeout(() => {
                            firstInvalidField.scrollIntoView({ 
                                behavior: 'smooth', 
                                block: 'center'
                            });
                            firstInvalidField.focus();
                        }, 100);
                    } else if (firstInvalidField) {
                        firstInvalidField.focus();
                    }
                    
                    alert('Por favor, preencha todos os campos obrigatórios antes de continuar.');
                }
                
                return isValid;
            }
            
            // Função para validar caracteres especiais
            function validateSpecialChars(input) {
                // Remove mensagem de erro existente
                const errorMsgId = 'special-char-error-' + input.id;
                let existingError = document.getElementById(errorMsgId);
                if (existingError) {
                    existingError.remove();
                }
                
                // Resetar classe de erro
                input.classList.remove('special-char-error');

                // Se o campo estiver vazio, retorna sem validar
                if (!input.value.trim()) {
                    return true;
                }
                
                let regex;
                let errorMessage = 'Caracteres especiais não permitidos'; // Default error message
                const nameFieldIds = ['input_94', 'input_100', 'input_101', 'input_225', 'input_236', 'input_237'];
                
                // Regex específico para cada tipo de campo
                if (nameFieldIds.includes(input.id)) {
                    // Regex mais restrito para nomes: letras (com acentos), espaços, apóstrofos, hífens
                    regex = /^[a-zA-ZÀ-ÖØ-öø-ÿ\s'-]+$/;
                    errorMessage = 'Nome inválido. Use apenas letras, espaços, apóstrofos ou hífens.';
                } else if (input.id === 'input_95' || input.id === 'input_228') { // CPF e CPF Cônjuge
                    regex = /^[0-9.-]+$/;
                    // A validação de formato/validade do CPF é feita em validateCPF
                } else if (input.id === 'input_98' || input.id === 'input_233') { // Número Documento e Cônjuge
                    regex = /^[0-9a-zA-Z-]+$/;
                    // Regras mais específicas (RG, CNH, Passaporte) são tratadas em applyDocumentNumberRules
                     errorMessage = 'Número do documento inválido.'; // Mensagem genérica, regras específicas tratam formato
                } else if (input.id === 'input_104' || input.id === 'input_106' || input.id === 'input_231' || input.id === 'input_234') { // Datas
                    regex = /^[0-9/]+$/; // Apenas números e barra
                     // A validação de formato/validade é feita em validateAge/validateDate
                } else if (input.id === 'input_108' || input.id === 'input_215') { // CEPs
                    regex = /^[0-9-]+$/;
                    // Validação de busca/formato é feita no listener de CEP
                } else if (input.id === 'input_112' || input.id === 'input_217') { // Número (endereço)
                    regex = /^[0-9a-zA-Z-/ºª\s]+$/; // Permite números, letras, -, /, º, ª e espaços
                     errorMessage = 'Número inválido.';
                } else if (input.id === 'input_97' || input.id === 'input_230') { // Naturalidade
                    regex = /^[a-zA-ZÀ-ÖØ-öø-ÿ\s,-]+$/; // Letras (acentuadas), espaços, vírgula, hífen
                    errorMessage = 'Naturalidade inválida. Use letras, espaços, vírgula ou hífen.';
                } else if (input.id === 'input_99' || input.id === 'input_235') { // Órgão Emissor (se for input de texto)
                    if (input.tagName === 'INPUT') {
                        regex = /^[a-zA-ZÀ-ÖØ-öø-ÿ0-9\s-]+$/; // Letras (acentuadas), números, espaços, hífen
                        errorMessage = 'Órgão Emissor inválido. Use letras, números, espaços ou hífen.';
                    } else {
                        return true; // Não valida select aqui
                    }
                } else if (input.id === 'input_109' || input.id === 'input_216' || // Logradouro
                           input.id === 'input_111' || input.id === 'input_220' || // Bairro
                           input.id === 'input_110' || input.id === 'input_221' || // Cidade
                           input.id === 'input_113' || input.id === 'input_219') {  // Complemento
                    regex = /^[a-zA-ZÀ-ÖØ-öø-ÿ0-9\s.,/()ºª_-]+$/; // Permite mais alguns caracteres comuns em endereços
                    errorMessage = 'Endereço inválido. Verifique os caracteres especiais.';
                } else if (input.id === 'input_117') { // Email
                    // Validação específica em validateEmail
                    return true;
                } else if (input.id === 'input_123') { // Campo de detalhes PPE
                    // Permite um conjunto mais amplo de caracteres para descrição
                    regex = /^[a-zA-ZÀ-ÖØ-öø-ÿ0-9\s.,;!?()/:_-]+$/; // Adicionado ':'
                    errorMessage = 'Descrição inválida. Verifique os caracteres especiais.';
                } else if (input.id === 'input_96' || input.id === 'input_229') { // Nacionalidade
                    regex = /^[a-zA-ZÀ-ÖØ-öø-ÿ\s()/-]+$/; // Letras (acentuadas), espaços, (), /, -
                    errorMessage = 'Nacionalidade inválida. Use letras, espaços, (), / ou -.';
                }
                // Adicione outros 'else if' para campos específicos conforme necessário
                // else {
                //     // Fallback genérico (se necessário, mas idealmente todos os campos de texto são tratados)
                //     regex = /^[a-zA-ZÀ-ÖØ-öø-ÿ0-9\s.,/()_-]+$/;
                // }

                // Aplicar a validação se uma regex foi definida para o campo
                if (regex && !regex.test(input.value)) {
                    // Campo contém caracteres não permitidos
                    input.classList.add('special-char-error');
                    
                    // Adiciona mensagem de erro (usando a mensagem específica definida)
                    const errorMsg = document.createElement('div');
                    errorMsg.id = errorMsgId;
                    errorMsg.className = 'error-message';
                    errorMsg.textContent = errorMessage; // Use a mensagem de erro específica
                    input.parentNode.insertBefore(errorMsg, input.nextSibling);
                    
                    return false;
                } else {
                    // Campo válido (ou sem regex definida para ele)
                    input.classList.remove('special-char-error');
                    return true;
                }
            }
            
            // Aplica validação de caracteres especiais a todos os campos de texto
            const textInputs = document.querySelectorAll('input[type="text"], textarea');
            textInputs.forEach(input => {
                // Ignora campos que não devem ser validados/filtrados aqui
                if (input.id === 'input_118') return; // Campo de telefone tem validação/formatação própria
                if (input.id === 'input_95' || input.id === 'input_228') return; // CPF tem formatação própria
                if (input.id === 'input_108' || input.id === 'input_215') return; // CEP tem formatação própria
                if (input.id === 'input_104' || input.id === 'input_106' || input.id === 'input_231' || input.id === 'input_234') return; // Datas têm formatação própria

                const nameFieldIds = ['input_94', 'input_100', 'input_101', 'input_225', 'input_236', 'input_237'];
                
                input.addEventListener('input', function() {
                    if (nameFieldIds.includes(this.id)) {
                        // Filtragem ativa para campos de nome: remove caracteres inválidos
                        const originalValue = this.value;
                        // Regex para encontrar caracteres que NÃO são letras (com acentos), espaços, apóstrofos ou hífens
                        const sanitizedValue = originalValue.replace(/[^a-zA-ZÀ-ÖØ-öø-ÿ\s'-]/g, '');
                        
                        if (originalValue !== sanitizedValue) {
                            this.value = sanitizedValue;
                            // Pode opcionalmente disparar um feedback visual breve aqui, se desejado
                        }
                        // Após filtrar, ainda podemos validar para mostrar mensagem se necessário (embora deva estar sempre válido)
                         validateSpecialChars(this); 
                    } else {
                         // Para outros campos, apenas valida (não filtra ativamente)
                         validateSpecialChars(this);
                    }
                });
                
                input.addEventListener('blur', function() {
                    // Validação no blur continua a mesma para todos os campos
                    validateSpecialChars(this);
                });
                
                // Validação inicial se o campo já tiver valor
                if (input.value) {
                    validateSpecialChars(input);
                }
            });
            
            // Formatação de CPF
            const cpfInput = document.getElementById('input_95');
            if (cpfInput) {
                // Format CPF as user types
                cpfInput.addEventListener('input', function() {
                    let value = this.value.replace(/\D/g, '');
                    if (value.length > 11) {
                        value = value.substring(0, 11);
                    }
                    
                    if (value.length > 9) {
                        this.value = value.replace(/(\d{3})(\d{3})(\d{3})(\d{1,2})/, '$1.$2.$3-$4');
                    } else if (value.length > 6) {
                        this.value = value.replace(/(\d{3})(\d{3})(\d{1,3})/, '$1.$2.$3');
                    } else if (value.length > 3) {
                        this.value = value.replace(/(\d{3})(\d{1,3})/, '$1.$2');
                    } else {
                        this.value = value;
                    }

                    // Real-time validation as user types
                    validateCPF(this);
                });

                // Validate on blur
                cpfInput.addEventListener('blur', function() {
                    validateCPF(this);
                });

                // Initial validation if field has a value
                if (cpfInput.value) {
                    validateCPF(cpfInput);
                }
            }
            
            // Formatação de Datas
            const dateFields = document.querySelectorAll('#input_104, #input_106, #input_231, #input_234');
            dateFields.forEach(function(field) {
                field.addEventListener('input', function(e) {
                    let value = e.target.value.replace(/\D/g, '');
                    if (value.length > 8) value = value.slice(0, 8);
                    
                    if (value.length > 4) {
                        value = value.replace(/^(\d{2})(\d{2})(\d{0,4})$/, '$1/$2/$3');
                    } else if (value.length > 2) {
                        value = value.replace(/^(\d{2})(\d{0,2})$/, '$1/$2');
                    }
                    
                    e.target.value = value;
                    
                    // Preencher os campos ocultos para o JotForm
                    const fieldId = e.target.id;
                    const parts = value.split('/');
                    if (parts.length === 3 && parts[2].length === 4) {
                        document.getElementById('day_' + fieldId.split('_')[1]).value = parts[0];
                        document.getElementById('month_' + fieldId.split('_')[1]).value = parts[1];
                        document.getElementById('year_' + fieldId.split('_')[1]).value = parts[2];
                    }
                });

                // Adicionar validação no blur para todos os campos de data
                field.addEventListener('blur', function() {
                    if (!this.value.trim()) { // Clear errors if empty
                         const errorMsgId = this.id.includes('Nascimento') ? 'age-error-' + this.id : 'date-error-' + this.id;
                         let existingError = document.getElementById(errorMsgId);
                         if (existingError) existingError.remove();
                         this.style.borderColor = '';
                         this.style.backgroundColor = '';
                         return;
                    }
                    // Chamar a validação apropriada
                    if (this.id === 'input_104' || this.id === 'input_231') {
                        validateAge(this);
                    } else if (this.id === 'input_106' || this.id === 'input_234') {
                        validateDate(this);
                    }
                });
            });
            
            // Formatação de CEP
            const cepFields = document.querySelectorAll('#input_108, #input_215');
            cepFields.forEach(function(cepField) {
                if (cepField) {
                    let lastValue = '';
                    
                    cepField.addEventListener('input', function(e) {
                        let value = this.value.replace(/\D/g, '');
                        if (value.length > 8) value = value.slice(0, 8);
                        
                        if (value.length > 5) {
                            value = value.replace(/^(\d{5})(\d{0,3})$/, '$1-$2');
                        }
                        
                        this.value = value;
                        
                        // Verifica se chegamos a 8 dígitos numéricos pela primeira vez neste evento
                        const numericValue = value.replace(/\D/g, '');
                        if (numericValue.length === 8 && numericValue !== lastValue) {
                            // Guarda o valor para evitar buscas duplicadas
                            lastValue = numericValue;
                            
                            // Pequeno timeout para garantir que a formatação do valor foi aplicada antes da busca
                            setTimeout(() => {
                                buscarCep(numericValue, cepField.id);
                            }, 50);
                        } else if (numericValue.length > 0 && numericValue.length < 8) {
                            // Se o CEP estiver incompleto, mostrar feedback visual
                            this.classList.remove('cep-valido');
                            this.style.borderColor = '';
                            this.style.backgroundColor = '';
                            
                            // Remover mensagem de erro se existir
                            const errorEl = document.getElementById(`${cepField.id}-error-msg`);
                            if (errorEl) errorEl.remove();
                            
                            // Remover mensagem de sucesso se existir
                            const successEl = document.getElementById(`${cepField.id}-success-msg`);
                            if (successEl) successEl.remove();
                            
                            // Resetar o lastValue quando o valor é apagado
                            lastValue = numericValue;
                        }
                    });
                    
                    // Busca também quando o campo perde o foco
                    cepField.addEventListener('blur', function() {
                        const cep = this.value.replace(/\D/g, '');
                        if (cep.length === 8) {
                            buscarCep(cep, cepField.id);
                        }
                    });
                }
            });
            
            // Formatação de Telefone
            const phoneField = document.getElementById('input_118');
            const countrySelect = document.getElementById('country-select');
            const countryDropdown = document.getElementById('country-dropdown');
            const selectedFlag = document.getElementById('selected-flag');
            const selectedCode = document.getElementById('selected-code');

            if (phoneField && countrySelect && countryDropdown) {
                let lastValue = '';
                let selectedCountry = 'BR'; // Brasil como padrão
                let selectedDialCode = '+55'; // Código +55 como padrão
                
                // Lista de países mais comuns
                const countries = [
                    { code: 'BR', name: 'Brasil', dialCode: '+55', flag: 'https://flagcdn.com/br.svg' },
                    { code: 'US', name: 'Estados Unidos', dialCode: '+1', flag: 'https://flagcdn.com/us.svg' },
                    { code: 'PT', name: 'Portugal', dialCode: '+351', flag: 'https://flagcdn.com/pt.svg' },
                    { code: 'ES', name: 'Espanha', dialCode: '+34', flag: 'https://flagcdn.com/es.svg' },
                    { code: 'FR', name: 'França', dialCode: '+33', flag: 'https://flagcdn.com/fr.svg' },
                    { code: 'DE', name: 'Alemanha', dialCode: '+49', flag: 'https://flagcdn.com/de.svg' },
                    { code: 'IT', name: 'Itália', dialCode: '+39', flag: 'https://flagcdn.com/it.svg' },
                    { code: 'UK', name: 'Reino Unido', dialCode: '+44', flag: 'https://flagcdn.com/gb.svg' },
                    { code: 'JP', name: 'Japão', dialCode: '+81', flag: 'https://flagcdn.com/jp.svg' },
                    { code: 'CN', name: 'China', dialCode: '+86', flag: 'https://flagcdn.com/cn.svg' },
                    { code: 'AU', name: 'Austrália', dialCode: '+61', flag: 'https://flagcdn.com/au.svg' },
                    { code: 'CA', name: 'Canadá', dialCode: '+1', flag: 'https://flagcdn.com/ca.svg' },
                    { code: 'AR', name: 'Argentina', dialCode: '+54', flag: 'https://flagcdn.com/ar.svg' },
                    { code: 'CL', name: 'Chile', dialCode: '+56', flag: 'https://flagcdn.com/cl.svg' },
                    { code: 'UY', name: 'Uruguai', dialCode: '+598', flag: 'https://flagcdn.com/uy.svg' },
                    { code: 'PY', name: 'Paraguai', dialCode: '+595', flag: 'https://flagcdn.com/py.svg' },
                    { code: 'CO', name: 'Colômbia', dialCode: '+57', flag: 'https://flagcdn.com/co.svg' },
                    { code: 'PE', name: 'Peru', dialCode: '+51', flag: 'https://flagcdn.com/pe.svg' },
                    { code: 'MX', name: 'México', dialCode: '+52', flag: 'https://flagcdn.com/mx.svg' },
                ];
                
                // Gerar a lista de países no dropdown
                function generateCountryList() {
                    let html = '';
                    
                    countries.forEach(country => {
                        const isSelected = country.code === selectedCountry;
                        html += `
                            <div class="country-item ${isSelected ? 'selected' : ''}" data-code="${country.code}" data-dial="${country.dialCode}">
                                <img src="${country.flag}" alt="${country.name}">
                                <span class="country-name">${country.name}</span>
                                <span class="country-dial-code">${country.dialCode}</span>
                            </div>
                        `;
                    });
                    
                    countryDropdown.innerHTML = html;
                    
                    // Adicionar event listeners aos itens do dropdown
                    document.querySelectorAll('.country-item').forEach(item => {
                        item.addEventListener('click', function() {
                            const countryCode = this.getAttribute('data-code');
                            const dialCode = this.getAttribute('data-dial');
                            
                            // Atualizar o país selecionado
                            selectedCountry = countryCode;
                            selectedDialCode = dialCode;
                            
                            // Atualizar a interface
                            const selectedCountryData = countries.find(c => c.code === countryCode);
                            selectedFlag.src = selectedCountryData.flag;
                            selectedFlag.alt = selectedCountryData.name;
                            selectedCode.textContent = selectedDialCode;
                            
                            // Atualizar o campo oculto do código do país
                            document.getElementById('input_118_country_code').value = selectedDialCode;
                            
                            // Atualizar a formatação do número de telefone
                            updatePhoneFormat();
                            
                            // Fechar o dropdown
                            countryDropdown.classList.remove('active');
                        });
                    });
                }
                
                // Abrir/fechar o dropdown ao clicar no seletor
                countrySelect.addEventListener('click', function(e) {
                    e.stopPropagation(); // Prevenir propagação do clique
                    countryDropdown.classList.toggle('active');
                    
                    // Scroll para o item selecionado
                    if (countryDropdown.classList.contains('active')) {
                        const selectedItem = countryDropdown.querySelector('.country-item.selected');
                        if (selectedItem) {
                            selectedItem.scrollIntoView({ block: 'nearest', behavior: 'smooth' });
                        }
                    }
                });
                
                // Fechar dropdown ao clicar fora
                document.addEventListener('click', function(e) {
                    if (!countrySelect.contains(e.target) && !countryDropdown.contains(e.target)) {
                        countryDropdown.classList.remove('active');
                    }
                });
                
                // Atualizar a formatação do número de telefone
                function updatePhoneFormat() {
                    if (selectedCountry === 'BR') {
                        // Formato brasileiro: (XX) XXXXX-XXXX ou (XX) XXXX-XXXX
                        phoneField.placeholder = '(00) 00000-0000';
                        
                        // Reformatar o número existente se necessário
                        if (phoneField.value) {
                            const numericValue = phoneField.value.replace(/\D/g, '');
                            
                            if (numericValue.length > 10) {
                                // Celular: (XX) 9XXXX-XXXX
                                phoneField.value = numericValue.replace(/^(\d{2})(\d{5})(\d{0,4})$/, '($1) $2-$3');
                            } else if (numericValue.length > 6) {
                                // Fixo: (XX) XXXX-XXXX
                                phoneField.value = numericValue.replace(/^(\d{2})(\d{4})(\d{0,4})$/, '($1) $2-$3');
                            } else if (numericValue.length > 2) {
                                // Formatação parcial
                                phoneField.value = numericValue.replace(/^(\d{2})(\d{0,5})$/, '($1) $2');
                            }
                        }
                    } else {
                        // Formato internacional (sem formatação específica)
                        phoneField.placeholder = 'Digite o número';
                    }

                    // Atualizar o campo oculto do código do país
                    document.getElementById('input_118_country_code').value = selectedDialCode;

                    // Revalidar o telefone com o novo formato
                    validatePhone(phoneField);
                }
                
                // Função para atualizar o campo de telefone completo (código + número)
                function updateFullPhoneField() {
                    // Removida porque não é mais necessária - agora usamos o campo diretamente
                }
                
                // Formatar o telefone à medida que o usuário digita
                phoneField.addEventListener('input', function() {
                    let value = this.value.replace(/\D/g, '');
                    
                    // Aplicar formato adequado com base no país
                    if (selectedCountry === 'BR') {
                        if (value.length > 11) value = value.slice(0, 11);
                        
                        if (value.length > 6) {
                            // Verifica se é celular (11 dígitos) ou fixo (10 dígitos)
                            if (value.length > 10) {
                                // Celular: (XX) 9XXXX-XXXX
                                value = value.replace(/^(\d{2})(\d{5})(\d{0,4})$/, '($1) $2-$3');
                            } else {
                                // Fixo: (XX) XXXX-XXXX
                                value = value.replace(/^(\d{2})(\d{4})(\d{0,4})$/, '($1) $2-$3');
                            }
                        } else if (value.length > 2) {
                            // Formatação parcial
                            value = value.replace(/^(\d{2})(\d{0,5})$/, '($1) $2');
                        }
                    } else {
                        // Limitar a 15 dígitos para números internacionais
                        if (value.length > 15) value = value.slice(0, 15);
                        
                        // Sem formatação especial para números internacionais
                    }
                    
                    this.value = value;
                    
                    // Verificar se o valor foi alterado desde a última validação
                    if (value.replace(/\D/g, '') !== lastValue) {
                        lastValue = value.replace(/\D/g, '');
                        
                        // Pequeno timeout para garantir que a formatação foi aplicada
                        setTimeout(() => {
                            validatePhone(this);
                        }, 50);
                    }
                });
                
                // Validação ao perder o foco
                phoneField.addEventListener('blur', function() {
                    validatePhone(this);
                });
                
                // Função para validar telefone com base no país selecionado
                function validatePhone(input) {
                    const errorMsgId = 'phone-error-msg';
                    let existingError = document.getElementById(errorMsgId);
                    let existingSuccess = document.getElementById('phone-success-msg');
                    
                    // Remove mensagens existentes
                    if (existingError) existingError.remove();
                    if (existingSuccess) existingSuccess.remove();
                    
                    // Remove estilos de validação
                    input.classList.remove('phone-valid');
                    input.style.borderColor = '';
                    input.style.backgroundColor = '';
                    
                    // Se vazio, não faz nada
                    if (!input.value.trim()) return;
                    
                    const numericValue = input.value.replace(/\D/g, '');
                    
                    // Validação específica para cada país
                    if (selectedCountry === 'BR') {
                        // Número brasileiro
                        if (numericValue.length < 10) {
                            showError(input, 'Telefone incompleto', errorMsgId);
                            return false;
                        }
                        
                        // Verifica se o DDD é válido
                        const ddd = numericValue.substring(0, 2);
                        const validDDDs = ['11', '12', '13', '14', '15', '16', '17', '18', '19', '21', '22', '24', '27', '28', '31', '32', '33', '34', '35', '37', '38', '41', '42', '43', '44', '45', '46', '47', '48', '49', '51', '53', '54', '55', '61', '62', '63', '64', '65', '66', '67', '68', '69', '71', '73', '74', '75', '77', '79', '81', '82', '83', '84', '85', '86', '87', '88', '89', '91', '92', '93', '94', '95', '96', '97', '98', '99'];
                        
                        if (!validDDDs.includes(ddd)) {
                            showError(input, 'DDD inválido', errorMsgId);
                            return false;
                        }
                        
                        // Se for celular (11 dígitos), verifica se o primeiro dígito é 9
                        if (numericValue.length === 11 && numericValue.charAt(2) !== '9') {
                            showError(input, 'Celular deve começar com 9 após o DDD', errorMsgId);
                            return false;
                        }
                        
                        // Telefone válido
                        input.classList.add('phone-valid');
                        input.style.borderColor = 'var(--secondary-color)';
                        
                        // Dá feedback sobre o tipo de telefone
                        const phoneType = numericValue.length === 11 ? 'Celular' : 'Telefone fixo';
                        const successMsg = document.createElement('div');
                        successMsg.id = 'phone-success-msg';
                        successMsg.className = 'form-hint';
                        successMsg.textContent = `${phoneType} válido`;
                        successMsg.style.color = 'var(--secondary-color)';
                        input.parentNode.parentNode.appendChild(successMsg);
                        
                        return true;
                    } else {
                        // Validação genérica para número internacional
                        if (numericValue.length < 6) {
                            showError(input, 'Número internacional muito curto', errorMsgId);
                            return false;
                        }
                        
                        // Número internacional válido
                        input.classList.add('phone-valid');
                        input.style.borderColor = 'var(--secondary-color)';
                        
                        const successMsg = document.createElement('div');
                        successMsg.id = 'phone-success-msg';
                        successMsg.className = 'form-hint';
                        successMsg.textContent = 'Número internacional válido';
                        successMsg.style.color = 'var(--secondary-color)';
                        input.parentNode.parentNode.appendChild(successMsg);
                        
                        return true;
                    }
                }
                
                // Inicializar o componente
                generateCountryList();
                
                // Definir os valores iniciais para os campos ocultos
                document.getElementById('input_118_country_code').value = selectedDialCode;
                
                // Configurar a formatação do telefone
                updatePhoneFormat();
                
                // Verificar valor inicial se existir
                if (phoneField.value) {
                    validatePhone(phoneField);
                }
            }
            
            // Validação de e-mail
            const emailField = document.getElementById('input_117');
            if (emailField) {
                emailField.addEventListener('input', function() {
                    // Código de teste para validação
                    console.log('Validando email:', this.value);
                    const isValid = validateEmail(this);
                    console.log('Email válido:', isValid);
                });
                
                emailField.addEventListener('blur', function() {
                    validateEmail(this);
                });
                
                // Validação inicial se o campo já tiver um valor
                if (emailField.value) {
                    validateEmail(emailField);
                }
            }
            
            // Função para validar e-mail
            function validateEmail(input) {
                const errorMsgId = 'email-error-msg';
                let existingError = document.getElementById(errorMsgId);
                
                // Remove mensagem de erro existente
                if (existingError) {
                    existingError.remove();
                }
                
                // Se vazio, retorna para o estilo padrão
                if (!input.value.trim()) {
                    input.style.borderColor = '';
                    input.style.backgroundColor = '';
                    return;
                }
                
                // Usando a biblioteca email-validator
                if (!EmailValidator.validate(input.value)) {
                    showError(input, 'Por favor, insira um e-mail válido.', errorMsgId);
                    return false;
                }
                
                // E-mail é válido
                input.style.borderColor = 'var(--secondary-color)';
                input.style.backgroundColor = '';
                return true;
            }
            
            // Função para validar idade mínima (18 anos)
            function validateAge(input) {
                const birthDateStr = input.value;
                const errorMsgId = 'age-error-' + input.id; // Unique error ID per input
                let existingError = document.getElementById(errorMsgId);

                // Remove mensagem de erro existente
                if (existingError) {
                    existingError.remove();
                }
                input.style.borderColor = ''; // Reset border color
                input.style.backgroundColor = ''; // Reset background color

                if (!birthDateStr.trim()) return true; // Don't validate if empty

                const parts = birthDateStr.split('/');
                if (parts.length !== 3 || parts[0].length !== 2 || parts[1].length !== 2 || parts[2].length !== 4) {
                     showError(input, 'Formato inválido. Use DD/MM/AAAA.', errorMsgId);
                     return false; // Invalid format
                }

                const day = parseInt(parts[0], 10);
                const month = parseInt(parts[1], 10) - 1; // Month is 0-indexed
                const year = parseInt(parts[2], 10);

                // Check for reasonable year range and calendar validity
                if (year < 1900 || year > new Date().getFullYear() + 1 || isNaN(day) || isNaN(month) || isNaN(year)) {
                     showError(input, 'Data inválida (ano ou formato).', errorMsgId);
                     return false;
                }

                const birthDate = new Date(year, month, day);
                const today = new Date();
                 today.setHours(0, 0, 0, 0); // Compare dates only

                // Check if the generated date matches the input (e.g., 31/02 is invalid)
                if (birthDate.getFullYear() !== year || birthDate.getMonth() !== month || birthDate.getDate() !== day) {
                     showError(input, 'Data inválida (dia/mês).', errorMsgId);
                     return false;
                 }

                 // Check if date is in the future
                 if (birthDate > today) {
                     showError(input, 'Data não pode ser no futuro.', errorMsgId);
                     return false;
                 }

                let age = today.getFullYear() - birthDate.getFullYear();
                const monthDiff = today.getMonth() - birthDate.getMonth();

                if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
                    age--;
                }

                if (age < 18) {
                     showError(input, 'Você deve ter pelo menos 18 anos.', errorMsgId);
                     return false;
                }

                // Date is valid and age is sufficient
                input.style.borderColor = 'var(--secondary-color)';
                return true;
            }

             // Função para validar datas genéricas (como expedição)
             function validateDate(input) {
                 const dateStr = input.value;
                 const errorMsgId = 'date-error-' + input.id; // Unique error ID
                 let existingError = document.getElementById(errorMsgId);

                 // Remove mensagem de erro existente
                 if (existingError) {
                     existingError.remove();
                 }
                 input.style.borderColor = ''; // Reset border color
                 input.style.backgroundColor = ''; // Reset background color

                 if (!dateStr.trim()) return true; // Don't validate if empty

                 const parts = dateStr.split('/');
                 if (parts.length !== 3 || parts[0].length !== 2 || parts[1].length !== 2 || parts[2].length !== 4) {
                     showError(input, 'Formato inválido. Use DD/MM/AAAA.', errorMsgId);
                     return false; // Invalid format
                 }

                 const day = parseInt(parts[0], 10);
                 const month = parseInt(parts[1], 10) - 1; // Month is 0-indexed
                 const year = parseInt(parts[2], 10);

                 // Check for reasonable year range and calendar validity
                 if (year < 1950 || year > new Date().getFullYear() + 1 || isNaN(day) || isNaN(month) || isNaN(year)) { // Min year 1950 for expedition
                      showError(input, 'Data inválida (ano ou formato).', errorMsgId);
                      return false;
                 }

                 const dateValue = new Date(year, month, day);
                 const today = new Date();
                 today.setHours(0, 0, 0, 0); // Compare dates only

                 // Check if the generated date matches the input (e.g., 31/02 is invalid)
                 if (dateValue.getFullYear() !== year || dateValue.getMonth() !== month || dateValue.getDate() !== day) {
                      showError(input, 'Data inválida (dia/mês).', errorMsgId);
                      return false;
                  }

                  // Check if date is in the future
                  if (dateValue > today) {
                      showError(input, 'Data não pode ser no futuro.', errorMsgId);
                      return false;
                  }

                 // Date is valid
                 input.style.borderColor = 'var(--secondary-color)';
                 return true;
             }

            // CPF validation function
            function validateCPF(input) {
                const errorMsgId = 'cpf-error-msg';
                let existingError = document.getElementById(errorMsgId);
                
                // Remove existing error message
                if (existingError) {
                    existingError.remove();
                }
                
                // If empty, reset to default style and return
                if (!input.value.trim()) {
                    input.style.borderColor = '';
                    input.style.backgroundColor = '';
                    return;
                }
                
                // Extract only numbers
                const cpf = input.value.replace(/\D/g, '');
                
                // Check if CPF has 11 digits
                if (cpf.length !== 11) {
                    showError(input, 'CPF deve conter 11 dígitos.', errorMsgId);
                    return false;
                }
                
                // Check if all digits are the same
                if (/^(\d)\1{10}$/.test(cpf)) {
                    showError(input, 'CPF inválido: todos os dígitos são iguais.', errorMsgId);
                    return false;
                }
                
                // Calculate first verification digit
                let sum = 0;
                for (let i = 0; i < 9; i++) {
                    sum += parseInt(cpf.charAt(i)) * (10 - i);
                }
                let remainder = sum % 11;
                let digit1 = remainder < 2 ? 0 : 11 - remainder;
                
                // Calculate second verification digit
                sum = 0;
                for (let i = 0; i < 10; i++) {
                    sum += parseInt(cpf.charAt(i)) * (11 - i);
                }
                remainder = sum % 11;
                let digit2 = remainder < 2 ? 0 : 11 - remainder;
                
                // Check if calculated digits match the provided ones
                if (parseInt(cpf.charAt(9)) !== digit1 || parseInt(cpf.charAt(10)) !== digit2) {
                    showError(input, 'CPF inválido.', errorMsgId);
                    return false;
                }
                
                // CPF is valid
                input.style.borderColor = 'var(--secondary-color)';
                input.style.backgroundColor = '';
                return true;
            }
            
            // Helper function to show validation error
            function showError(input, message, errorMsgId) {
                // Não aplicar estilos de erro se o elemento for um CEP válido
                if (input.id === 'input_108' && input.classList.contains('cep-valido')) {
                    return;
                }
                
                input.style.borderColor = 'var(--error-color)';
                input.style.backgroundColor = 'var(--error-bg)';
                
                const errorMsg = document.createElement('div');
                errorMsg.id = errorMsgId;
                errorMsg.className = 'error-message';
                errorMsg.textContent = message;
                errorMsg.style.color = 'var(--error-color)';
                errorMsg.style.fontSize = '0.8rem';
                errorMsg.style.marginTop = '4px';
                
                // Insert error message after the input or its container
                if (input.id === 'input_118') {
                    // Para o campo de telefone, inserir a mensagem após o container do telefone
                    const phoneContainer = input.closest('.phone-input-container');
                    phoneContainer.parentNode.insertBefore(errorMsg, phoneContainer.nextSibling);
                } else {
                    // Para outros campos, inserir a mensagem após o input
                    input.parentNode.insertBefore(errorMsg, input.nextSibling);
                }
            }
            
            // Função para buscar CEP na API ViaCEP
            function buscarCep(cep, cepFieldId) {
                const cepInput = document.getElementById(cepFieldId);
                
                // Determinar os IDs dos campos a serem preenchidos com base no ID do campo CEP
                let logradouroId, bairroId, cidadeId, estadoId;
                
                if (cepFieldId === 'input_108') {
                    // Endereço de Correspondência
                    logradouroId = 'input_109';
                    bairroId = 'input_111';
                    cidadeId = 'input_110';
                    estadoId = 'input_114';
                } else if (cepFieldId === 'input_215') {
                    // Endereço de Residência
                    logradouroId = 'input_216';
                    bairroId = 'input_220';
                    cidadeId = 'input_221';
                    estadoId = 'input_222';
                } else {
                    // ID não reconhecido
                    console.error('Campo CEP não reconhecido:', cepFieldId);
                    return;
                }
                
                // Remove classes anteriores
                cepInput.classList.remove('cep-valido');
                
                // Também remover qualquer estilo de erro que possa ter sido aplicado anteriormente
                cepInput.style.borderColor = '';
                cepInput.style.backgroundColor = '';
                
                // Remove mensagem de erro anterior se existir
                const errorEl = document.getElementById(`${cepFieldId}-error-msg`);
                if (errorEl) errorEl.remove();
                
                // Remove mensagem de sucesso anterior se existir
                const successEl = document.getElementById(`${cepFieldId}-success-msg`);
                if (successEl) successEl.remove();
                
                // Mostra indicador de carregamento
                cepInput.classList.add('loading');
                
                // Adiciona mensagem de busca
                const statusMsg = document.createElement('div');
                statusMsg.id = `${cepFieldId}-status-msg`;
                statusMsg.className = 'form-hint';
                statusMsg.textContent = 'Buscando endereço...';
                cepInput.parentNode.appendChild(statusMsg);
                
                fetch(`https://viacep.com.br/ws/${cep}/json/`)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Erro ao buscar o CEP');
                        }
                        return response.json();
                    })
                    .then(data => {
                        // Remove indicador de carregamento
                        cepInput.classList.remove('loading');
                        
                        // Remove mensagem de status
                        const statusEl = document.getElementById(`${cepFieldId}-status-msg`);
                        if (statusEl) statusEl.remove();
                        
                        // Verifica se a API retornou erro
                        if (data.erro) {
                            showError(cepInput, 'CEP não encontrado', `${cepFieldId}-error-msg`);
                            return;
                        }
                        
                        // Preenche os campos com os dados retornados
                        document.getElementById(logradouroId).value = data.logradouro || '';
                        document.getElementById(bairroId).value = data.bairro || '';
                        document.getElementById(cidadeId).value = data.localidade || '';
                        
                        // Seleciona o estado no dropdown
                        const estadoSelect = document.getElementById(estadoId);
                        for (let i = 0; i < estadoSelect.options.length; i++) {
                            if (estadoSelect.options[i].value === data.uf) {
                                estadoSelect.selectedIndex = i;
                                break;
                            }
                        }
                        
                        // Adiciona estilo visual de CEP válido
                        cepInput.classList.add('cep-valido');
                        cepInput.style.borderColor = 'var(--secondary-color)';
                        
                        // Adiciona mensagem de sucesso
                        const successMsg = document.createElement('div');
                        successMsg.id = `${cepFieldId}-success-msg`;
                        successMsg.className = 'form-hint';
                        successMsg.textContent = 'CEP válido! Endereço encontrado.';
                        successMsg.style.color = 'var(--secondary-color)';
                        cepInput.parentNode.appendChild(successMsg);
                        
                        // Foca no campo de número após preencher o endereço
                        if (cepFieldId === 'input_108') {
                            document.getElementById('input_112').focus();
                        } else if (cepFieldId === 'input_215') {
                            document.getElementById('input_217').focus();
                        }
                    })
                    .catch(error => {
                        // Remove indicador de carregamento
                        cepInput.classList.remove('loading');
                        
                        // Remove mensagem de status
                        const statusEl = document.getElementById(`${cepFieldId}-status-msg`);
                        if (statusEl) statusEl.remove();
                        
                        // Mostra mensagem de erro
                        showError(cepInput, 'Erro ao buscar o CEP', `${cepFieldId}-error-msg`);
                        console.error('Erro:', error);
                    });
            }
            
            // Validar o formulário antes do envio
            document.getElementById('cadastro-form').addEventListener('submit', function(e) {
                // Impedir o envio padrão inicialmente
                e.preventDefault();

                let isFormValid = true; // Flag to track overall validity
                let firstInvalidField = null; // To focus on the first error

                // --- Validações Individuais ---

                // Validação de idade (usuário)
                const dataNascimentoInput = document.getElementById('input_104');
                if (!validateAge(dataNascimentoInput)) {
                    isFormValid = false;
                    if (!firstInvalidField) firstInvalidField = dataNascimentoInput;
                }

                // Validação de CPF (usuário)
                const cpfInput = document.getElementById('input_95');
                if (!validateCPF(cpfInput)) {
                    isFormValid = false;
                    if (!firstInvalidField) firstInvalidField = cpfInput;
                }

                // Validação de e-mail (usuário)
                const emailInput = document.getElementById('input_117');
                if (!validateEmail(emailInput)) {
                    isFormValid = false;
                    if (!firstInvalidField) firstInvalidField = emailInput;
                }

                 // Validação de Data de Expedição (usuário)
                 const dataExpedicaoInput = document.getElementById('input_106');
                 if (dataExpedicaoInput.required && !validateDate(dataExpedicaoInput)) {
                     isFormValid = false;
                     if (!firstInvalidField) firstInvalidField = dataExpedicaoInput;
                 }

                // Validação de caracteres especiais em todos os campos de texto
                const textInputs = document.querySelectorAll('input[type="text"], textarea');
                textInputs.forEach(input => {
                    // Ignora campos que têm validação própria
                    if (input.id === 'input_118') return;
                    
                    // Valida o campo
                    if (!validateSpecialChars(input)) {
                        isFormValid = false;
                        if (!firstInvalidField) firstInvalidField = input;
                    }
                });

                // Se encontrou erros de caracteres especiais
                if (!isFormValid) {
                    // Em dispositivos móveis, rola suavemente até o primeiro campo inválido
                    if (window.innerWidth < 768 && firstInvalidField) {
                        setTimeout(() => {
                            firstInvalidField.scrollIntoView({ 
                                behavior: 'smooth', 
                                block: 'center'
                            });
                            firstInvalidField.focus();
                        }, 100);
                    } else if (firstInvalidField) {
                        firstInvalidField.focus();
                    }
                    
                    alert('Por favor, remova os caracteres especiais dos campos destacados.');
                    return false;
                }

                // Garantir que os campos ocultos de data estejam preenchidos
                const dateFields = document.querySelectorAll('#input_104, #input_106, #input_231, #input_234');
                dateFields.forEach(function(field) {
                    const fieldId = field.id;
                    const parts = field.value.split('/');
                    if (parts.length === 3) {
                        document.getElementById('day_' + fieldId.split('_')[1]).value = parts[0];
                        document.getElementById('month_' + fieldId.split('_')[1]).value = parts[1];
                        document.getElementById('year_' + fieldId.split('_')[1]).value = parts[2];
                    }
                });

                // Para garantir que todos os campos sejam enviados
                this.submit();
            });

            // Função para sugerir naturalidade (cidade e estado) conforme o usuário digita
            const naturalidadeInput = document.getElementById('input_97');
            if (naturalidadeInput) {
                // Cria o contêiner de sugestões
                const suggestionsContainer = document.createElement('div');
                suggestionsContainer.className = 'suggestions-container';
                suggestionsContainer.style.display = 'none';
                suggestionsContainer.style.position = 'absolute';
                suggestionsContainer.style.zIndex = '1000';
                suggestionsContainer.style.backgroundColor = '#fff';
                suggestionsContainer.style.width = 'calc(100% - 2px)';
                suggestionsContainer.style.maxHeight = '200px';
                suggestionsContainer.style.overflowY = 'auto';
                suggestionsContainer.style.border = '1px solid var(--input-border)';
                suggestionsContainer.style.borderTop = 'none';
                suggestionsContainer.style.borderRadius = '0 0 6px 6px';
                suggestionsContainer.style.boxShadow = '0 4px 8px rgba(0, 0, 0, 0.1)';
                
                // Coloca o contêiner após o input
                naturalidadeInput.parentNode.style.position = 'relative';
                naturalidadeInput.parentNode.appendChild(suggestionsContainer);
                
                // Cache para evitar consultas repetidas
                const citiesCache = {};
                let debounceTimer;
                
                // Adiciona evento de input ao campo de naturalidade
                naturalidadeInput.addEventListener('input', function() {
                    const query = this.value.trim();
                    
                    // Limpa o timer anterior
                    clearTimeout(debounceTimer);
                    
                    // Oculta sugestões se o input estiver vazio
                    if (query.length < 3) {
                        suggestionsContainer.style.display = 'none';
                        return;
                    }
                    
                    // Define um novo timer para evitar consultas excessivas
                    debounceTimer = setTimeout(function() {
                        if (citiesCache[query]) {
                            // Usa o cache se a consulta já foi feita antes
                            displaySuggestions(citiesCache[query]);
                        } else {
                            // Adiciona classe de carregamento
                            naturalidadeInput.classList.add('loading');
                            
                            // Consome a API do IBGE para buscar municípios
                            fetch(`https://servicodados.ibge.gov.br/api/v1/localidades/municipios?orderBy=nome`)
                                .then(response => response.json())
                                .then(data => {
                                    // Filtra municípios que contenham o texto digitado
                                    const filteredCities = data.filter(city => {
                                        const cityName = city.nome.toLowerCase();
                                        const stateAbbr = city.microrregiao.mesorregiao.UF.sigla;
                                        const searchStr = `${cityName} - ${stateAbbr}`.toLowerCase();
                                        return searchStr.includes(query.toLowerCase());
                                    }).slice(0, 10); // Limita a 10 resultados
                                    
                                    // Armazena no cache
                                    citiesCache[query] = filteredCities;
                                    
                                    // Exibe as sugestões
                                    displaySuggestions(filteredCities);
                                    
                                    // Remove classe de carregamento
                                    naturalidadeInput.classList.remove('loading');
                                })
                                .catch(error => {
                                    console.error('Erro ao buscar cidades:', error);
                                    naturalidadeInput.classList.remove('loading');
                                });
                        }
                    }, 300); // Tempo de espera para evitar consultas em cada tecla
                });
                
                // Função para exibir as sugestões
                function displaySuggestions(cities) {
                    // Limpa o contêiner de sugestões
                    suggestionsContainer.innerHTML = '';
                    
                    if (cities.length === 0) {
                        suggestionsContainer.style.display = 'none';
                        return;
                    }
                    
                    // Cria um item para cada cidade
                    cities.forEach(city => {
                        const item = document.createElement('div');
                        item.className = 'suggestion-item';
                        item.textContent = `${city.nome} - ${city.microrregiao.mesorregiao.UF.sigla}`;
                        item.style.padding = '10px 12px';
                        item.style.cursor = 'pointer';
                        item.style.borderBottom = '1px solid var(--divider-color)';
                        
                        // Adiciona efeito hover
                        item.addEventListener('mouseover', function() {
                            this.style.backgroundColor = 'var(--background-color)';
                        });
                        
                        item.addEventListener('mouseout', function() {
                            this.style.backgroundColor = 'transparent';
                        });
                        
                        // Adiciona evento de clique para selecionar a cidade
                        item.addEventListener('click', function() {
                            naturalidadeInput.value = this.textContent;
                            suggestionsContainer.style.display = 'none';
                        });
                        
                        suggestionsContainer.appendChild(item);
                    });
                    
                    // Exibe o contêiner de sugestões
                    suggestionsContainer.style.display = 'block';
                }
                
                // Fecha as sugestões ao clicar fora do campo
                document.addEventListener('click', function(e) {
                    if (e.target !== naturalidadeInput && e.target !== suggestionsContainer) {
                        suggestionsContainer.style.display = 'none';
                    }
                });
                
                // Navegação por teclado nas sugestões
                naturalidadeInput.addEventListener('keydown', function(e) {
                    const items = suggestionsContainer.querySelectorAll('.suggestion-item');
                    if (!items.length) return;
                    
                    const activeItem = suggestionsContainer.querySelector('.suggestion-item.active');
                    
                    // Tecla para baixo
                    if (e.key === 'ArrowDown') {
                        e.preventDefault();
                        if (!activeItem) {
                            items[0].classList.add('active');
                            items[0].style.backgroundColor = 'var(--background-color)';
                        } else {
                            const index = Array.from(items).indexOf(activeItem);
                            if (index < items.length - 1) {
                                activeItem.classList.remove('active');
                                activeItem.style.backgroundColor = 'transparent';
                                items[index + 1].classList.add('active');
                                items[index + 1].style.backgroundColor = 'var(--background-color)';
                                
                                // Scroll se necessário
                                if (items[index + 1].offsetTop >= suggestionsContainer.scrollTop + suggestionsContainer.offsetHeight) {
                                    suggestionsContainer.scrollTop = items[index + 1].offsetTop - suggestionsContainer.offsetHeight + items[index + 1].offsetHeight;
                                }
                            }
                        }
                    }
                    
                    // Tecla para cima
                    else if (e.key === 'ArrowUp') {
                        e.preventDefault();
                        if (activeItem) {
                            const index = Array.from(items).indexOf(activeItem);
                            if (index > 0) {
                                activeItem.classList.remove('active');
                                activeItem.style.backgroundColor = 'transparent';
                                items[index - 1].classList.add('active');
                                items[index - 1].style.backgroundColor = 'var(--background-color)';
                                
                                // Scroll se necessário
                                if (items[index - 1].offsetTop < suggestionsContainer.scrollTop) {
                                    suggestionsContainer.scrollTop = items[index - 1].offsetTop;
                                }
                            }
                        }
                    }
                    
                    // Tecla Enter
                    else if (e.key === 'Enter' && activeItem) {
                        e.preventDefault();
                        naturalidadeInput.value = activeItem.textContent;
                        suggestionsContainer.style.display = 'none';
                    }
                    
                    // Tecla Escape
                    else if (e.key === 'Escape') {
                        suggestionsContainer.style.display = 'none';
                    }
                });
            }
            
            // Melhoria condicional para o campo orgaoEmissor baseado no tipoDocumento
            const tipoDocumentoSelect = document.getElementById('input_105');
            
            if (tipoDocumentoSelect) {
                // Função para atualizar o campo de órgão emissor
                function atualizarCampoOrgaoEmissor() {
                    // Sempre obter a referência atual do campo
                    const orgaoEmissorField = document.getElementById('input_99');
                    if (!orgaoEmissorField) return;
                    
                    const tipoDoc = tipoDocumentoSelect.value;
                    // Guardar o valor atual antes de substituir o campo
                    const currentValue = orgaoEmissorField.value;
                    
                    // Guardar o elemento pai para readicionar o campo
                    const parent = orgaoEmissorField.parentNode;
                    
                    // Remove o campo atual
                    orgaoEmissorField.remove();
                    
                    let newField;
                    
                    if (tipoDoc === 'RG') {
                        // Transformar em um select para RG
                        newField = document.createElement('select');
                        newField.id = 'input_99';
                        newField.name = 'q99_orgaoEmissor';
                        newField.className = 'form-control';
                        newField.required = true;
                        
                        // Adicionar opções para órgãos emissores de RG
                        const options = [
                            {value: '', text: 'Selecione o órgão emissor'},
                            {value: 'SSP-AC', text: 'SSP-AC'}, {value: 'SSP-AL', text: 'SSP-AL'}, 
                            {value: 'SSP-AP', text: 'SSP-AP'}, {value: 'SSP-AM', text: 'SSP-AM'}, 
                            {value: 'SSP-BA', text: 'SSP-BA'}, {value: 'SSP-CE', text: 'SSP-CE'},
                            {value: 'SSP-DF', text: 'SSP-DF'}, {value: 'SSP-ES', text: 'SSP-ES'}, 
                            {value: 'SSP-GO', text: 'SSP-GO'}, {value: 'SSP-MA', text: 'SSP-MA'}, 
                            {value: 'SSP-MT', text: 'SSP-MT'}, {value: 'SSP-MS', text: 'SSP-MS'},
                            {value: 'SSP-MG', text: 'SSP-MG'}, {value: 'SSP-PA', text: 'SSP-PA'}, 
                            {value: 'SSP-PB', text: 'SSP-PB'}, {value: 'SSP-PR', text: 'SSP-PR'}, 
                            {value: 'SSP-PE', text: 'SSP-PE'}, {value: 'SSP-PI', text: 'SSP-PI'},
                            {value: 'SSP-RJ', text: 'SSP-RJ'}, {value: 'SSP-RN', text: 'SSP-RN'}, 
                            {value: 'SSP-RS', text: 'SSP-RS'}, {value: 'SSP-RO', text: 'SSP-RO'}, 
                            {value: 'SSP-RR', text: 'SSP-RR'}, {value: 'SSP-SC', text: 'SSP-SC'},
                            {value: 'SSP-SP', text: 'SSP-SP'}, {value: 'SSP-SE', text: 'SSP-SE'}, 
                            {value: 'SSP-TO', text: 'SSP-TO'},
                            {value: 'PC-AC', text: 'PC-AC'}, {value: 'PC-AL', text: 'PC-AL'}, 
                            {value: 'PC-AP', text: 'PC-AP'}, {value: 'PC-AM', text: 'PC-AM'}, 
                            {value: 'PC-BA', text: 'PC-BA'}, {value: 'PC-CE', text: 'PC-CE'},
                            {value: 'PC-DF', text: 'PC-DF'}, {value: 'PC-ES', text: 'PC-ES'}, 
                            {value: 'PC-GO', text: 'PC-GO'}, {value: 'PC-MA', text: 'PC-MA'}, 
                            {value: 'PC-MT', text: 'PC-MT'}, {value: 'PC-MS', text: 'PC-MS'},
                            {value: 'PC-MG', text: 'PC-MG'}, {value: 'PC-PA', text: 'PC-PA'}, 
                            {value: 'PC-PB', text: 'PC-PB'}, {value: 'PC-PR', text: 'PC-PR'}, 
                            {value: 'PC-PE', text: 'PC-PE'}, {value: 'PC-PI', text: 'PC-PI'},
                            {value: 'PC-RJ', text: 'PC-RJ'}, {value: 'PC-RN', text: 'PC-RN'}, 
                            {value: 'PC-RS', text: 'PC-RS'}, {value: 'PC-RO', text: 'PC-RO'}, 
                            {value: 'PC-RR', text: 'PC-RR'}, {value: 'PC-SC', text: 'PC-SC'},
                            {value: 'PC-SP', text: 'PC-SP'}, {value: 'PC-SE', text: 'PC-SE'}, 
                            {value: 'PC-TO', text: 'PC-TO'},
                            {value: 'DPF', text: 'DPF - Polícia Federal'},
                            {value: 'MAE', text: 'MAE - Ministério da Aeronáutica'},
                            {value: 'MEX', text: 'MEX - Ministério do Exército'},
                            {value: 'MMA', text: 'MMA - Ministério da Marinha'},
                            {value: 'OUTRO', text: 'Outro'}
                        ];
                        
                        options.forEach(opt => {
                            const option = document.createElement('option');
                            option.value = opt.value;
                            option.textContent = opt.text;
                            newField.appendChild(option);
                        });
                        
                    } else if (tipoDoc === 'CNH') {
                        // Transformar em um select para CNH
                        newField = document.createElement('select');
                        newField.id = 'input_99';
                        newField.name = 'q99_orgaoEmissor';
                        newField.className = 'form-control';
                        newField.required = true;
                        
                        // Adicionar opções para DETRAN de cada estado
                        const options = [
                            {value: '', text: 'Selecione o DETRAN'},
                            {value: 'DETRAN-AC', text: 'DETRAN-AC'}, {value: 'DETRAN-AL', text: 'DETRAN-AL'}, 
                            {value: 'DETRAN-AP', text: 'DETRAN-AP'}, {value: 'DETRAN-AM', text: 'DETRAN-AM'}, 
                            {value: 'DETRAN-BA', text: 'DETRAN-BA'}, {value: 'DETRAN-CE', text: 'DETRAN-CE'},
                            {value: 'DETRAN-DF', text: 'DETRAN-DF'}, {value: 'DETRAN-ES', text: 'DETRAN-ES'}, 
                            {value: 'DETRAN-GO', text: 'DETRAN-GO'}, {value: 'DETRAN-MA', text: 'DETRAN-MA'}, 
                            {value: 'DETRAN-MT', text: 'DETRAN-MT'}, {value: 'DETRAN-MS', text: 'DETRAN-MS'},
                            {value: 'DETRAN-MG', text: 'DETRAN-MG'}, {value: 'DETRAN-PA', text: 'DETRAN-PA'}, 
                            {value: 'DETRAN-PB', text: 'DETRAN-PB'}, {value: 'DETRAN-PR', text: 'DETRAN-PR'}, 
                            {value: 'DETRAN-PE', text: 'DETRAN-PE'}, {value: 'DETRAN-PI', text: 'DETRAN-PI'},
                            {value: 'DETRAN-RJ', text: 'DETRAN-RJ'}, {value: 'DETRAN-RN', text: 'DETRAN-RN'}, 
                            {value: 'DETRAN-RS', text: 'DETRAN-RS'}, {value: 'DETRAN-RO', text: 'DETRAN-RO'}, 
                            {value: 'DETRAN-RR', text: 'DETRAN-RR'}, {value: 'DETRAN-SC', text: 'DETRAN-SC'},
                            {value: 'DETRAN-SP', text: 'DETRAN-SP'}, {value: 'DETRAN-SE', text: 'DETRAN-SE'}, 
                            {value: 'DETRAN-TO', text: 'DETRAN-TO'}
                        ];
                        
                        options.forEach(opt => {
                            const option = document.createElement('option');
                            option.value = opt.value;
                            option.textContent = opt.text;
                            newField.appendChild(option);
                        });
                        
                    } else if (tipoDoc === 'Passaporte') {
                        // Campo de texto preenchido com Polícia Federal
                        newField = document.createElement('input');
                        newField.type = 'text';
                        newField.id = 'input_99';
                        newField.name = 'q99_orgaoEmissor';
                        newField.className = 'form-control';
                        newField.value = 'Polícia Federal';
                        newField.readOnly = true;
                        newField.required = true;
                        
                    } else {
                        // Campo de texto padrão para qualquer outro caso
                        newField = document.createElement('input');
                        newField.type = 'text';
                        newField.id = 'input_99';
                        newField.name = 'q99_orgaoEmissor';
                        newField.className = 'form-control';
                        newField.placeholder = 'Digite o órgão emissor';
                        newField.required = true;
                    }
                    
                    // Inserir o novo campo no DOM
                    parent.appendChild(newField);
                    
                    // Gerenciar evento de "outro" se for um select
                    if (newField.nodeName === 'SELECT') {
                        newField.addEventListener('change', function() {
                            if (this.value === 'OUTRO') {
                                // Substituir o select por um campo de texto
                                const textField = document.createElement('input');
                                textField.type = 'text';
                                textField.id = 'input_99';
                                textField.name = 'q99_orgaoEmissor';
                                textField.className = 'form-control';
                                textField.placeholder = 'Digite o órgão emissor';
                                textField.required = true;
                                
                                this.parentNode.replaceChild(textField, this);
                                textField.focus();
                            }
                        });
                    }
                    
                    // Tentar restaurar o valor anterior, se possível
                    if (currentValue && newField.nodeName === 'SELECT') {
                        const options = Array.from(newField.options);
                        const matchingOption = options.find(opt => opt.value === currentValue);
                        if (matchingOption) {
                            newField.value = currentValue;
                        }
                    } else if (newField.type === 'text' && !newField.readOnly) {
                        newField.value = currentValue;
                    }
                }
                
                // Atualizar o campo quando o tipo de documento mudar
                tipoDocumentoSelect.addEventListener('change', atualizarCampoOrgaoEmissor);
                
                // Aplicar imediatamente se já houver um tipo de documento selecionado
                if (tipoDocumentoSelect.value) {
                    atualizarCampoOrgaoEmissor();
                }
            }
            
            // Adicionar regra de validação para o campo telefone
            const visiblePhone = document.getElementById('input_118');
            
            if (visiblePhone) {
                // O campo já tem a configuração correta
            }
            
            // Opção "Mesmo Endereço" para copiar dados de Correspondência para Residência
            const sameAddressCheckbox = document.getElementById('same-address');
            if (sameAddressCheckbox) {
                sameAddressCheckbox.addEventListener('change', function() {
                    // Mapeia os campos correspondentes entre os endereços
                    const fieldMap = [
                        { from: 'input_108', to: 'input_215' }, // CEP
                        { from: 'input_109', to: 'input_216' }, // Logradouro
                        { from: 'input_112', to: 'input_217' }, // Número
                        { from: 'input_113', to: 'input_219' }, // Complemento
                        { from: 'input_111', to: 'input_220' }, // Bairro
                        { from: 'input_110', to: 'input_221' }, // Cidade
                        { from: 'input_114', to: 'input_222' }  // Estado
                    ];
                    
                    if (this.checked) {
                        // Copiar dados do endereço de correspondência para residência
                        fieldMap.forEach(pair => {
                            const sourceField = document.getElementById(pair.from);
                            const targetField = document.getElementById(pair.to);
                            
                            if (sourceField && targetField) {
                                // Para selects, copia o selectedIndex
                                if (sourceField.tagName === 'SELECT') {
                                    targetField.selectedIndex = sourceField.selectedIndex;
                                } else {
                                    // Para inputs, copia o value
                                    targetField.value = sourceField.value;
                                }
                                
                                // Adicionar classe visual para indicar campos preenchidos automaticamente
                                targetField.classList.add('auto-filled');
                                
                                // Desabilitar campos do endereço de residência
                                targetField.disabled = true;
                            }
                        });
                        
                        // Adicionar mensagem informativa
                        const infoMsg = document.createElement('div');
                        infoMsg.id = 'same-address-info';
                        infoMsg.className = 'form-hint';
                        infoMsg.textContent = 'Os campos foram preenchidos automaticamente com o endereço de correspondência.';
                        infoMsg.style.color = 'var(--secondary-color)';
                        infoMsg.style.marginBottom = '15px';
                        sameAddressCheckbox.parentNode.parentNode.appendChild(infoMsg);
                    } else {
                        // Habilitar campos e remover classe visual
                        fieldMap.forEach(pair => {
                            const targetField = document.getElementById(pair.to);
                            if (targetField) {
                                targetField.disabled = false;
                                targetField.classList.remove('auto-filled');
                                targetField.value = ''; // Limpar campos
                            }
                        });
                        
                        // Remover mensagem informativa
                        const infoMsg = document.getElementById('same-address-info');
                        if (infoMsg) infoMsg.remove();
                    }
                });
            }
            
            // Controle dos campos de Dados do Cônjuge baseado no Estado Civil
            const estadoCivilSelect = document.getElementById('input_103');
            if (estadoCivilSelect) {
                // Função para controlar a exibição e obrigatoriedade dos campos do cônjuge
                function atualizarCamposConjuge() {
                    const estadoCivil = estadoCivilSelect.value;
                    const mostrarCamposConjuge = (estadoCivil === 'Casado(a)' || estadoCivil === 'União Estável');
                    
                    // IDs dos campos do cônjuge
                    const camposConjugeIds = [
                        'input_225', 'input_226', 'input_227', 'input_228', 'input_229', 
                        'input_230', 'input_231', 'input_232', 'input_233', 'input_234',
                        'input_235', 'input_236', 'input_237'
                    ];
                    
                    // Obter o container da seção de dados do cônjuge
                    const secaoConjuge = document.querySelector('.form-section-title').parentNode;
                    const containerConjuge = secaoConjuge.parentNode.querySelectorAll('.form-row');
                    
                    // Localizar a seção de dados do cônjuge
                    let conjugeSection = null;
                    let conjugeRows = [];
                    let encontrouSecao = false;
                    
                    // Iterar por todos os form-row para identificar os que pertencem à seção do cônjuge
                    document.querySelectorAll('#tab-1 .form-section-title').forEach(title => {
                        if (title.textContent === 'Dados do Cônjuge' || title.textContent === 'Dados do Cônjuge (Obrigatório)') {
                            conjugeSection = title.parentNode;
                            encontrouSecao = true;
                        }
                    });
                    
                    if (encontrouSecao) {
                        // Encontrar todos os form-rows após a seção de dados do cônjuge
                        let currentElement = conjugeSection;
                        
                        while (currentElement.nextElementSibling && 
                              !currentElement.nextElementSibling.classList.contains('form-section-header') &&
                              !currentElement.nextElementSibling.classList.contains('nav-buttons')) {
                            currentElement = currentElement.nextElementSibling;
                            if (currentElement.classList.contains('form-row')) {
                                conjugeRows.push(currentElement);
                            }
                        }
                        
                        // Também incluir a seção de título
                        conjugeRows.unshift(conjugeSection);
                        
                        // Mostrar ou esconder a seção do cônjuge
                        conjugeRows.forEach(row => {
                            if (mostrarCamposConjuge) {
                                row.style.display = '';
                            } else {
                                row.style.display = 'none';
                            }
                        });
                        
                        // Replicar o estado civil do usuário para o cônjuge
                        if (mostrarCamposConjuge) {
                            const conjugeEstadoCivilSelect = document.getElementById('input_227');
                            if (conjugeEstadoCivilSelect) {
                                // Encontrar a mesma opção no select do cônjuge
                                for (let i = 0; i < conjugeEstadoCivilSelect.options.length; i++) {
                                    if (conjugeEstadoCivilSelect.options[i].value === estadoCivil) {
                                        conjugeEstadoCivilSelect.selectedIndex = i;
                                        break;
                                    }
                                }
                            }
                        }
                        
                        // Tornar os campos obrigatórios ou não
                        camposConjugeIds.forEach(id => {
                            const campo = document.getElementById(id);
                            if (campo) {
                                // Nome do Pai (input_237) não deve ser obrigatório
                                campo.required = mostrarCamposConjuge && id !== 'input_237';
                                
                                // Atualizar o label para incluir ou remover o indicador de obrigatório
                                const label = campo.previousElementSibling;
                                if (label && label.classList.contains('form-label')) {
                                    if (mostrarCamposConjuge && id !== 'input_237') {
                                        label.classList.add('required');
                                    } else {
                                        label.classList.remove('required');
                                    }
                                }
                                
                                // Limpar o valor quando os campos estão ocultos
                                if (!mostrarCamposConjuge) {
                                    campo.value = '';
                                    if (campo.tagName === 'SELECT') {
                                        campo.selectedIndex = 0;
                                    }
                                }
                            }
                        });
                        
                        // Atualizar texto do título da seção com indicação
                        const tituloSecao = conjugeSection.querySelector('.form-section-title');
                        if (tituloSecao) {
                            if (mostrarCamposConjuge) {
                                tituloSecao.textContent = 'Dados do Cônjuge (Obrigatório)';
                                
                                // Inicializar a funcionalidade de tipo de documento e órgão emissor do cônjuge se estiver visível
                                if (typeof atualizarCampoOrgaoEmissorConjuge === 'function') {
                                    setTimeout(atualizarCampoOrgaoEmissorConjuge, 20);
                                }
                            } else {
                                tituloSecao.textContent = 'Dados do Cônjuge';
                            }
                        }
                        
                        // Inicializar a funcionalidade de tipo de documento e órgão emissor do cônjuge
                        if (mostrarCamposConjuge && typeof atualizarCampoOrgaoEmissorConjuge === 'function') {
                            setTimeout(atualizarCampoOrgaoEmissorConjuge, 20);
                        }
                    }
                }
                
                // Adicionar evento para quando o estado civil for alterado
                estadoCivilSelect.addEventListener('change', function() {
                    // Executar com um pequeno atraso para garantir a atualização do DOM
                    setTimeout(atualizarCamposConjuge, 10);
                });
                
                // Executar no carregamento para configurar o estado inicial
                setTimeout(atualizarCamposConjuge, 100);
            }
            
            // Aplicar validações aos campos do cônjuge quando visíveis
            function aplicarValidacoesConjuge() {
                const estadoCivil = document.getElementById('input_103').value;
                const mostrarCamposConjuge = (estadoCivil === 'Casado(a)' || estadoCivil === 'União Estável');
                
                if (mostrarCamposConjuge) {
                    // Validação do CPF do cônjuge
                    const cpfConjugeInput = document.getElementById('input_228');
                    if (cpfConjugeInput) {
                        // Formatar CPF enquanto digita
                        cpfConjugeInput.addEventListener('input', function() {
                            let value = this.value.replace(/\D/g, '');
                            if (value.length > 11) {
                                value = value.substring(0, 11);
                            }
                            
                            if (value.length > 9) {
                                this.value = value.replace(/(\d{3})(\d{3})(\d{3})(\d{1,2})/, '$1.$2.$3-$4');
                            } else if (value.length > 6) {
                                this.value = value.replace(/(\d{3})(\d{3})(\d{1,3})/, '$1.$2.$3');
                            } else if (value.length > 3) {
                                this.value = value.replace(/(\d{3})(\d{1,3})/, '$1.$2');
                            } else {
                                this.value = value;
                            }
                            
                            // Validação em tempo real
                            validateCPF(this);
                        });
                        
                        // Validar ao perder o foco
                        cpfConjugeInput.addEventListener('blur', function() {
                            validateCPF(this);
                        });
                        
                        // Validação inicial se já tiver valor
                        if (cpfConjugeInput.value) {
                            validateCPF(cpfConjugeInput);
                        }
                    }
                    
                    // Validação da data de nascimento do cônjuge
                    const dataNascimentoConjugeInput = document.getElementById('input_231');
                    if (dataNascimentoConjugeInput) {
                        // O listener de blur já foi adicionado no loop dateFields.forEach acima.
                        // Mantemos a lógica para garantir que a validação ocorra se o campo for tornado visível/obrigatório.
                        if (!dataNascimentoConjugeInput.hasAttribute('data-blur-listener-set')) {
                            dataNascimentoConjugeInput.setAttribute('data-blur-listener-set', 'true');
                            // A validação no blur já está sendo feita pelo loop dateFields
                        }
                    }

                    // Adicionar validação para data de expedição do cônjuge no blur
                     const dataExpedicaoConjugeInput = document.getElementById('input_234');
                     if (dataExpedicaoConjugeInput) {
                         // O listener de blur já foi adicionado no loop dateFields.forEach acima.
                          if (!dataExpedicaoConjugeInput.hasAttribute('data-blur-listener-set')) {
                             dataExpedicaoConjugeInput.setAttribute('data-blur-listener-set', 'true');
                             // A validação no blur já está sendo feita pelo loop dateFields
                          }
                     }

                    // Aplicar validação de caracteres especiais aos campos de texto do cônjuge
                    const camposConjugeIds = [
                        'input_225', 'input_226', 'input_227', 'input_229', 'input_230', 
                        'input_232', 'input_233', 'input_235', 'input_236', 'input_237'
                    ];
                    
                    camposConjugeIds.forEach(id => {
                        const campo = document.getElementById(id);
                        if (campo && (campo.type === 'text' || campo.tagName === 'TEXTAREA') && campo.id !== 'input_228') {
                            // Não aplicar a validação de caracteres especiais ao CPF que tem sua própria validação
                            campo.addEventListener('input', function() {
                                validateSpecialChars(this);
                            });
                            
                            campo.addEventListener('blur', function() {
                                validateSpecialChars(this);
                            });
                            
                            // Validação inicial
                            if (campo.value) {
                                validateSpecialChars(campo);
                            }
                        }
                    });
                    
                    // Validação e sugestão para Naturalidade do cônjuge
                    const naturalidadeConjugeInput = document.getElementById('input_230');
                    if (naturalidadeConjugeInput) {
                        // Criar container para sugestões do cônjuge se ainda não existir
                        if (!document.querySelector('.conjuge-suggestions')) {
                            const conjugeSuggestionsContainer = document.createElement('div');
                            conjugeSuggestionsContainer.className = 'suggestions-container conjuge-suggestions';
                            conjugeSuggestionsContainer.style.display = 'none';
                            conjugeSuggestionsContainer.style.position = 'absolute';
                            conjugeSuggestionsContainer.style.zIndex = '1000';
                            conjugeSuggestionsContainer.style.backgroundColor = '#fff';
                            conjugeSuggestionsContainer.style.width = 'calc(100% - 2px)';
                            conjugeSuggestionsContainer.style.maxHeight = '200px';
                            conjugeSuggestionsContainer.style.overflowY = 'auto';
                            conjugeSuggestionsContainer.style.border = '1px solid var(--input-border)';
                            conjugeSuggestionsContainer.style.borderTop = 'none';
                            conjugeSuggestionsContainer.style.borderRadius = '0 0 6px 6px';
                            conjugeSuggestionsContainer.style.boxShadow = '0 4px 8px rgba(0, 0, 0, 0.1)';
                            
                            // Adicionar container após o input
                            naturalidadeConjugeInput.parentNode.style.position = 'relative';
                            naturalidadeConjugeInput.parentNode.appendChild(conjugeSuggestionsContainer);
                            
                            // Usar o mesmo cache de cidades para evitar consultas repetidas
                            let conjugeDebounceTimer;
                            
                            // Adicionar evento de input
                            naturalidadeConjugeInput.addEventListener('input', function() {
                                const query = this.value.trim();
                                
                                // Limpar o timer anterior
                                clearTimeout(conjugeDebounceTimer);
                                
                                // Ocultar sugestões se o input estiver vazio
                                if (query.length < 3) {
                                    conjugeSuggestionsContainer.style.display = 'none';
                                    return;
                                }
                                
                                // Definir novo timer para evitar consultas excessivas
                                conjugeDebounceTimer = setTimeout(function() {
                                    if (window.citiesCache && window.citiesCache[query]) {
                                        // Usar o cache se a consulta já foi feita antes
                                        displayConjugeSuggestions(window.citiesCache[query]);
                                    } else {
                                        // Adicionar classe de carregamento
                                        naturalidadeConjugeInput.classList.add('loading');
                                        
                                        // Consumir a API do IBGE
                                        fetch(`https://servicodados.ibge.gov.br/api/v1/localidades/municipios?orderBy=nome`)
                                            .then(response => response.json())
                                            .then(data => {
                                                // Filtrar municípios que contenham o texto digitado
                                                const filteredCities = data.filter(city => {
                                                    const cityName = city.nome.toLowerCase();
                                                    const stateAbbr = city.microrregiao.mesorregiao.UF.sigla;
                                                    const searchStr = `${cityName} - ${stateAbbr}`.toLowerCase();
                                                    return searchStr.includes(query.toLowerCase());
                                                }).slice(0, 10); // Limitar a 10 resultados
                                                
                                                // Armazenar no cache global
                                                if (!window.citiesCache) window.citiesCache = {};
                                                window.citiesCache[query] = filteredCities;
                                                
                                                // Exibir sugestões
                                                displayConjugeSuggestions(filteredCities);
                                                
                                                // Remover classe de carregamento
                                                naturalidadeConjugeInput.classList.remove('loading');
                                            })
                                            .catch(error => {
                                                console.error('Erro ao buscar cidades para cônjuge:', error);
                                                naturalidadeConjugeInput.classList.remove('loading');
                                            });
                                    }
                                }, 300);
                            });
                            
                            // Função para exibir sugestões
                            function displayConjugeSuggestions(cities) {
                                // Limpar o container de sugestões
                                conjugeSuggestionsContainer.innerHTML = '';
                                
                                if (cities.length === 0) {
                                    conjugeSuggestionsContainer.style.display = 'none';
                                    return;
                                }
                                
                                // Criar um item para cada cidade
                                cities.forEach(city => {
                                    const item = document.createElement('div');
                                    item.className = 'suggestion-item';
                                    item.textContent = `${city.nome} - ${city.microrregiao.mesorregiao.UF.sigla}`;
                                    item.style.padding = '10px 12px';
                                    item.style.cursor = 'pointer';
                                    item.style.borderBottom = '1px solid var(--divider-color)';
                                    
                                    // Adicionar efeito hover
                                    item.addEventListener('mouseover', function() {
                                        this.style.backgroundColor = 'var(--background-color)';
                                    });
                                    
                                    item.addEventListener('mouseout', function() {
                                        this.style.backgroundColor = 'transparent';
                                    });
                                    
                                    // Adicionar evento de clique para selecionar cidade
                                    item.addEventListener('click', function() {
                                        naturalidadeConjugeInput.value = this.textContent;
                                        conjugeSuggestionsContainer.style.display = 'none';
                                    });
                                    
                                    conjugeSuggestionsContainer.appendChild(item);
                                });
                                
                                // Exibir container de sugestões
                                conjugeSuggestionsContainer.style.display = 'block';
                            }
                            
                            // Fechar sugestões ao clicar fora do campo
                            document.addEventListener('click', function(e) {
                                if (e.target !== naturalidadeConjugeInput && e.target !== conjugeSuggestionsContainer) {
                                    conjugeSuggestionsContainer.style.display = 'none';
                                }
                            });
                            
                            // Navegação por teclado nas sugestões
                            naturalidadeConjugeInput.addEventListener('keydown', function(e) {
                                const items = conjugeSuggestionsContainer.querySelectorAll('.suggestion-item');
                                if (!items.length) return;
                                
                                const activeItem = conjugeSuggestionsContainer.querySelector('.suggestion-item.active');
                                
                                // Tecla para baixo
                                if (e.key === 'ArrowDown') {
                                    e.preventDefault();
                                    if (!activeItem) {
                                        items[0].classList.add('active');
                                        items[0].style.backgroundColor = 'var(--background-color)';
                                    } else {
                                        const index = Array.from(items).indexOf(activeItem);
                                        if (index < items.length - 1) {
                                            activeItem.classList.remove('active');
                                            activeItem.style.backgroundColor = 'transparent';
                                            items[index + 1].classList.add('active');
                                            items[index + 1].style.backgroundColor = 'var(--background-color)';
                                            
                                            // Scroll se necessário
                                            if (items[index + 1].offsetTop >= conjugeSuggestionsContainer.scrollTop + conjugeSuggestionsContainer.offsetHeight) {
                                                conjugeSuggestionsContainer.scrollTop = items[index + 1].offsetTop - conjugeSuggestionsContainer.offsetHeight + items[index + 1].offsetHeight;
                                            }
                                        }
                                    }
                                }
                                
                                // Tecla para cima
                                else if (e.key === 'ArrowUp') {
                                    e.preventDefault();
                                    if (activeItem) {
                                        const index = Array.from(items).indexOf(activeItem);
                                        if (index > 0) {
                                            activeItem.classList.remove('active');
                                            activeItem.style.backgroundColor = 'transparent';
                                            items[index - 1].classList.add('active');
                                            items[index - 1].style.backgroundColor = 'var(--background-color)';
                                            
                                            // Scroll se necessário
                                            if (items[index - 1].offsetTop < conjugeSuggestionsContainer.scrollTop) {
                                                conjugeSuggestionsContainer.scrollTop = items[index - 1].offsetTop;
                                            }
                                        }
                                    }
                                }
                                
                                // Tecla Enter
                                else if (e.key === 'Enter' && activeItem) {
                                    e.preventDefault();
                                    naturalidadeConjugeInput.value = activeItem.textContent;
                                    conjugeSuggestionsContainer.style.display = 'none';
                                }
                                
                                // Tecla Escape
                                else if (e.key === 'Escape') {
                                    conjugeSuggestionsContainer.style.display = 'none';
                                }
                            });
                        }
                    }
                }
            }
            
            // Executar a validação quando o formulário carrega
            setTimeout(aplicarValidacoesConjuge, 200);
            
            // Executar a validação quando o estado civil muda
            document.getElementById('input_103').addEventListener('change', function() {
                // Pequeno delay para garantir que a seção do cônjuge já foi atualizada
                setTimeout(aplicarValidacoesConjuge, 50);
            });

            // Função para aplicar regras ao campo de número de documento baseado no tipo
            function applyDocumentNumberRules(typeSelectId, numberInputId) {
                const typeSelect = document.getElementById(typeSelectId);
                const numberInput = document.getElementById(numberInputId);

                if (!typeSelect || !numberInput) {
                    console.warn(`Element not found for validation rule update: ${typeSelectId} or ${numberInputId}`);
                    return; // Sai se os elementos não existirem (ex: cônjuge oculto)
                }

                const selectedType = typeSelect.value;
                
                // Remover ouvintes de eventos anteriores para evitar duplicação
                const newNumberInput = numberInput.cloneNode(true);
                numberInput.parentNode.replaceChild(newNumberInput, numberInput);
                const currentNumberInput = document.getElementById(numberInputId); // Obter a nova referência

                // Resetar atributos comuns
                currentNumberInput.placeholder = 'Nº do Documento';
                currentNumberInput.removeAttribute('pattern');
                currentNumberInput.removeAttribute('maxlength');
                currentNumberInput.inputMode = 'text';
                currentNumberInput.value = ''; // Limpar valor ao mudar tipo

                switch (selectedType) {
                    case 'RG':
                        currentNumberInput.placeholder = 'Apenas números e X';
                        currentNumberInput.inputMode = 'text'; 
                        currentNumberInput.maxLength = 20; 
                        currentNumberInput.addEventListener('input', function() {
                            // Remove caracteres não permitidos para RG (incluindo . e -)
                            this.value = this.value.replace(/[^0-9Xx]/g, '');
                        });
                        break;
                    case 'CNH':
                        currentNumberInput.placeholder = '11 dígitos numéricos';
                        currentNumberInput.inputMode = 'numeric';
                        currentNumberInput.maxLength = 11;
                        currentNumberInput.addEventListener('input', function() {
                            // Permite apenas dígitos e limita a 11
                            this.value = this.value.replace(/\\D/g, '').slice(0, 11);
                        });
                        // Adiciona validação no blur
                        currentNumberInput.addEventListener('blur', function() {
                            const cnhValue = this.value;
                            const orgaoEmissorId = (numberInputId === 'input_98') ? 'input_99' : 'input_235';
                            const baseMsgId = numberInputId + '-cnh'; // Base para IDs de mensagem

                            clearValidationStyles(this, baseMsgId);
                            
                            if (cnhValue.length === 0) {
                                return; // Não valida campo vazio no blur
                            } 
                            
                            if (cnhValue.length < 11) {
                                showError(this, 'CNH deve ter 11 dígitos.', baseMsgId + '-error-msg');
                                return;
                            }

                            if (validateCNH(cnhValue, orgaoEmissorId)) {
                                showSuccess(this, 'CNH válida.', baseMsgId + '-success-msg');
                            } else {
                                showError(this, 'CNH inválida.', baseMsgId + '-error-msg');
                            }
                        });
                        break;
                    case 'Passaporte':
                        currentNumberInput.placeholder = 'LLNNNNNN (ex: AA123456)'; // Updated placeholder
                        currentNumberInput.inputMode = 'text';
                         // Validate Brazilian format: 2 letters followed by 6 digits
                        currentNumberInput.pattern = '^[a-zA-Z]{2}\\d{6}$'; // Updated pattern
                        currentNumberInput.maxLength = 8; // Updated max length
                        currentNumberInput.addEventListener('input', function() {
                            // Allow only letters and numbers, limit length
                            let value = this.value.replace(/[^a-zA-Z0-9]/g, '').toUpperCase(); 
                            if (value.length > 8) value = value.slice(0, 8);
                            this.value = value;
                        });
                        break;
                    default:
                        // Sem regras específicas para outros tipos ou quando nada está selecionado
                        break;
                }
            }

            // Anexar ouvintes de evento aos seletores de tipo de documento
            const userDocTypeSelect = document.getElementById('input_105');
            const spouseDocTypeSelect = document.getElementById('input_232');

            if (userDocTypeSelect) {
                userDocTypeSelect.addEventListener('change', () => {
                    applyDocumentNumberRules('input_105', 'input_98');
                    // Também atualiza órgão emissor (lógica existente)
                    if (typeof atualizarCampoOrgaoEmissor === 'function') {
                       atualizarCampoOrgaoEmissor();
                    }
                });
                 // Aplicar regras iniciais no carregamento para o usuário
                 applyDocumentNumberRules('input_105', 'input_98');
            }

            if (spouseDocTypeSelect) {
                spouseDocTypeSelect.addEventListener('change', () => {
                    applyDocumentNumberRules('input_232', 'input_233');
                    // Chamar função similar para órgão emissor do cônjuge se existir
                     if (typeof atualizarCampoOrgaoEmissorConjuge === 'function') {
                       atualizarCampoOrgaoEmissorConjuge();
                    }
                });
                // Aplicar regras iniciais no carregamento para o cônjuge (se visível)
                // A lógica de visibilidade já deve garantir que isso funcione corretamente
                 applyDocumentNumberRules('input_232', 'input_233');
            }

            // Função para atualizar o campo de órgão emissor do cônjuge
            function atualizarCampoOrgaoEmissorConjuge() {
                // Selecionar o tipo de documento do cônjuge
                const tipoDocumentoConjugeSelect = document.getElementById('input_232');
                // Tentar obter o campo de órgão emissor do cônjuge
                const orgaoEmissorConjugeField = document.getElementById('input_235');

                // Se o select ou o campo não existirem (por exemplo, seção oculta), não fazer nada
                if (!tipoDocumentoConjugeSelect || !orgaoEmissorConjugeField) {
                     console.warn('Campos do cônjuge não encontrados para atualizar órgão emissor.');
                     return;
                }

                const tipoDocConjuge = tipoDocumentoConjugeSelect.value;
                // Guardar o valor atual antes de substituir o campo
                const currentValue = orgaoEmissorConjugeField.value;

                // Guardar o elemento pai para readicionar o campo
                const parent = orgaoEmissorConjugeField.parentNode;

                // Remove o campo atual
                orgaoEmissorConjugeField.remove();

                let newField;

                if (tipoDocConjuge === 'RG') {
                    // Transformar em um select para RG do cônjuge
                    newField = document.createElement('select');
                    newField.id = 'input_235';
                    newField.name = 'q235_orgaoEmissorConjuge';
                    newField.className = 'form-control';
                    newField.required = true; // Assumindo que é obrigatório se a seção está visível

                    // Adicionar opções para órgãos emissores de RG (mesmas opções)
                    const options = [
                        {value: '', text: 'Selecione o órgão emissor'},
                        {value: 'SSP-AC', text: 'SSP-AC'}, {value: 'SSP-AL', text: 'SSP-AL'},
                        {value: 'SSP-AP', text: 'SSP-AP'}, {value: 'SSP-AM', text: 'SSP-AM'},
                        {value: 'SSP-BA', text: 'SSP-BA'}, {value: 'SSP-CE', text: 'SSP-CE'},
                        {value: 'SSP-DF', text: 'SSP-DF'}, {value: 'SSP-ES', text: 'SSP-ES'},
                        {value: 'SSP-GO', text: 'SSP-GO'}, {value: 'SSP-MA', text: 'SSP-MA'},
                        {value: 'SSP-MT', text: 'SSP-MT'}, {value: 'SSP-MS', text: 'SSP-MS'},
                        {value: 'SSP-MG', text: 'SSP-MG'}, {value: 'SSP-PA', text: 'SSP-PA'},
                        {value: 'SSP-PB', text: 'SSP-PB'}, {value: 'SSP-PR', text: 'SSP-PR'},
                        {value: 'SSP-PE', text: 'SSP-PE'}, {value: 'SSP-PI', text: 'SSP-PI'},
                        {value: 'SSP-RJ', text: 'SSP-RJ'}, {value: 'SSP-RN', text: 'SSP-RN'},
                        {value: 'SSP-RS', text: 'SSP-RS'}, {value: 'SSP-RO', text: 'SSP-RO'},
                        {value: 'SSP-RR', text: 'SSP-RR'}, {value: 'SSP-SC', text: 'SSP-SC'},
                        {value: 'SSP-SP', text: 'SSP-SP'}, {value: 'SSP-SE', text: 'SSP-SE'},
                        {value: 'SSP-TO', text: 'SSP-TO'},
                        {value: 'PC-AC', text: 'PC-AC'}, {value: 'PC-AL', text: 'PC-AL'},
                        {value: 'PC-AP', text: 'PC-AP'}, {value: 'PC-AM', text: 'PC-AM'},
                        {value: 'PC-BA', text: 'PC-BA'}, {value: 'PC-CE', text: 'PC-CE'},
                        {value: 'PC-DF', text: 'PC-DF'}, {value: 'PC-ES', text: 'PC-ES'},
                        {value: 'PC-GO', text: 'PC-GO'}, {value: 'PC-MA', text: 'PC-MA'},
                        {value: 'PC-MT', text: 'PC-MT'}, {value: 'PC-MS', text: 'PC-MS'},
                        {value: 'PC-MG', text: 'PC-MG'}, {value: 'PC-PA', text: 'PC-PA'},
                        {value: 'PC-PB', text: 'PC-PB'}, {value: 'PC-PR', text: 'PC-PR'},
                        {value: 'PC-PE', text: 'PC-PE'}, {value: 'PC-PI', text: 'PC-PI'},
                        {value: 'PC-RJ', text: 'PC-RJ'}, {value: 'PC-RN', text: 'PC-RN'},
                        {value: 'PC-RS', text: 'PC-RS'}, {value: 'PC-RO', text: 'PC-RO'},
                        {value: 'PC-RR', text: 'PC-RR'}, {value: 'PC-SC', text: 'PC-SC'},
                        {value: 'PC-SP', text: 'PC-SP'}, {value: 'PC-SE', text: 'PC-SE'},
                        {value: 'PC-TO', text: 'PC-TO'},
                        {value: 'DPF', text: 'DPF - Polícia Federal'},
                        {value: 'MAE', text: 'MAE - Ministério da Aeronáutica'},
                        {value: 'MEX', text: 'MEX - Ministério do Exército'},
                        {value: 'MMA', text: 'MMA - Ministério da Marinha'},
                        {value: 'OUTRO', text: 'Outro'}
                    ];

                    options.forEach(opt => {
                        const option = document.createElement('option');
                        option.value = opt.value;
                        option.textContent = opt.text;
                        newField.appendChild(option);
                    });

                } else if (tipoDocConjuge === 'CNH') {
                    // Transformar em um select para CNH do cônjuge
                    newField = document.createElement('select');
                    newField.id = 'input_235';
                    newField.name = 'q235_orgaoEmissorConjuge';
                    newField.className = 'form-control';
                    newField.required = true; // Assumindo que é obrigatório

                    // Adicionar opções para DETRAN de cada estado (mesmas opções)
                    const options = [
                        {value: '', text: 'Selecione o DETRAN'},
                        {value: 'DETRAN-AC', text: 'DETRAN-AC'}, {value: 'DETRAN-AL', text: 'DETRAN-AL'},
                        {value: 'DETRAN-AP', text: 'DETRAN-AP'}, {value: 'DETRAN-AM', text: 'DETRAN-AM'},
                        {value: 'DETRAN-BA', text: 'DETRAN-BA'}, {value: 'DETRAN-CE', text: 'DETRAN-CE'},
                        {value: 'DETRAN-DF', text: 'DETRAN-DF'}, {value: 'DETRAN-ES', text: 'DETRAN-ES'},
                        {value: 'DETRAN-GO', text: 'DETRAN-GO'}, {value: 'DETRAN-MA', text: 'DETRAN-MA'},
                        {value: 'DETRAN-MT', text: 'DETRAN-MT'}, {value: 'DETRAN-MS', text: 'DETRAN-MS'},
                        {value: 'DETRAN-MG', text: 'DETRAN-MG'}, {value: 'DETRAN-PA', text: 'DETRAN-PA'},
                        {value: 'DETRAN-PB', text: 'DETRAN-PB'}, {value: 'DETRAN-PR', text: 'DETRAN-PR'},
                        {value: 'DETRAN-PE', text: 'DETRAN-PE'}, {value: 'DETRAN-PI', text: 'DETRAN-PI'},
                        {value: 'DETRAN-RJ', text: 'DETRAN-RJ'}, {value: 'DETRAN-RN', text: 'DETRAN-RN'},
                        {value: 'DETRAN-RS', text: 'DETRAN-RS'}, {value: 'DETRAN-RO', text: 'DETRAN-RO'},
                        {value: 'DETRAN-RR', text: 'DETRAN-RR'}, {value: 'DETRAN-SC', text: 'DETRAN-SC'},
                        {value: 'DETRAN-SP', text: 'DETRAN-SP'}, {value: 'DETRAN-SE', text: 'DETRAN-SE'},
                        {value: 'DETRAN-TO', text: 'DETRAN-TO'}
                    ];

                    options.forEach(opt => {
                        const option = document.createElement('option');
                        option.value = opt.value;
                        option.textContent = opt.text;
                        newField.appendChild(option);
                    });

                } else if (tipoDocConjuge === 'Passaporte') {
                    // Campo de texto preenchido com Polícia Federal para cônjuge
                    newField = document.createElement('input');
                    newField.type = 'text';
                    newField.id = 'input_235';
                    newField.name = 'q235_orgaoEmissorConjuge';
                    newField.className = 'form-control';
                    newField.value = 'Polícia Federal';
                    newField.readOnly = true;
                    newField.required = true; // Assumindo que é obrigatório

                } else {
                    // Campo de texto padrão para cônjuge
                    newField = document.createElement('input');
                    newField.type = 'text';
                    newField.id = 'input_235';
                    newField.name = 'q235_orgaoEmissorConjuge';
                    newField.className = 'form-control';
                    newField.placeholder = 'Digite o órgão emissor';
                    newField.required = true; // Assumindo que é obrigatório
                }

                // Inserir o novo campo no DOM
                parent.appendChild(newField);

                // Gerenciar evento de "outro" se for um select (para RG do cônjuge)
                if (newField.nodeName === 'SELECT' && tipoDocConjuge === 'RG') {
                    newField.addEventListener('change', function() {
                        if (this.value === 'OUTRO') {
                            // Substituir o select por um campo de texto
                            const textField = document.createElement('input');
                            textField.type = 'text';
                            textField.id = 'input_235';
                            textField.name = 'q235_orgaoEmissorConjuge';
                            textField.className = 'form-control';
                            textField.placeholder = 'Digite o órgão emissor';
                            textField.required = true;

                            this.parentNode.replaceChild(textField, this);
                            textField.focus();
                        }
                    });
                }

                // Tentar restaurar o valor anterior, se possível
                if (currentValue && newField.nodeName === 'SELECT') {
                    const options = Array.from(newField.options);
                    const matchingOption = options.find(opt => opt.value === currentValue);
                    if (matchingOption) {
                        newField.value = currentValue;
                    }
                } else if (newField.type === 'text' && !newField.readOnly) {
                    newField.value = currentValue;
                }
             }

        });
    </script>
</body>
</html>